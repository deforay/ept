</style>
<link rel="stylesheet" href="<?php echo $this->baseUrl('css/daterangepicker.css'); ?>" type="text/css" media="all">
<link rel="stylesheet" href="<?php echo $this->baseUrl("css/jquery.dataTables.css"); ?>" type="text/css" media="all">
<h4 style="width:100%;height:50px;border-bottom:1px solid #777;">
    <div style="font-size:22.5px;line-height:36px;color:#333;float:left;">Audit Log</div>
</h4>

<table style="margin:20px 0;" class="table table-bordered">
    <tr>
        <td style="width:200px;text-align: center;font-weight:bold;">
            Pick a Date Range (Optional)
        </td>
        <td style="width:200px;text-align: center;font-weight:bold;">
            Select Context Type (Optional)
        </td>
        <td style="width:200px;text-align: center;font-weight:bold;">
            Select User (Optional)
        </td>
        <td style="width:40px;text-align: center;font-weight:bold;"></td>
    </tr>
    <tr>
        <td>
            <input type="text" id="dateRange" name="dateRange" class="form-control input-sm" readonly="readonly" style="background: #fff" placeholder="Click here to pick a Date Range" />
        </td>
        <td>
            <select id="type" name="type" onchange="drawTable();" class="form-control input-sm">
                <option value=""> -- Select Context --</option>
                <option value="participants">Participants</option>
                <option value="Shipment">Shipments</option>
            </select>
        </td>
        <td>
            <select id="createdBy" name="createdBy" onchange="drawTable();" class="form-control input-sm">
                <option value=""> -- Select a User --</option>
                <?php
                foreach ($this->systemAdmin as $admin) {
                ?>
                    <option value="<?php echo $admin['primary_email']; ?>"><?php echo $admin['first_name'] . " " . $admin['last_name']; ?></option>
                <?php
                }
                ?>
            </select>
        </td>
        <td><button class="btn btn-danger btn-sm" onclick="document.location.href=document.location"><span>Reset</span></button></td>
    </tr>
</table>

<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="auditLogTable">
    <thead>
        <tr>
            <th>Action</th>
            <th>Action By</th>
            <th>Action On</th>
            <th>Context</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td colspan="2" class="dataTables_empty">Loading data from server</td>
        </tr>
    </tbody>
</table>
<script type="text/javascript" src="<?php echo $this->baseUrl('js/daterangepicker.js'); ?>"></script>
<script type="text/javascript" charset="utf-8">
    var startDate = "";
    var endDate = "";
    $(document).ready(function() {
        $.blockUI;

        $('#dateRange').daterangepicker({
                format: 'DD-MMM-YYYY',
                ranges: {
                    //'Today': [moment(), moment()],
                    //'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
                    //'Last 7 Days': [moment().subtract('days', 6), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')],
                    'Last 30 Days': [moment().subtract('days', 29), moment()],
                    'Last 90 Days': [moment().subtract('days', 89), moment()],
                    'Last 120 Days': [moment().subtract('days', 119), moment()],
                    'Last 180 Days': [moment().subtract('days', 179), moment()]
                }
            },
            function(start, end) {
                startDate = start.format('YYYY-MM-DD');
                endDate = end.format('YYYY-MM-DD');
                oTable.fnDraw();
            });
        oTable = $('#auditLogTable').dataTable({
            "oLanguage": {
                "sLengthMenu": "_MENU_ records per page"
            },
            "bJQueryUI": false,
            "bAutoWidth": false,
            "bInfo": true,
            "bScrollCollapse": true,
            "sPaginationType": "bootstrap",
            "bRetrieve": true,
            "aoColumns": [{
                    "sClass": "center"
                },
                {
                    "sClass": "center",
                },
                {
                    "sClass": "center",
                },
                {
                    "sClass": "center",
                }
            ],
            "aaSorting": [
                [0, "desc"]
            ],
            "bProcessing": true,
            "bSortClasses": false,
            "bServerSide": true,
            "sAjaxSource": "<?php echo $this->url(array('module' => 'admin', 'controller' => 'audit-log', 'action' => 'index', 'format' => 'html')); ?>",
            "fnServerParams": function(aoData) {
                type = $("#type").val();
                dateRange = $("#dateRange").val();
                createdBy = $("#createdBy").val();
                aoData.push({
                    "name": "dateRange",
                    "value": dateRange
                });
                aoData.push({
                    "name": "type",
                    "value": type
                });
                aoData.push({
                    "name": "startDate",
                    "value": startDate
                });
                aoData.push({
                    "name": "endDate",
                    "value": endDate
                });
                aoData.push({
                    "name": "createdBy",
                    "value": createdBy
                });
            },
            "fnServerData": function(sSource, aoData, fnCallback) {
                $.ajax({
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    "data": aoData,
                    "success": function(json) {
                        fnCallback(json);
                    }
                });
            }
        });
        $.unblockUI;
    });

    function drawTable() {
        $.blockUI;
        oTable.fnDraw();
        $.unblockUI;
    }
</script>