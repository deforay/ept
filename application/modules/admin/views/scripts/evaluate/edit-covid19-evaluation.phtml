<?php


// Zend_Debug::dump($this->geneIdentifiedTypes);die;
$testThreeHidden = false;
$testTwoHidden = false;
$screeningTest = false;

$attributes = json_decode($this->evaluateData['shipment']['attributes'], true);

$allowedAlgorithms = isset($this->config->evaluation->covid19->allowedAlgorithms) ? explode(",", $this->config->evaluation->covid19->allowedAlgorithms) : array();
$maximumAllowed = $this->config->evaluation->covid19->covid19MaximumTestAllowed;
if (isset($maximumAllowed) && ($maximumAllowed == '1' || $maximumAllowed == '2')) {
    $testThreeHidden = true;
}

if (isset($maximumAllowed) && $maximumAllowed != '3' && $maximumAllowed != '2') {
    $testTwoHidden = true;
}
$shipmentAttributes = isset($this->evaluateData['shipment']['shipment_attributes']) ? json_decode($this->evaluateData['shipment']['shipment_attributes'], true) : array();

if (isset($this->config->evaluation->covid19->covid19MaximumTestAllowed) && ($this->config->evaluation->covid19->covid19MaximumTestAllowed == '1' || $this->config->evaluation->covid19->covid19MaximumTestAllowed == '2')) {
    $testThreeHidden = true;
}

if (isset($this->config->evaluation->covid19->covid19MaximumTestAllowed) && $this->config->evaluation->covid19->covid19MaximumTestAllowed != '3' && $this->config->evaluation->covid19->covid19MaximumTestAllowed != '2') {
    $testTwoHidden = true;
}
/* if (isset($shipmentAttributes['screeningTest']) && $shipmentAttributes['screeningTest'] == 'yes') {
    $testTwoHidden = true;
    $testThreeHidden = true;
    $screeningTest = true;
} */

?>
<table class="table table-bordered table-striped" style="width:100%;margin:0 auto 10px auto;">
    <tr>
        <th>Shipment Code</th>
        <td><?php echo $this->evaluateData['shipment']['shipment_code']; ?></td>
        <th>Scheme Type</th>
        <td><?php echo strtoupper($this->evaluateData['shipment']['scheme_name']); ?></td>
    </tr>
    <tr>
        <th>Shipment Date</th>
        <td><?php echo $this->dateFormat($this->evaluateData['shipment']['shipment_date']); ?></td>
        <th>Result Due Date</th>
        <td><?php echo $this->dateFormat($this->evaluateData['shipment']['lastdate_response']); ?></td>
    </tr>
    <tr>
        <th>Shipment Received on</th>
        <td><input id="receivedOn" type="text" name="receivedOn" value="<?php echo $this->dateFormat($this->evaluateData['shipment']['shipment_receipt_date']); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" /></td>
        <th>Samples Tested on</th>
        <td><input id="testedOn" type="text" name="testedOn" value="<?php echo $this->dateFormat($this->evaluateData['shipment']['shipment_test_date']); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" /></td>
    </tr>
    <tr>
        <th>
            Sample Rehydration Date
        </th>
        <td>
            <input id="rehydrationDate" type="text" name="rehydrationDate" value="<?php echo $this->dateFormat($attributes['sample_rehydration_date']); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" />
        </td>
        <!-- <th>Algorithm Used</th>
        <td>
            <select name="algorithm" id="algorithm" class="isRequired form-control" title="Please choose the Algorithm used"  onchange="showHideTest3();">

                <option value="">--Select--</option>
                <?php if (!empty($this->config->evaluation->covid19->covid19EnforceAlgorithmCheck) && $this->config->covid19EnforceAlgorithmCheck == 'yes') { ?>

                <?php } ?>
                <?php if (!empty($allowedAlgorithms) && in_array('serial', $allowedAlgorithms)) { ?>
                    <option value="serial" <?php echo (isset($attributes["algorithm"]) && $attributes["algorithm"] == 'serial') ? "selected='selected'" : ''; ?>>Serial</option>
                <?php } ?>
                <?php if (!empty($allowedAlgorithms) && in_array('parallel', $allowedAlgorithms)) { ?>
                    <option value="parallel" <?php echo (isset($attributes["algorithm"]) && $attributes["algorithm"] == 'parallel') ? "selected='selected'" : ''; ?>>Parallel</option>
                <?php } ?>
                <?php if (!empty($allowedAlgorithms) && in_array('myanmarNationalDtsAlgo', $allowedAlgorithms)) { ?>
                    <option value="myanmarNationalDtsAlgo" <?php echo (isset($attributes["algorithm"]) && $attributes["algorithm"] == 'myanmarNationalDtsAlgo') ? "selected='selected'" : ''; ?>>Myanmar National Algorithm</option>
                <?php } ?>
            </select>
        </td> -->
        <?php if($maximumAllowed > 1){ ?>
        <td><label for="numberOfParticipantTest"> Number of tests <span class='mandatory'>*</span></label></td>
        <td>
            <select class="form-control" name="numberOfParticipantTest" id="numberOfParticipantTest" title="Please select number of participant test" onchange="showHideTest(this.value);">
            <option value="">--Select--</option>
            <?php foreach(range(1,$maximumAllowed) as $no){
                $selected = (isset($this->evaluateData['shipment']['number_of_tests']) && $this->evaluateData['shipment']['number_of_tests'] == $no)?"selected='selected'":"";
                echo '<option value="'.$no.'" '.$selected.'>'.$no.'</option>';
            }?>
            </select>
        </td>
        <?php } else{

        } ?>
    </tr>
    <tr>
        <th>Supervisor Review</th>
        <td>
            <select name="supervisorApproval" id="supervisorApproval" class="isRequired form-control" title="Please select if Supervisor Approval was conducted or not">
                <option value=""> -- Select -- </option>
                <option value="yes" <?php if (strtolower($this->evaluateData['shipment']['supervisor_approval']) == 'yes') echo " selected "; ?>>YES</option>
                <option value="no" <?php if (strtolower($this->evaluateData['shipment']['supervisor_approval']) == 'no') echo " selected "; ?>>NO</option>
            </select>
        </td>
        <th id="labSupervisor" <?php echo (isset($this->evaluateData['shipment']['supervisor_approval']) && strtolower($this->evaluateData['shipment']['supervisor_approval']) == 'yes') ? "" : "style='display:none;'" ?>>Supervisor Name</th>
        <td>
            <input name="participantSupervisor" id="participantSupervisor" type="text" <?php echo (isset($this->evaluateData['shipment']['supervisor_approval']) && strtolower($this->evaluateData['shipment']['supervisor_approval']) == 'yes') ? "" : "style='display:none;'" ?> class="form-control" value="<?php echo $this->evaluateData['shipment']['participant_supervisor']; ?>" />
        </td>
    </tr>
    <tr>
        <th>User Comments</th>
        <td colspan="3"><textarea class="form-control" name="userComments" id="userComments"><?php echo $this->evaluateData['shipment']['user_comment']; ?></textarea></td>
    </tr>
</table>

<?php
$possibleResults = array();
foreach ($this->evaluateData['possibleResults'] as $pr) {
    if ($pr['scheme_sub_group'] == 'COVID19_TEST') {
        $possibleResults[$pr['id']] = $pr['response'];
    }
}
$possibleFinalResults = array();
foreach ($this->evaluateData['possibleResults'] as $pr) {
    if ($pr['scheme_sub_group'] == 'COVID19_FINAL') {
        $possibleFinalResults[$pr['id']] = $pr['response'];
    }
}
?>


<table class="table table-striped table-bordered">

    <thead>
        <tr align="CENTER" class="dark">
            <th></th>
            <th style="text-align: center">Test-1</th>
            <th style="text-align: center" class='testTwo'>Test-2</th>
            <th style="text-align: center" class='testThree'>Test-3</th>

        </tr>
    </thead>
    <tr style="text-align:center">
        <th style="width:10%;"> Type Name</th>
        <td>
            <select name="test_type_1" id="test_type_1" class="isRequired form-control" title="Please Choose Test Type 1">
                <?php $this->dropdownSelection($this->allTestTypes, $this->evaluateData['results'][0]["test_type_1"], true); ?>
            </select> </td>
        <td class='testTwo'>
            <select name="test_type_2" id="test_type_2" class="isRequired form-control" title="Please Choose Test Type 2">
                <?php $this->dropdownSelection($this->allTestTypes, $this->evaluateData['results'][0]["test_type_2"], true); ?>
            </select> </td>
        <td class='testThree'>
            <select name="test_type_3" id="test_type_3" class="isRequired form-control" title="Please Choose Test Type 3">
                <?php $this->dropdownSelection($this->allTestTypes, $this->evaluateData['results'][0]["test_type_3"], true); ?>
            </select> </td>
    </tr>
    <tr align="CENTER" class="dark">
        <th>Lot No.</th>
        <td><input type="text" size="40" maxlength="40" name="lot_no_1" id="lot_no_1" value="<?php echo (isset($this->evaluateData['results'][0]["lot_no_1"]) ? $this->evaluateData['results'][0]["lot_no_1"] : ""); ?>" class="isRequired form-control" title="Please enter Lot No. 1" /></td>
        <td class='testTwo'><input type="text" size="40" maxlength="40" name="lot_no_2" id="lot_no_2" value="<?php echo (isset($this->evaluateData['results'][0]["lot_no_2"]) ? $this->evaluateData['results'][0]["lot_no_2"] : ""); ?>" class="isRequired form-control" title="Please enter Lot No. 2" /></td>
        <td class='testThree'><input type="text" size="40" maxlength="40" name="lot_no_3" id="lot_no_3" value="<?php echo (isset($this->evaluateData['results'][0]["lot_no_3"]) ? $this->evaluateData['results'][0]["lot_no_3"] : ""); ?>" class="isRequired form-control" title="Please enter Lot No. 3" /></td>
    </tr>

    <tr style="text-align:center">
        <th>Exp Date</th>
        <td><input id="exp_date1" type="text" id="exp_date1" name="exp_date_1" value="<?php echo ((isset($this->evaluateData['results'][0]["exp_date_1"]) && $this->evaluateData['results'][0]["exp_date_1"] != "0000-00-00" && $this->evaluateData['results'][0]["exp_date_1"] != "") ? $this->dateFormat($this->evaluateData['results'][0]["exp_date_1"]) : ""); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" /></td>
        <td class='testTwo'><input id="exp_date2" type="text" id="exp_date2" name="exp_date_2" value="<?php echo ((isset($this->evaluateData['results'][0]["exp_date_2"]) && $this->evaluateData['results'][0]["exp_date_2"] != "0000-00-00" && $this->evaluateData['results'][0]["exp_date_2"] != "") ? $this->dateFormat($this->evaluateData['results'][0]["exp_date_2"]) : ""); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" /></td>
        <td class='testThree'><input id="exp_date3" type="text" id="exp_date3" name="exp_date_3" value="<?php echo ((isset($this->evaluateData['results'][0]["exp_date_3"]) && $this->evaluateData['results'][0]["exp_date_3"] != "0000-00-00" && $this->evaluateData['results'][0]["exp_date_3"] != "") ? $this->dateFormat($this->evaluateData['results'][0]["exp_date_3"]) : ""); ?>" size="11" maxlength="11" class="datepicker form-control" readonly="readonly" /></td>
    </tr>
    <thead>
        <tr align="CENTER" class="dark">
            <th></th>
            <th style="text-align: center;width:14.2%;">Result-1</th>
            <th style="text-align: center;width:14.2%;" class='testTwo'>Result-2</th>
            <th style="text-align: center;width:14.2%;" class='testThree'>Result-3</th>
            <th style="text-align: center;width:14.2%;">Reported Result</th>
            <th style="text-align: center;width:14.2%;">Reference Result</th>
            <th style="text-align: center;width:14.2%;">Score</th>
            <th style="text-align: center;width:14.2%;">Action</th>
        </tr>
    </thead>

    <?php
    $count = 1;
    if (count($this->evaluateData['controlResults']) > 0) {
    ?>
        <tr>
            <td colspan="8" class="colspan-samples" style="text-align: center;">
                <strong>Controls</strong>
            </td>
        </tr>
    <?php
    }

    foreach ($this->evaluateData['controlResults'] as $sample) {
        $count++;
    ?>

        <tr style="text-align:center;vertical-align: middle;">

            <th style="white-space: nowrap;vertical-align: middle;">
                <?php echo ($sample['sample_label']); ?> <?php echo ($sample['mandatory'] == 1) ? " <span class='mandatory'>*</span>" : "&nbsp;&nbsp;"; ?>
                <input type="hidden" id="sample<?php echo $count; ?>" name="sampleId[]" value="<?php echo $sample['sample_id']; ?>" />
            </th>

            <td>
                <select name="test_result_1[]" id="<?php echo "testresult1_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_1'], true); ?>
                </select>
            </td>
            <td class='testTwo'>
                <select name="test_result_2[]" id="<?php echo "testresult2_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_2'], true); ?>
                </select>
            </td>
            <td class='testThree'>
                <select name="test_result_3[]" id="<?php echo "testresult3_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_3'], true); ?>
                </select>
            </td>

            <td>
                <select name="reported_result[]" id="<?php echo "testresultf_" . $count; ?>" <?php echo ($sample['mandatory'] == 1) ? "class='isRequired form-control'" : "class=' form-control'"; ?> title="Please enter the result">
                    <?php $this->dropdownSelection($possibleFinalResults, $sample['reported_result'], true); ?>
                </select>
            </td>

            <td style="vertical-align: middle;">

                <?php $this->dropdownSelectedText($possibleFinalResults, $sample['reference_result'], true); ?>

            </td>
            <td style="vertical-align: middle;" colspan="2">-</td>
        </tr>
    <?php } ?>


    <tr>
        <td colspan="8" class="colspan-samples" style="text-align: center;">
            <strong>Samples</strong>
        </td>
    </tr>
    <?php
    $total = 0;
    $count = 1;

    foreach ($this->evaluateData['results'] as $sample) {
        $count++;
    ?>

        <tr style="text-align:center">

            <th style="white-space: nowrap;vertical-align: middle;">
                <?php echo ($sample['sample_label']); ?> <?php echo ($sample['mandatory'] == 1) ? " <span class='mandatory'>*</span>" : "&nbsp;&nbsp;"; ?>
                <input type="hidden" id="sample<?php echo $count; ?>" name="sampleId[]" value="<?php echo $sample['sample_id']; ?>" />
            </th>

            <td>
                <select name="test_result_1[]" id="<?php echo "testresult1_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_1'], true); ?>
                </select>
            </td>
            <td class='testTwo'>
                <select name="test_result_2[]" id="<?php echo "testresult2_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_2'], true); ?>
                </select>
            </td>
            <td class='testThree'>
                <select name="test_result_3[]" id="<?php echo "testresult3_" . $count; ?>" class=" form-control">
                    <?php $this->dropdownSelection($possibleResults, $sample['test_result_3'], true); ?>
                </select>
            </td>

            <td>
                <select name="reported_result[]" id="<?php echo "testresultf_" . $count; ?>" <?php echo ($sample['mandatory'] == 1) ? "class='isRequired form-control'" : "class=' form-control'"; ?> title="Please enter the result">
                    <?php $this->dropdownSelection($possibleFinalResults, $sample['reported_result'], true); ?>
                </select>
            </td>

            <td style="vertical-align: middle;">

                <?php $this->dropdownSelectedText($possibleFinalResults, $sample['reference_result'], true); ?>

            </td>
            <td style="vertical-align: middle;">
            <?php echo $score = ($sample['reference_result'] == $sample['reported_result']) ? $sample['sample_score'] : 0;
            $total += $score;
            ?>
            </td>
            <td width="10%"><a href="javascript:void(0);" id="geneTypeAnchor<?php echo $sample['sample_id']; ?>" class="btn btn-xs btn-primary" onclick="showdefModal('geneTypes<?php echo $sample['sample_id']; ?>', 900,600);"><i class="icon-beaker"></i> Add Gene Types </a></td>
        </tr>
    <?php } ?>
    <tr style="text-align:center" >
        <td colspan="6" class="colspan" style="text-align: right;">Total</td>
        <td style="vertical-align: middle;"><?php echo $total; ?></td>
        <td></td>
    </tr>
</table>

<script>
    var test2Hidden = "<?php echo $testTwoHidden ? 'yes' : 'no'; ?>";
    var test3Hidden = "<?php echo $testThreeHidden ? 'yes' : 'no'; ?>";

    $(document).ready(()=>{ 
        <?php $count = 0;
            foreach ($this->evaluateData['results'] as $sample) { ?>
            addNewGeneTypeBlock(<?php echo $sample['sample_id'];?>);
            <?php $count++;
        }?>
    });

    function showHideTest(no){
        
        if(no != ""){
            $('.tests').show();
        } else{
            no = 1;
        }
        if(no == 1){
            $('.testTwo,.testThree').hide();
            test2Hidden = 'yes';
            test3Hidden = 'yes';
            
            /* To set colspan for toal, control and samples */
            $('.colspan').attr('colspan',4);
            $('.colspan-samples').attr('colspan',6);
        } else if(no == 2){
            $('.testThree').hide();
            test2Hidden = "<?php echo $testTwoHidden ? 'yes' : 'no'; ?>";
            if (test2Hidden == 'yes') {
                $('.testTwo').hide();
            } else {
                $('.testTwo').show();
            }
            test3Hidden = 'yes';

            /* To set colspan for toal, control and samples */
            $('.colspan').attr('colspan',5);
            $('.colspan-samples').attr('colspan',7);
        } else {
            test2Hidden = "<?php echo $testTwoHidden ? 'yes' : 'no'; ?>";
            if (test2Hidden == 'yes') {
                $('.testTwo').hide();
            } else {
                $('.testTwo').show();
            }
            test3Hidden = "<?php echo $testThreeHidden ? 'yes' : 'no'; ?>";
            if (test3Hidden == 'yes') {
                $('.testThree').hide();
            } else {
                $('.testThree').show();
            }
            /* To set colspan for toal, control and samples */
            $('.colspan').attr('colspan',6);
            $('.colspan-samples').attr('colspan',8);
        }
    }

    function showHideTest2() {

        if (test2Hidden == 'yes') {
            $('.testTwo').hide();
        } else {
            $('.testTwo').show();
        }

    }
    function showHideTest3() {

        if (test3Hidden == 'yes') {
            $('.testThree').hide();
        } else {
            $('.testThree').show();
        }

    }

    $(function() {
        showHideTest($('#numberOfParticipantTest').val());
        showHideTest2();
        showHideTest3();
    });

    function addNewGeneTypeBlock(sampleId) {
        var sampleCounter = 1;

        var strTxt = [];
        <?php if(count($this->geneIdentifiedTypes) > 0){
            foreach($this->geneIdentifiedTypes as $gene){ 
                if($gene['shipment_id'] == $this->evaluateData['shipment']['shipment_id'] && $gene['map_id'] == $this->evaluateData['shipment']['map_id']){?>
                    var sample = <?php echo $gene['sample_id'];?>;
                    if(sample == sampleId){
                        strTxt.push('<tr>\
                            <td><select onChange="geneTypeInputChange(this,' + sampleCounter +')" class="form-control geneTypeInput' + sampleId + sampleCounter + '" id="' + sampleId + '" name="geneType[' + sampleId + '][]"><?php echo $commonService->generateSelectOptions($this->allGeneTypes, $gene['gene_id'], '-- Select --'); ?></select></td>\
                            <td><input value="<?php echo $gene['ct_value'];?>" onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="cTValue[' + sampleId + '][]"  id="' + sampleId + '" class="form-control cTValue' + sampleId  + sampleCounter + '"/></td>\
                            <td><textarea onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="remarks[' + sampleId + '][]"  id="' + sampleId + '" class="form-control remarks' + sampleId  + sampleCounter + '"><?php echo $gene['remarks'];?></textarea></td>\
                            <td>\
                                <a href="javascript:void(0);" onclick="addNewGeneTypeRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
                                <a  href="javascript:void(0);" onclick="removeGeneTypeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
                            </td>\
                        </tr>');
                        sampleCounter++;
                        <?php if($gene['gene_id'] != ""){ ?>
                            $('#geneTypeAnchor'+sample).html('<i class="icon-beaker"></i> Edit Gene Types');
                            $('#geneTypeAnchor'+sample).removeClass('btn-primary');
                            $('#geneTypeAnchor'+sample).addClass('btn-danger');
                        <?php } ?>
                    }
                    <?php 
                } 
            }
        }else {?>
        strTxt.push('<tr>\
            <td><select onChange="geneTypeInputChange(this,' + sampleCounter +')" class="form-control geneTypeInput' + sampleId + sampleCounter + '" id="' + sampleId + '" name="geneType[' + sampleId + '][]"><?php echo $commonService->generateSelectOptions($this->allGeneTypes, null, '-- Select --'); ?></select></td>\
            <td><input value="<?php echo $gene['ct_value'];?>" onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="cTValue[' + sampleId + '][]"  id="' + sampleId + '" class="form-control cTValue' + sampleId  + sampleCounter + '"/></td>\
            <td><textarea onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="remarks[' + sampleId + '][]"  id="' + sampleId + '" class="form-control remarks' + sampleId  + sampleCounter + '"><?php echo $gene['remarks'];?></textarea></td>\
            <td>\
                <a href="javascript:void(0);" onclick="addNewGeneTypeRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
                <a  href="javascript:void(0);" onclick="removeGeneTypeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
            </td>\
        </tr>');
        <?php } ?>
        
		$("#geneBlockHolder").after('<div id="geneTypes' + sampleId + '" class="dialog">\
        <span onClick="hidedefModal()" class="closeModal"></span>\
        <div class="modal-header">\
        <h4 class="modal-title"> Gene Types for (Shipment <?php echo $this->shipment["shipment_code"];?>)</h4>\
        </div>\
        <div class="modal-body">\
        <div class="row">\
            <div >\
            <table style="width: 100%;margin: 0 auto;" id="geneTypeTable' + sampleId + '" class="table table-bordered table-striped clearfix">\
                <thead>\
                    <tr align="center">\
                        <th style="text-align: center;">Gene Type</th>\
                        <th style="text-align: center;">CT Value</th>\
                        <th style="text-align: center;">Remarks</th>\
                        <th style="text-align: center;">Action</th>\
                    </tr>\
                </thead>\
                <tbody>'+strTxt.join()+'</tbody>\
            </table>\
            </div>\
        </div>\
        </div>\
        <div class="modal-footer">\
        <button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'geneTypes' + sampleId + '\')">OK</button>\
        </div>\
    </div>');
	}
    function addNewGeneTypeRow(obj, sampleId) {
        sampleCounter = $("#geneTypeTable" + sampleId + " tbody tr").length;
		$(obj.parentNode.parentNode).after('<tr> \
            <td><select onChange="geneTypeInputChange(this,' + sampleCounter +')" class="form-control geneTypeInput' + sampleId  + sampleCounter + '"  id="' + sampleId + '" name="geneType[' + sampleId + '][]"><?php echo $this->allGeneTypes; ?></select></td> \
            <td><input onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="cTValue[' + sampleId + '][]"  id="' + sampleId + '" class="form-control cTValue' + sampleId  + sampleCounter + '"/></td> \
            <td><input onChange="geneTypeInputChange(this,' + sampleCounter +')" type="text" name="remarks[' + sampleId + '][]"  id="' + sampleId + '" class="form-control remarks' + sampleId  + sampleCounter + '"/></td> \
            <td> \
                <a href="javascript:void(0);" onclick="addNewGeneTypeRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
                <a  href="javascript:void(0);" onclick="removeGeneTypeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
            </td> \
    </tr>');
		$(".datepicker").datepicker({
			dateFormat: '<?php echo $dtFormat; ?>'
		});
	}

    function removeGeneTypeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal", function() {
			$(this).remove();
		});
	}

    function closeShipmentModal(divId) {
		document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

		$("#mbd input:text").each(function(i, obj) {
			$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
		});
		$("#mbd select").each(function(i, obj) {
			$("#" + divId + " select:eq(" + i + ")").val($(this).val());
		});

		hidedefModal();
	}
    
    function geneTypeInputChange(obj){
        let id = $(obj).attr('id');
        let counter = $("#geneTypeTable" + id + " tbody tr").length-1;
        flag = false;
        for(i=1;i<=counter;i++){
            if($(".geneTypeInput"+id+i).val() != "" || $(".cTValue"+id+i).val() != "" || $(".remarks"+id+i).val() != ""){
                flag = true;
            }
        }
        if(flag){
            $('#geneTypeAnchor'+id).html('<i class="icon-beaker"></i> Edit Gene Types')
            $('#geneTypeAnchor'+id).removeClass('btn-primary')
            $('#geneTypeAnchor'+id).addClass('btn-danger')
        } else{
            $('#geneTypeAnchor'+id).html('<i class="icon-beaker"></i> Add Gene Types')
            $('#geneTypeAnchor'+id).addClass('btn-primary')
            $('#geneTypeAnchor'+id).removeClass('btn-danger')
        }
    }
</script>