<?php

$shipmentData = $this->shipmentData;
// Zend_Debug::dump($shipmentData['recencyAssay']);die;
$shipmentAttribute = json_decode($shipmentData['shipment']['shipment_attributes'], true);
$vHelper = $this->getHelper('DateFormat');
$dtFormat =  $vHelper->getDateFormat();
?>
<link rel="stylesheet" href="<?php echo $this->baseUrl("css/bootstrap-modal.css"); ?>" type="text/css" media="all">
<style type="text/css">
	.modal-scrollable {
		z-index: 1000 !important;
	}

	.modal-backdrop {
		z-index: 900 !important;
	}

	#mbd {
		overflow-y: scroll;
		max-height: 100%;
	}
</style>
<div class="well">
	<fieldset>
		<legend><?= $this->translate->_("Update Shipment Sample Details"); ?> - <?php echo $shipmentData['shipment']['shipment_code']; ?></legend>
		<form class="form-horizontal" name="shipmentForm" id="shipmentForm" method="post" action="<?php echo $this->url(array('module' => 'admin', 'controller' => 'shipment', 'action' => 'edit')); ?>" autocomplete="off">
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Distribution Code"); ?> </label>

				<div class="col-lg-5">
					<input type='text' disabled='disabled' class='form-control' value='<?php echo $shipmentData['shipment']['distribution_code']; ?>' />
				</div>

				<input type="hidden" name="shipmentId" id="shipmentId" value="<?php echo $shipmentData['shipment']['shipment_id']; ?>" class="isRequired" title="Please choose a Scheme Type on the top of this page" />
				<input type="hidden" name="selectedDistribution" id="selectedDistribution" class="" value="<?php echo $this->selectedDistribution; ?>" />

			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Shipment Code"); ?> </label>

				<div class="col-lg-5">
					<input type='text' name="shipmentCode" id="shipmentCode" class='form-control isRequired' value='<?php echo $shipmentData['shipment']['shipment_code']; ?>' title="Please enter the Shipment Code" />
				</div>


			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Result Due Date"); ?></label>

				<div class="col-lg-5">
					<input type='text' readonly='readonly' name="lastDate" id="lastDate" class='form-control datepicker isRequired' value='<?php echo $this->dateFormat($shipmentData['shipment']['lastdate_response']); ?>' title="Please choose the last response date" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label" for="PtCoOrdinatorName"><?= $this->translate->_("PT Co-ordinator Name"); ?></label>

				<div class="col-lg-5"><input type="text" value='<?php echo $shipmentData['shipment']['pt_co_ordinator_name']; ?>' id="PtCoOrdinatorName" name="PtCoOrdinatorName" class="form-control input-sm" title="Please enter the PT Co-ordinator Name" placeholder="Enter the PT Co-ordinator Name" /></div>
			</div>
			<div class="form-group" id="sampleFormFragment">


				<?php
				if ($shipmentData['shipment']['scheme_type'] == 'dts') {
					$possibleResultsOption = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleSyphilisResults = '<select name="possibleSyphilisResults[]" class="form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleRTRIResults = '<select name="possibleRTRIResults[]" class="form-control input-sm"><option value="">--Select--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'DTS_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
							$possibleResultsOption .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
						if ($pr['scheme_sub_group'] == 'DTS_SYP_FINAL') {
							$possibleSyphilisResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					foreach ($this->rtriPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$possibleRTRIResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";

					$eiaChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->eia as $eiaId => $eiaName) {
						$eiaChoices .= '<option value="' . $eiaId . '">' . $eiaName . '</option>';
					}

					$wbChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->wb as $wbId => $wbName) {
						$wbChoices .= '<option value="' . $wbId . '">' . $wbName . '</option>';
					}

					$allEia = array();
					foreach ($shipmentData['eia'] as $eia) {
						$allEia[] = $eia['sample_id'];
					}

					$allWb = array();
					foreach ($shipmentData['wb'] as $wb) {
						$allWb[] = $wb['sample_id'];
					}
					$allRhiv = array();
					foreach ($shipmentData['rhiv'] as $rhiv) {
						$allRhiv[] = $rhiv['sample_id'];
					}
					$allRgeenius = array();
					foreach ($shipmentData['geenius'] as $geenius) {
						$allRgeenius[] = $geenius['sample_id'];
					}

					$dtskit = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->allTestKits as $kitId => $kitName) {
						$dtskit .= '<option value="' . $kitId . '">' . $kitName . '</option>';
					}
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->dtsPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$allowedAlgorithms = isset($this->config->evaluation->dts->allowedAlgorithms) ? explode(",", $this->config->evaluation->dts->allowedAlgorithms) : array();
					$dtsSchemeType = isset($this->config->evaluation->dts->dtsSchemeType) ? $this->config->evaluation->dts->dtsSchemeType : 'standard';

				?>
					<?php if (isset($dtsSchemeType) && !empty($dtsSchemeType) && $dtsSchemeType == 'updated-3-tests') { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label"><?= $this->translate->_("Enable RTRI"); ?></label>

							<div class="col-lg-5">
								<select id="enableRtri" name="enableRtri" class="form-control input-sm" title="Please select a RTRI enable or disabled">
									<option value="">--<?= $this->translate->_("Select"); ?>--</option>
									<option value="yes" <?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php } ?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="dtsSampleType"><?= $this->translate->_("Sample Type"); ?> <span class="mandatory">*</span></label>

						<div class="col-lg-5">
							<select id="dtsSampleType" name="dtsSampleType" class="isRequired form-control" title="Please select a Sample Type">
								<option value="">--<?= $this->translate->_("Select"); ?>--</option>
								<option value="dried" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'dried') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Dried Tube Specimen"); ?></option>
								<option value="serum" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'serum') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Serum"); ?></option>
								<option value="plasma" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'plasma') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Plasma"); ?></option>
							</select>
						</div>
					</div>
					<?php if (!empty($allowedAlgorithms) && in_array('myanmarNationalDtsAlgo', $allowedAlgorithms)) { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label" for="screeningTest"><?= $this->translate->_("Is this a Screening Test Panel?"); ?> <span class="mandatory">*</span><br> <small><?= $this->translate->_("(This creates a panel with only ONE test)"); ?></small></label>

							<div class="col-lg-5">
								<select id="screeningTest" name="screeningTest" class="isRequired form-control" title="Please select if this is a Screening Test">
									<option value=""><?php echo base64_decode("Nw=="); ?>--<?= $this->translate->_("Select"); ?>--</option>
									<option value="yes" <?php echo (isset($shipmentAttribute['screeningTest']) && $shipmentAttribute['screeningTest'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['screeningTest']) && $shipmentAttribute['screeningTest'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php } ?>
					<?php if (!empty($allowedAlgorithms) && in_array('ghanaNationalDtsAlgo', $allowedAlgorithms)) { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label" for="enableSyphilis"><?= $this->translate->_("Enable Syphilis Test for ANC Sites?"); ?> <span class="mandatory">*</span><br> <small><?= $this->translate->_("(This creates a Syphilis panel for all ANC sites)"); ?></small></label>

							<div class="col-lg-5">
								<select id="enableSyphilis" name="enableSyphilis" class="isRequired form-control" title="Please select if this is a Screening Test">
									<option value="">--<?= $this->translate->_("Select"); ?>--</option>
									<option value="yes" <?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php } ?>
					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th class="syphilis-input" style="width:10%;text-align: center;<?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "" : "display:none" ?>;"><?= $this->translate->_("Syphilis Final Result"); ?></th>
								<th class="rtri-input" style="width:10%;text-align: center;<?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') ? "" : "display:none" ?>;"><?= $this->translate->_("RTRI Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<!-- <th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th> -->
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Option"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							$counter = 1;
							if (sizeof($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>';
												<?php foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DTS_FINAL') { ?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php }
												} ?>
											</select>
										</td>
										<td class="syphilis-input" style="<?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "" : "display:none" ?>;">
											<select name="possibleSyphilisResults[]" class="form-control input-sm">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>';
												<?php foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DTS_SYP_FINAL') { ?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['syphilis_reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php }
												} ?>
											</select>
										</td>
										<?php if (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') { ?>
											<td class="rtri-input">
												<select name="possibleRTRIResults[]" class="form-control input-sm">
													<option value="">--<?= $this->translate->_("Select"); ?>--</option>';
													<?php foreach ($this->rtriPossibleResults as $pr) {
														if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') { ?>
															<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['dts_rtri_reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
													<?php }
													} ?>
												</select>
											</td>
										<?php } ?>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<!-- `<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>` -->
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleEia<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
											<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>

											<div id="sampleEia<?php echo $reference['sample_id']; ?>" class="dialog" tabindex="-1" data-width="860">
												<span onClick="hidedefModal()" class="closeModal"></span>
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:10%;text-align: center;">OD</th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allEia)) {
																		$k = 0;
																		foreach ($shipmentData['eia'] as $eia) {
																			if ($eia['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][eia][]"><?php $this->dropdownSelection($this->eia, $eia['eia'], true); ?></select></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>" /></td>
																					<td>
																						<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $eia['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeEiaRow(this,'<?php echo $eia['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][eia][]"><?php echo $eiaChoices; ?></select></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][od][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][cutoff][]" class="form-control" value="" /></td>
																			<td>
																				<select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][result][]">
																					<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			</td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>

												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row" style="overflow-x:scroll;">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="text-align: center;">160</th>
																		<th style="text-align: center;">120</th>
																		<th style="text-align: center;">66</th>
																		<th style="text-align: center;">55</th>
																		<th style="text-align: center;">51</th>
																		<th style="text-align: center;">41</th>
																		<th style="text-align: center;">31</th>
																		<th style="text-align: center;">24</th>
																		<th style="text-align: center;">17</th>
																		<th style="text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allWb)) {
																		$k = 0;

																		foreach ($shipmentData['wb'] as $wb) {

																			if ($wb['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="wb[<?php echo $wb['sample_id']; ?>][wb][]" id="sample<?php echo $wb['sample_id']; ?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb, $wb['wb'], true); ?></select></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>" /></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>" /></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td>
																						<select class="form-control" name="wb[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $wb['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																				$k++;
																			}
																		}
																	} else {
																		?>
																		<tr>

																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" /></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" /></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][result][]">
																					<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>


												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("RAPID HIV TESTING"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Kit Name"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:15%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:5%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allRhiv)) {
																		$k = 0;
																		foreach ($shipmentData['rhiv'] as $rhiv) {
																			if ($rhiv['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="rhiv[<?php echo $rhiv['sample_id']; ?>][kit][]"><?php $this->dropdownSelection($this->allTestKits, $rhiv['testkit'], true); ?></select></td>
																					<td><input type="text" name="rhiv[<?php echo $rhiv['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $rhiv['lot_no']; ?>" /></td>
																					<td><input type="text" name="rhiv[<?php echo $rhiv['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($rhiv['expiry_date']); ?>" /></td>
																					<td>
																						<select class="form-control" name="rhiv[<?php echo $rhiv['sample_id']; ?>][result][]">
																							<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $rhiv['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $rhiv['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeHivRow(this,'<?php echo $rhiv['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="rhiv[<?php echo $reference['sample_id']; ?>][kit][]"><?php echo $dtskit; ?></select></td>
																			<td><input type="text" name="rhiv[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																			<td><input type="text" name="rhiv[<?php echo $reference['sample_id']; ?>'][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																			<td><select class="form-control" name="rhiv[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>

												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("GEENIUS HIV ½ SUPPLEMENTAL ASSAY"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allRgeenius)) {
																		$k = 0;
																		foreach ($shipmentData['geenius'] as $geenius) {
																			$testSelectedResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
																			foreach ($this->dtsPossibleResults as $pr) {
																				if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					$selected = ($pr['id'] == $geenius['result']) ? "selected='selected'" : "";
																					$testSelectedResults .= '<option value="' . $pr['id'] . '" ' . $selected . '>' . $pr['response'] . '</option>';
																				}
																			}
																			if ($geenius['sample_id'] == $reference['sample_id']) { ?>
																				<tr>
																					<td><input type="text" name="geenius[<?php echo $geenius['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $geenius['lot_no']; ?>" /></td>
																					<td><input type="text" name="geenius[<?php echo $geenius['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($geenius['expiry_date']); ?>" /></td>
																					<td>
																						<select class="form-control" name="geenius[<?php echo $geenius['sample_id']; ?>][result][]">
																							<?php echo $testSelectedResults; ?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,<?php echo $geenius['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeGeeniusRow(this,'<?php echo $geenius['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><input type="text" name="geenius[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																			<td><input type="text" name="geenius[<?php echo $reference['sample_id']; ?>'][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																			<td><select class="form-control" name="geenius[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" onclick="closeShipmentModal('sampleEia<?php echo $reference['sample_id']; ?>');return false;" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>
												</div>
											</div>
										</td>
									</tr>

								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<!-- <input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" /> -->
									</td>
									<td>
										<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i><?= $this->translate->_(" EIA"); ?> </a>
										<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = 1;
						$(document).ready(function() {
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>

									addNewEiaBlock('<?php echo $i; ?>');
									addNewWbBlock('<?php echo $i; ?>');

								<?php
									$i++;
								}
							} else { ?>
								addNewEiaBlock(sampleCounter);
								addNewWbBlock(sampleCounter);
							<?php } ?>
						});

						function addDtsRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td> \
									<?php echo $possibleResults; ?> \
								</td>\
								<td class="syphilis-input" style="display:none;"> \
									<?php echo $possibleSyphilisResults; ?> \
								</td>\
								<td class="rtri-input" style="display:none;"> \
									<?php echo $possibleRTRIResults; ?> \
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'sampleEia' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a> \
									<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							if ($("#enableSyphilis").val() == "yes") {
								$("#possibleSyphilisResults").addClass("isRequired")
								$('.syphilis-input').show();
							} else {
								$("#possibleSyphilisResults").removeClass("isRequired")
								$('.syphilis-input').hide();
							}

							if ($("#enableRtri").val() == "yes") {
								$('.rtri-input').show();
							} else {
								$('.rtri-input').hide();
							}
							addNewEiaBlock(sampleCounter);


						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
							$("#enableSyphilis").change(function() {
								if ($(this).val() == "yes") {
									$('.syphilis-input').show();
									$("#possibleSyphilisResults").addClass("isRequired")
								} else {
									$("#possibleSyphilisResults").removeClass("isRequired")
									$('.syphilis-input').hide();
								}
							});

							$("#enableRtri").change(function() {
								if ($(this).val() == "yes") {
									$('.rtri-input').show();
								} else {
									$('.rtri-input').hide();
								}
							});
						});


						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}

						function addNewEiaBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="sampleEia' + sampleId + '" class="closeModal">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("OD"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td>\
									<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td>\
									<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  \
                                   \<div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb[' + sampleId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb[' + sampleId + '][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb[' + sampleId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				     \
				    <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("RAPID HIV TESTING"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;"><?= $this->translate->_("Kit Name"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="rhiv[' + sampleId + '][kit][]"><?php echo $dtskit; ?></select></td>\
									<td><input type="text" name="rhiv[' + sampleId + '][lot][]" class="form-control"/></td>\
									<td><input type="text" name="rhiv[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><select class="form-control" name="rhiv[' + sampleId + '][result][]"><?php echo $possibleResultsOption; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewHivRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
					<div class="modal-footer">\
					<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleEia' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
						}

						function addNewEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td> \
							<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td> \
							<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeEiaRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#sampleEia' + sampleId).remove();
							});
						}

						function addNewWbBlock(sampleWbId) {
							$("#wbBlockHolder").after('<div id="sampleWb' + sampleWbId + '" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});

						}

						function addNewWbRow(obj, sampleWbId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select class="form-control" name="wb[' + sampleId + '][result][]"><?php echo $possibleResultsOption; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,' + sampleWbId + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewHivRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="rhiv[' + sampleId + '][kit][]"><?php echo $dtskit; ?></select></td> \
							<td><input type="text" name="rhiv[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="rhiv[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><select class="form-control" name="rhiv[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewHivRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeHivRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewGeeniusRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><input type="text" name="geenius[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="geenius[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><select class="form-control" name="geenius[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeGeeniusRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeGeeniusRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function removeHivRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function removeWbRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'covid19') {

					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'COVID19_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";

					$covid19TestType = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->allTestTypes as $kitId => $kitName) {
						$covid19TestType .= '<option value="' . $kitId . '">' . $kitName . '</option>';
					}
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->covid19PossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'COVID19_TEST') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

				?>
					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="covid19SampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory"); ?>?</th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th>
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Option"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							$counter = 1;
							if (sizeof($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>';
												<?php
												foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'COVID19_FINAL') {
												?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
													}
												}
												?>
											</select>

										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('typeName<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
											<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php
											}
											?>
										</td>
									</tr>

								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" />
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = $("#covid19SampleTable tbody tr").length;
						$(document).ready(function() {
							$(".datepicker").on("click", function() {
								//$(this).val('');

								$(this).datepicker({
									dateFormat: '<?php echo $dtFormat; ?>'
								})
							});
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) { ?>
									addNewPlatformNameBlock('<?php echo $i; ?>');

								<?php
									$i++;
								}
							} else { ?>
								addNewPlatformNameBlock(sampleCounter);
							<?php } ?>
						});

						function addCovid19Row(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td> \
									<?php echo $possibleResults; ?> \
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'typeName' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a> \
									<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							addNewPlatformNameBlock(sampleCounter);
						}

						function addNewPlatformNameBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="typeName' + sampleId + '" class="dialog">\
							<span onClick="hidedefModal()" class="closeModal"></span>\
							<div class="modal-header">\
								<h4 class="modal-title"> <?= $this->translate->_("COVID-19 TYPE OF TESTING"); ?></h4>\
							</div>\
							<div class="modal-body">\
								<div class="row">\
								<div >\
									<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
										<thead>\
											<tr align="center">\
												<th style="width:20%;text-align: center;"><?= $this->translate->_("Platform Name"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
												<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
												<th style="width:15%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
												<th style="width: 5%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
											</tr>\
										</thead>\
										<tbody>\
											<tr>\
												<td><select class="form-control" name="rtype[' + sampleId + '][type][]"><?php echo $covid19type; ?></select></td>\
												<td><input type="text" name="rtype[' + sampleId + '][lot][]" class="form-control"/></td>\
												<td><input type="text" name="rtype[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
												<td><select class="form-control" name="rtype[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
												<td>\
													<a href="javascript:void(0);" onclick="addCovid19Row(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
												</td>\
											</tr>\
										</tbody>\
									</table>\
								</div>\
								</div>\
							</div>\
												<div class="modal-footer">\
								<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleEia' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
							</div>\
							</div>');
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function removeCovid19Row(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#typeName' + sampleId).remove();
							});
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									addNewPlatformNameBlock('<?php echo $i; ?>');
								<?php
									$i++;
								}
							} else {
								?>
								addNewPlatformNameBlock(sampleCounter);
							<?php
							}
							?>
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});


						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'dbs') {


					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'DBS_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";
					$eiaChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->eia as $eiaId => $eiaName) {
						$eiaChoices .= '<option value="' . $eiaId . '">' . $eiaName . '</option>';
					}

					$wbChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->wb as $wbId => $wbName) {
						$wbChoices .= '<option value="' . $wbId . '">' . $wbName . '</option>';
					}

					$allEia = array();
					foreach ($shipmentData['eia'] as $eia) {
						$allEia[] = $eia['sample_id'];
					}

					$allWb = array();
					foreach ($shipmentData['wb'] as $wb) {
						$allWb[] = $wb['sample_id'];
					}

				?>


					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="dbsSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th>
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php

							$counter = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>';
												<?php
												foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DBS_FINAL') {
												?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
													}
												}
												?>
											</select>

										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>
										<td>
											<a data-toggle="modal" href="#sampleEia<?php echo $reference['sample_id']; ?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i><?= $this->translate->_("EIA"); ?> </a>
											<a data-toggle="modal" href="#sampleWb<?php echo $reference['sample_id']; ?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> <?= $this->translate->_("WB"); ?></a>
											<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeDbsRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php
											}
											?>
										</td>
									</tr>
									<tr style="display: none;">
										<td colspan="6">
											<div id="sampleEia<?php echo $reference['sample_id']; ?>" class="modal fade" tabindex="-1" data-width="860" style="display: none;">
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:10%;text-align: center;">OD</th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allEia)) {
																		$k = 0;
																		foreach ($shipmentData['eia'] as $eia) {
																			if ($eia['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][eia][]"><?php $this->dropdownSelection($this->eia, $eia['eia'], true); ?></select></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>" /></td>
																					<td>
																						<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $eia['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeDbsRow(this,'<?php echo $eia['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][eia][]"><?php echo $eiaChoices; ?></select></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][od][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][cutoff][]" class="form-control" value="" /></td>
																			<td>
																				<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																					<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			</td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
												</div>
											</div>
										</td>
									</tr>
									<tr style="display: none;">
										<td colspan="6">

											<div id="sampleWb<?php echo $reference['sample_id']; ?>" class="modal fade" tabindex="-1" data-width="960" style="display: none;">
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row" style="overflow-x:scroll;">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="text-align: center;">WB</th>
																		<th style="text-align: center;">Lot</th>
																		<th style="text-align: center;">Expiry</th>
																		<th style="text-align: center;">160</th>
																		<th style="text-align: center;">120</th>
																		<th style="text-align: center;">66</th>
																		<th style="text-align: center;">55</th>
																		<th style="text-align: center;">51</th>
																		<th style="text-align: center;">41</th>
																		<th style="text-align: center;">31</th>
																		<th style="text-align: center;">24</th>
																		<th style="text-align: center;">17</th>
																		<th style="text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allWb)) {
																		$k = 0;
																		foreach ($shipmentData['wb'] as $wb) {
																			if ($wb['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="wb[<?php echo $wb['sample_id']; ?>][wb][]" id="sample<?php echo $wb['sample_id']; ?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb, $wb['wb'], true); ?></select></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>" /></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>" /></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td>
																						<select class="form-control" name="wb[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">--<?= $this->translate->_("Select"); ?>--</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $wb['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>


																					<td>
																						<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																				$k++;
																			}
																		}
																	} else {
																		?>
																		<tr>

																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" /></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" /></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>
												</div>
											</div>
										</td>
									</tr>
								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" />
									</td>
									<td>
										<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a>
										<a data-toggle="modal" href="#sampleWb1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB</a>
										<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i><?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = 1;

						$(document).ready(function() {
							$(".datepicker").on("click", function() {
								//$(this).val('');

								$(this).datepicker({
									dateFormat: '<?php echo $dtFormat; ?>'
								})
							});
							sampleCounter = $("#dbsSampleTable tbody tr").length;
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									addNewEiaBlock('<?php echo $i; ?>');
									addNewWbBlock('<?php echo $i; ?>');
								<?php
									$i++;
								}
							} else {
								?>
								addNewEiaBlock(sampleCounter);
								addNewWbBlock(sampleCounter);
							<?php
							}
							?>
						})

						function addDbsRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
					</select> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a data-toggle="modal" href="#sampleEia' + sampleCounter + '" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a> \
					<a data-toggle="modal" href="#sampleWb' + sampleCounter + '" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB </a> \
					<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
					<a href="javascript:void(0);" onclick="removeDbsRow(this,' + sampleCounter + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
							addNewEiaBlock(sampleCounter);
							addNewWbBlock(sampleCounter);

						}

						function addNewEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
									<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td> \
									<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td> \
									<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
									<td> \
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
										<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td> \
								</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewEiaBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="sampleEia' + sampleId + '" class="modal fade" tabindex="-1" data-width="860" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("OD"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td>\
									<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td>\
									<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>\
				  </div>\
				</div>');

						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function removeDbsRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#sampleEia' + sampleId).remove();
							});
						}

						function addNewWbBlock(sampleWbId) {
							$("#wbBlockHolder").after('<div id="sampleWb' + sampleWbId + '" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;overflow:scroll" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;">WB</th>\
									<th style="text-align: center;">Lot</th>\
									<th style="text-align: center;">Expiry</th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});

						}

						function addNewWbRow(obj, sampleWbId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,' + sampleWbId + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeWbRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'eid') {

					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
					}

					$possibleResults .= "</select>";

				?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="methodOfEvaluation"><?= $this->translate->_("Method of Evaluation"); ?></label>

						<div class="col-lg-5">
							<select id="methodOfEvaluation" name="methodOfEvaluation" class="isRequired form-control" title="Please select a Method of Evaluation" style=" margin-bottom: 15px; ">
								<option value="">--<?= $this->translate->_("Select"); ?>--</option>
								<option value="standard" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'standard') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Standard"); ?></option>
								<option value="iso17043" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'iso17043') ? "selected='selected'" : ""; ?>><?= $this->translate->_("ISO/IEC 17043"); ?></option>
							</select>
						</div>
					</div>
					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="width:22%;text-align: center;"><?= $this->translate->_("Results"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("HIV CT/OD"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("IC/QS Values"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:13%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;

							foreach ($shipmentData['reference'] as $reference) {

							?>

								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>

										<select name="possibleResults[]" class="isRequired form-control input-sm">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<?php

											foreach ($shipmentData['possibleResults'] as $pr) {
											?>
												<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
											<?php
											}
											?>
										</select>
									</td>
									<td>
										<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values" title="Please enter the HIV CT/OD values here" value="<?php echo $reference['reference_hiv_ct_od'] ?>" />
									</td>
									<td>
										<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values" title="Please enter the IC/QS Values here" value="<?php echo $reference['reference_ic_qs'] ?>" />
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
										<?php
										if ($counter > 1) {

										?>
											<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
										<?php
										}
										?>
									</td>
								</tr>


							<?php
								$counter++;
							} ?>
						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						function addEidRow(obj) {
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td> \
				<td> \
					<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /> \
				</td>\
				<td> \
					<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
					</select> \
				</td> \
				<td> \
					<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}
					</script>


				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'vl') {

					$vlAssayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->vlAssay as $id => $name) {
						$vlAssayChoices .= '<option value="' . $id . '">' . $name . '</option>';
					}

					$allVlRefMethods = array();
					foreach ($shipmentData['vlReferenceMethods'] as $vlRefMet) {
						$allVlRefMethods[] = $vlRefMet['sample_id'];
					}


				?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="methodOfEvaluation"><?= $this->translate->_("Method of Evaluation"); ?></label>

						<div class="col-lg-5">
							<select id="methodOfEvaluation" name="methodOfEvaluation" class="isRequired form-control" title="Please select a Method of Evaluation" style=" margin-bottom: 15px; ">
								<option value="">--<?= $this->translate->_("Select"); ?>--</option>
								<option value="standard" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'standard') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Standard"); ?></option>
								<option value="iso17043" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'iso17043') ? "selected='selected'" : ""; ?>><?= $this->translate->_("ISO/IEC 17043"); ?></option>
							</select>
						</div>
					</div>
					<table style="width: 850px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;
							//var_dump($shipmentData['vlReferenceMethods']);die;
							foreach ($shipmentData['reference'] as $reference) {

							?>


								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleReferenceResult'+<?php echo $reference['sample_id']; ?>, 900,550);"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
										<a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
										<?php
										if ($counter > 1) {

										?>
											<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
										<?php
										}
										?>

										<div id="sampleReferenceResult<?php echo $reference['sample_id']; ?>" class="dialog">
											<span onClick="hidedefModal()" class="closeModal"></span>
											<div class="modal-header">
												<h4 class="modal-title"><?= $this->translate->_("Reference Results"); ?></h4>
											</div>
											<div class="modal-body">
												<div class="row">
													<div>
														<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
															<thead>
																<tr align="center">
																	<th style="width:50%;text-align: center;">VL Assay</th>
																	<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>
																	<th style="width:15%;text-align: center;"></th>
																</tr>
															</thead>
															<tbody>
																<?php
																if (in_array($reference['sample_id'], $allVlRefMethods)) {
																	$k = 0;
																	foreach ($shipmentData['vlReferenceMethods'] as $vlref) {
																		if ($vlref['sample_id'] == $reference['sample_id']) {
																?>
																			<tr>
																				<td><select class="form-control" name="vlRef[<?php echo $vlref['sample_id']; ?>][assay][]"><?php $this->dropdownSelection($this->vlAssay, $vlref['assay'], true); ?></select></td>
																				<td><input type="text" name="vlRef[<?php echo $vlref['sample_id']; ?>][value][]" class="form-control" value="<?php echo $vlref['value']; ?>" /></td>
																				<td>
																					<a href="javascript:void(0);" onclick="addNewVlRefRow(this,<?php echo $vlref['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																					<?php
																					if ($k > 0) {
																					?>
																						<a href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																					<?php } ?>
																				</td>
																			</tr>
																	<?php
																		}
																		$k++;
																	}
																} else { ?>
																	<tr>
																		<td><select class="form-control" name="vlRef[<?php echo $reference['sample_id']; ?>][assay][]"><?php echo $vlAssayChoices; ?></select></td>
																		<td><input type="text" name="vlRef[<?php echo $reference['sample_id']; ?>][value][]" class="form-control" /></td>
																		<td>
																			<a href="javascript:void(0);" onclick="addNewVlRefRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																		</td>
																	</tr>
																<?php } ?>
															</tbody>
														</table>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-primary" onclick="closeShipmentModal('<?php echo "sampleReferenceResult" . $reference['sample_id']; ?>')"><?= $this->translate->_("OK"); ?></button>
											</div>
										</div>
									</td>
								</tr>


							<?php
								$counter++;
							}

							?>

						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						function addVlRow(obj) {
							$(obj.parentNode.parentNode).after('<tr align="center"> \
												<th><input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" title="Please enter the Sample Name"  placeholder="Please enter the Sample Name" /></th> \
												<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
														<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
													</select> \
												</td> \
												<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
														<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
													</select> \
												</td> \
												<td><a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
											</tr>');
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}


						function addNewReferenceResultBlock(sampleId) {
							$("#sampleReferenceBlockHolder").after('<div id="sampleReferenceResult' + sampleId + '" class="dialog">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title">Reference Results</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:50%;text-align: center;">VL Assay</th>\
									<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>\
									<th style="width:15%;text-align: center;"></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="vlRef[' + sampleId + '][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef[' + sampleId + '][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
						<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleReferenceResult' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
						}

						function addNewVlRefRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr>\
									<td><select class="form-control" name="vlRef[' + sampleId + '][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef[' + sampleId + '][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
										<a  href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td>\
								</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeVlRefRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}
					</script>


				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'tb') {

					$options = "";
					if (isset($this->assay) && !empty($this->assay)) {
						foreach ($this->assay as $row) {
							$options .= '<option value="'.$row['id'].'" data-type="'.$row['assay_type'].'" data-drug="'.$row['drug_resistance_test'].'" data-short="'.$row['short_name'].'">'.ucwords($row['name']).'</option>';
						}
					}
				?>

					<table style="width: 1050px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="tbSampleTable">
						<thead>
							<tr align="center">
								<th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="width:15%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Assay Name"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>
								<th style="text-align: center;vertical-align:middle;">Probe D</th>
								<th style="text-align: center;vertical-align:middle;">Probe C</th>
								<th style="text-align: center;vertical-align:middle;">Probe E</th>
								<th style="text-align: center;vertical-align:middle;">Probe B</th>
								<th style="width:7%;text-align: center;vertical-align:middle;">SPC</th>
								<th style="text-align: center;vertical-align:middle;">Probe A</th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Is it a Control?"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>
								<!-- <th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Score"); ?></th> -->
								<th style="width:5%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;
							foreach ($shipmentData['reference'] as $key => $reference) { ?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<select class="form-control vlResultValues isRequired" name="assayName[]" id="assayName" title="Please select the assay name" onchange="loadOtherAssay(this, <?php echo ($key+1);?>);">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<?php if (isset($this->assay) && !empty($this->assay)) {
												foreach ($this->assay as $row) { ?>
													<option value="<?php echo $row['id']; ?>" data-type="<?php echo $row['assay_type']; ?>" data-drug="<?php echo $row['drug_resistance_test']; ?>" data-short="<?php echo $row['short_name']; ?>" <?php if (isset($reference['assay_name']) && $reference['assay_name'] == $row['id']) echo " selected "; ?>><?php echo ucwords($row['name']); ?></option>
											<?php }
											} ?>
										</select>
										<input type="text" name="otherAssay[]" class="form-control input-sm other-assay-<?php echo ($key+1);?>" title="Please enter the other assay" placeholder="Other assay" style="display:none;"/>
									</td>
									<td>
										<select name="mtbDetected[]" class="isRequired form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="detected" <?php echo ($reference['mtb_detected'] == 'detected' ? "selected='selected'" : ""); ?>>Detected</option>
											<option value="not-detected" <?php echo ($reference['mtb_detected'] == 'not-detected' ? "selected='selected'" : ""); ?>>Not Detected</option>
											<option value="invalid" <?php echo ($reference['mtb_detected'] == 'invalid' ? "selected='selected'" : ""); ?>>Invalid</option>
											<option value="error" <?php echo ($reference['mtb_detected'] == 'error' ? "selected='selected'" : ""); ?>>Error</option>
										</select>
									</td>
									<td>
										<select name="rifResistance[]" class="isRequired form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="na" <?php echo ($reference['rif_resistance'] == 'na' ? "selected='selected'" : ""); ?>>N/A</option>
											<option value="detected" <?php echo ($reference['rif_resistance'] == 'detected' ? "selected='selected'" : ""); ?>>Detected</option>
											<option value="not-detected" <?php echo ($reference['rif_resistance'] == 'notDetected' ? "selected='selected'" : ""); ?>>Not Detected</option>
											<option value="indeterminate" <?php echo ($reference['rif_resistance'] == 'indeterminate' ? "selected='selected'" : ""); ?>>Indeterminate</option>
											<option value="testing-not-performed" <?php echo ($reference['rif_resistance'] == 'testing-not-performed' ? "selected='selected'" : ""); ?>>Testing NOT Performed</option>

										</select>
									</td>
									<td>
										<input type="text" name="probeD[]" class="form-control input-sm oneDecimal" title="Please enter the Probe D value for this sample" placeholder="Please enter the Probe D value for this sample" value="<?php echo $reference['probe_d']; ?>" />
									</td>
									<td>
										<input type="text" name="probeC[]" class="form-control input-sm oneDecimal" title="Please enter the Probe C value for this sample" placeholder="Please enter the Probe C value for this sample" value="<?php echo $reference['probe_c']; ?>" />
									</td>
									<td>
										<input type="text" name="probeE[]" class="form-control input-sm oneDecimal" title="Please enter the Probe E value for this sample" placeholder="Please enter the Probe E value for this sample" value="<?php echo $reference['probe_e']; ?>" />
									</td>
									<td>
										<input type="text" name="probeB[]" class="form-control input-sm oneDecimal" title="Please enter the Probe B value for this sample" placeholder="Please enter the Probe B value for this sample" value="<?php echo $reference['probe_b']; ?>" />
									</td>
									<td>
										<input type="text" name="spc[]" class="form-control input-sm oneDecimal" title="Please enter the SPC value for this sample" placeholder="Please enter the SPC value for this sample" value="<?php echo $reference['spc']; ?>" />
									</td>
									<td>
										<input type="text" name="probeA[]" class="form-control input-sm oneDecimal" title="Please enter the Probe A value for this sample" placeholder="Please enter the Probe A value for this sample" value="<?php echo $reference['probe_a']; ?>" />
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<!-- <td>
										<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
									</td> -->
									<td>
										<a href="javascript:void(0);" onclick="addTbRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
										<?php
										if ($counter > 1) {

										?>
											<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
										<?php
										}
										?>
									</td>
								</tr>


							<?php
								$counter++;
							}

							?>

						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						var sampleCounter = $("#tbSampleTable tbody tr").length;
						function loadOtherAssay(obj, row){
							let _short = $(obj).find(':selected').data('short');

							if(_short == 'other'){
								$('.other-assay-'+row).show();
								$('.other-assay-'+row).addClass('isRequired');
							}else{
								$('.other-assay-'+row).hide();
								$('.other-assay-'+row).removeClass('isRequired');
							}
						}

						function addTbRow(obj) {
							sampleCounter++;
	
							var html = '<tr align="center"> \
								<th> \
									<input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /> \
								</th> \
								<td> \
									<select class="form-control vlResultValues isRequired" name="assayName[]" id="assayName" title="Please select the assay name" onchange="loadOtherAssay(this, '+sampleCounter+');"> \
										<option value="">--Select--</option>';
									html = html + '<?php echo $options;?>';
									html = html + '</select> \
									<input type="text" name="otherAssay[]" class="form-control input-sm other-assay-'+sampleCounter+'" title="Please enter the other assay" placeholder="Other assay" style="display:none;"/>\
								</td> \
								<td> \
									<select name="mtbDetected[]" class="isRequired form-control input-sm"  title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample"> \
										<option value="">-- <?= $this->translate->_("Select"); ?> --</option> \
										<option value="detected">Detected</option>\
										<option value="not-detected">Not Detected</option>\
										<option value="invalid">Invalid</option>\
										<option value="error">Error</option>\
									</select> \
								</td> \
								<td> \
									<select name="rifResistance[]" class="isRequired form-control input-sm"  title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample"> \
										<option value="">-- <?= $this->translate->_("Select"); ?> --</option> \
										<option value="na">N/A</option>\
										<option value="detected">Detected</option>\
										<option value="not-detected">Not Detected</option>\
										<option value="indeterminate">Indeterminate</option>\
										<option value="testing-not-performed">Testing NOT Performed</option> \
									</select> \
								</td> \
								<td> \
									<input type="text" name="probeD[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe D value for this sample" placeholder="Please enter the Probe D value for this sample" /> \
								</td> \
								<td> \
									<input type="text" name="probeC[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe C value for this sample" placeholder="Please enter the Probe C value for this sample" /> \
								</td> \
								<td> \
									<input type="text" name="probeE[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe E value for this sample" placeholder="Please enter the Probe E value for this sample" /> \
								</td> \
								<td> \
									<input type="text" name="probeB[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe B value for this sample" placeholder="Please enter the Probe B value for this sample" /> \
								</td> \
								<td> \
									<input type="text" name="spc[]" class="form-control input-sm oneDecimal"  title="Please enter the SPC value for this sample" placeholder="Please enter the SPC value for this sample" /> \
								</td> \
								<td> \
									<input type="text" name="probeA[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe A value for this sample" placeholder="Please enter the Probe A value for this sample" /> \
								</td> \
								<td> \
									<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option> \
										<option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option> \
										<option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><a href="javascript:void(0);" onclick="addTbRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
							</tr>';
							$(obj.parentNode.parentNode).after(html);
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}
					</script>


				<?php
				} else if ($shipmentData['shipment']['scheme_type'] == 'recency') {
					$assayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyAssay as $assayId => $assayName) {
						$assayChoices .= '<option value="' . $assayId . '">' . $assayName . '</option>';
					}
					$allRecencyAssay = array();
					foreach ($shipmentData['recencyAssay'] as $recencyAssay) {
						$allRecencyAssay[] = $recencyAssay['sample_id'];
					}
					$assayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyAssay as $assayId => $assayName) {
						$assayChoices .= '<option value="' . $assayId . '">' . $assayName . '</option>';
					}
					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}
					$possibleResults .= "</select>";
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

				?>

					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="width:22%;text-align: center;"><?= $this->translate->_("Results"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Verification Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Longterm Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:13%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							if (isset($shipmentData['reference']) && count($shipmentData['reference']) > 0) {

								$counter = 1;
								foreach ($shipmentData['reference'] as $reference) { ?>

									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>

											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<?php

												foreach ($shipmentData['possibleResults'] as $pr) {
												?>
													<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
												}
												?>
											</select>
										</td>
										<td>
											<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="present" <?php echo ($reference['reference_control_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_control_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="present" <?php echo ($reference['reference_diagnosis_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_diagnosis_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="present" <?php echo ($reference['reference_longterm_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_longterm_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">--<?= $this->translate->_("Select"); ?>--</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleAssay<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a>
											<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
											<?php if ($counter > 1) { ?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>
										</td>
									</tr>
								<?php
									$counter++;
								}
							} else { ?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">--<?= $this->translate->_("Select"); ?>--</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleAssay1', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
										<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<?php if (isset($shipmentData['reference']) && count($shipmentData['reference']) > 0) {
						$counter = 1;
						foreach ($shipmentData['reference'] as $reference) { ?>
							<div id="recencyAssayBlockHolder">
								<div id="sampleAssay<?php echo $reference['sample_id']; ?>" class="dialog">
									<span onClick="hidedefModal()" class="closeModal"></span>
									<div class="modal-header">
										<h4 class="modal-title"><?= $this->translate->_("Assay"); ?></h4>
									</div>
									<div class="modal-body">
										<div class="row">
											<div>
												<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
													<thead>
														<tr align="center">
															<th style="width:20%;text-align: center;"><?= $this->translate->_("Recency Assay"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
															<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
														</tr>
													</thead>
													<tbody>
														<?php
														if (in_array($reference['sample_id'], $allRecencyAssay)) {
															$k = 0;
															foreach ($shipmentData['recencyAssay'] as $recencyAssay) {
																$testSelectedResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
																foreach ($this->recencyPossibleResults as $pr) {
																	if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
																		$selected = ($pr['id'] == $recencyAssay['result']) ? "selected='selected'" : "";
																		$testSelectedResults .= '<option value="' . $pr['id'] . '" ' . $selected . '>' . $pr['response'] . '</option>';
																	}
																}
																if ($recencyAssay['sample_id'] == $reference['sample_id']) { ?>
																	<tr>
																		<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][assay][]"><?php $this->dropdownSelection($this->recencyAssay, $recencyAssay['assay'], true); ?></select></td>
																		<td><input type="text" name="assay[<?php echo $recencyAssay['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $recencyAssay['lot_no']; ?>" /></td>
																		<td><input type="text" name="assay[<?php echo $recencyAssay['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($recencyAssay['expiry_date']); ?>" /></td>
																		<td>
																			<select class="form-control" name="assay[<?php echo $recencyAssay['sample_id']; ?>][result][]">
																				<?php echo $testSelectedResults; ?>
																			</select>
																		</td>
																		<td>
																			<a href="javascript:void(0);" onclick="addNewAssayRow(this,<?php echo $recencyAssay['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			<?php
																			if ($k > 0) {
																			?>
																				<a href="javascript:void(0);" onclick="removeAssayRow(this,'<?php echo $recencyAssay['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																			<?php } ?>
																		</td>
																	</tr>
															<?php }
																$k++;
															}
														} else { ?>
															<tr>
																<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][assay][]"><?php echo $assayChoices; ?></select></td>
																<td><input type="text" name="assay[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																<td><input type="text" name="assay[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																<td>
																	<a href="javascript:void(0);" onclick="addNewAssayRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																</td>
															</tr>
														<?php } ?>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-primary" onclick="closeShipmentModal('sampleAssay<?php echo $reference['sample_id']; ?>')"><?= $this->translate->_("OK"); ?></button>
									</div>
								</div>
							</div> <!-- recencyAssayBlockHolder -->
						<?php }
					} else { ?>
						<div id="recencyAssayBlockHolder">
						</div> <!-- recencyAssayBlockHolder -->
					<?php } ?>
					<script type="text/javascript">
						var sampleCounter = 1;

						function addRecencyRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td> \
									<?php echo $possibleResults; ?> \
								</td> \
								<td>\
									<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">\
										<option value="">--<?= $this->translate->_("Select"); ?>--</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td>\
									<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">\
										<option value="">--<?= $this->translate->_("Select"); ?>--</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td>\
									<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">\
										<option value="">--<?= $this->translate->_("Select"); ?>--</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="">--<?= $this->translate->_("Select"); ?>--</option><option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'sampleAssay' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>\
									<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							addNewAssayBlock(sampleCounter);
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function addNewAssayBlock(sampleId) {
							$("#recencyAssayBlockHolder").after('<div id="sampleAssay' + sampleId + '" class="dialog">\
								<span onClick="hidedefModal()" class="closeModal"></span>\
								<div class="modal-header">\
									<h4 class="modal-title"><?= $this->translate->_("Assay"); ?></h4>\
								</div>\
								<div class="modal-body">\
									<div class="row">\
										<div >\
										<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
											<thead>\
												<tr align="center">\
													<th style="width:20%;text-align: center;"><?= $this->translate->_("Recency Assay"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
													<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
												</tr>\
											</thead>\
											<tbody>\
												<tr>\
													<td><select class="form-control" name="assay[' + sampleId + '][assay][]"><?php echo $assayChoices; ?></select></td>\
													<td><input type="text" name="assay[' + sampleId + '][lot][]" class="form-control"/></td>\
													<td><input type="text" name="assay[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
													<td><select class="form-control" name="assay[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
													<td>\
														<a href="javascript:void(0);" onclick="addNewAssayRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
													</td>\
												</tr>\
											</tbody>\
										</table>\
										</div>\
									</div>\
									</div>\
									<div class="modal-footer">\
										<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleAssay' + sampleId + '\')">OK</button>\
									</div>\
								</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewAssayRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
								<td><select class="form-control" name="assay[' + sampleId + '][assay][]"><?php echo $assayChoices; ?></select></td> \
								<td><input type="text" name="assay[' + sampleId + '][lot][]" class="form-control"/></td> \
								<td><input type="text" name="assay[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
								<td><select class="form-control" name="assay[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
								<td> \
									<a href="javascript:void(0);" onclick="addNewAssayRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
									<a  href="javascript:void(0);" onclick="removeAssayRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeAssayRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleEia'+sampleId).remove();
							});
						}

						$(document).ready(function() {
							<?php if (!isset($shipmentData['reference']) && count($shipmentData['reference']) == 0) { ?>
								addNewAssayBlock('1');
							<?php } ?>
							//addNewWbBlock('1');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}

						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}
					</script>


				<?php } ?>

			</div>

			<div style="margin: 0px auto 0px auto; text-align: center;" align="center">
				<input name="submitbtn" class="btn btn-primary btn-sm" type="button" onclick="validateNow();return false;" tabindex="7" value="Update Shipment" />
				<input class="btn btn-danger btn-sm" type="button" onclick="window.history.go(-1);" tabindex="8" value="Cancel" />
			</div>
		</form>
	</fieldset>
</div>

<script>
	var duplicated = false;

	function checkDuplicate(tableName, fieldName, obj, fnct, msg) {
		if (obj.val() == "" || obj.val() == null) {
			return;
		}
		$.post("<?php echo $this->url(array('module' => 'default', 'controller' => 'common', 'action' => 'check-duplicate')); ?>", {
				tableName: tableName,
				fieldName: fieldName,
				value: obj.val(),
				fnct: fnct,
				format: "html"
			},
			function(data) {
				if (data > 0) {
					alert(msg, "err");
					duplicated = true;
					obj.focus();
				} else {
					duplicated = false;
				}
			});
	}


	<?php
	$vHelper = $this->getHelper('DateFormat');
	$dtFormat =  $vHelper->getDateFormat();
	?>
	$(document).ready(function() {
		$(".datepicker").datepicker({
			dateFormat: '<?php echo $dtFormat; ?>'
		});

		$('#shipmentCode').on('input', function(event) {
			allowOnlyAlphaNumericAndHyphen('#shipmentCode');
		});
		$("body").on("change", 'select.controlOrNot', function() {
			var scoreElem = $(this).parent().parent().find('.score');
			if ($(this).val() == 1) {
				$(scoreElem).val(0);
				$(scoreElem).attr('readonly', 'readonly');
			} else {
				$(scoreElem).removeAttr('readonly');
			}

		});
	});



	function validateNow() {
		allowOnlyAlphaNumericAndHyphen('#shipmentCode');
		//checkDuplicate('shipment', 'shipment_code', $("#shipmentCode"), '<?php echo "shipment_id##" . $shipmentData['shipment']['shipment_id']; ?>', 'This Code already exists for another Shipment. Please try something else.')
		flag = deforayValidator.init({
			formId: 'shipmentForm'
		});
		if (flag && !duplicated) {
			$.blockUI();
			document.getElementById('shipmentForm').submit();
		}
	}
</script>