<?php

$shipmentData = $this->shipmentData;
// Zend_Debug::dump($shipmentData['recencyAssay']);die;
$shipmentAttribute = json_decode($shipmentData['shipment']['shipment_attributes'], true);
$vHelper = $this->getHelper('DateFormat');
$dtFormat =  $vHelper->getDateFormat();
$style = '';
if ($shipmentData['shipment']['scheme_type'] == 'tb') {
	$style = 'style=" width: 1550px; margin-left: -208px; "';
}
?>

<style type="text/css">
	.modal-scrollable {
		z-index: 1000 !important;

	}

	.modal-backdrop {
		z-index: 900 !important;
	}

	#mbd {
		overflow-y: scroll;
		max-height: 100%;
	}

	thead tr th {
		text-align: center;
	}
</style>
<div class="well" <?php echo $style; ?>>
	<fieldset>
		<legend><?= $this->translate->_("Update Shipment Sample Details"); ?> - <?php echo $shipmentData['shipment']['shipment_code']; ?></legend>
		<form class="form-horizontal" name="shipmentForm" id="shipmentForm" method="post" action="<?php echo $this->url(array('module' => 'admin', 'controller' => 'shipment', 'action' => 'edit')); ?>" autocomplete="off">
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Distribution Code"); ?> </label>

				<div class="col-lg-5">
					<input type='text' disabled='disabled' class='form-control' value='<?php echo $shipmentData['shipment']['distribution_code']; ?>' />
				</div>

				<input type="hidden" name="shipmentId" id="shipmentId" value="<?php echo $shipmentData['shipment']['shipment_id']; ?>" class="isRequired" title="Please choose a Scheme Type on the top of this page" />
				<input type="hidden" name="selectedDistribution" id="selectedDistribution" class="" value="<?php echo $this->selectedDistribution; ?>" />

			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Shipment Code"); ?> </label>
				<div class="col-lg-5">
					<input type='text' name="shipmentCode" id="shipmentCode" class='form-control isRequired' value='<?php echo $shipmentData['shipment']['shipment_code']; ?>' title="Please enter the Shipment Code" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label"><?= $this->translate->_("Result Due Date"); ?></label>

				<div class="col-lg-5">
					<input type='text' readonly='readonly' name="lastDate" id="lastDate" class='form-control datepicker isRequired' value='<?php echo $this->dateFormat($shipmentData['shipment']['lastdate_response']); ?>' title="Please choose the last response date" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label" for="allowEditingResponse"><?= $this->translate->_("Allow Editing Response"); ?> <span class="mandatory">*</span></label>
				<div class="col-lg-5">
					<select id="allowEditingResponse" name="allowEditingResponse" class="isRequired form-control input-sm" title="Please select a allow editing response yes/no">
						<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
						<option value="yes" <?php echo (isset($shipmentData['shipment']['allow_editing_response']) && $shipmentData['shipment']['allow_editing_response'] == 'yes') ? 'selected="selected"' : ''; ?>>Yes</option>
						<option value="no" <?php echo (isset($shipmentData['shipment']['allow_editing_response']) && $shipmentData['shipment']['allow_editing_response'] == 'no') ? 'selected="selected"' : ''; ?>>No</option>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label" for="issuingAuthority"><?= $this->translate->_("Issuing Authority"); ?></label>
				<div class="col-lg-5"><input type="text" value='<?php echo $shipmentData['shipment']['issuing_authority']; ?>' id="issuingAuthority" name="issuingAuthority" class="form-control input-sm" title="Please enter the issuing authority" placeholder="Enter the issuing authority" /></div>
			</div>
			<div class="form-group">
				<label class="col-lg-3 control-label" for="PtCoOrdinatorName"><?= $this->translate->_("PT Co-ordinator Name"); ?></label>
				<div class="col-lg-5"><input type="text" value='<?php echo $shipmentData['shipment']['pt_co_ordinator_name']; ?>' id="PtCoOrdinatorName" name="PtCoOrdinatorName" class="form-control input-sm" title="Please enter the PT Co-ordinator Name" placeholder="Enter the PT Co-ordinator Name" /></div>
			</div>
			<?php if (isset($this->reportType) && !empty($this->reportType) && $this->reportType == 'malawi') { ?>
				<div class="form-group">
					<label class="col-lg-3 control-label"><?= $this->translate->_("PT Co-ordinator Email"); ?></label>
					<div class="col-lg-5">
						<input type="text" value='<?php echo $shipmentData['shipment']['pt_co_ordinator_email']; ?>' name="ptEmail" id="ptEmail" placeholder="Enter PT Co-ordinator email" title="Please enter the PT Co-ordinator email" class="form-control input-sm isEmail" />
					</div>
				</div>
				<div class="form-group">
					<label class="col-lg-3 control-label"><?= $this->translate->_("PT Co-ordinator Phone Number"); ?></label>
					<div class="col-lg-5">
						<input type="text" value='<?php echo $shipmentData['shipment']['pt_co_ordinator_phone']; ?>' name="ptPhone" id="ptPhone" placeholder="Enter PT Co-ordinator phone number" title="Please enter the PT Co-ordinator phone number" class="form-control input-sm isNumeric" />
					</div>
				</div>
			<?php } ?>
			<div id="sampleFormFragment">
				<?php if ($shipmentData['shipment']['scheme_type'] == 'dts') {
					$possibleResultsOption = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleSyphilisResults = '<select name="possibleSyphilisResults[]" class="form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					$possibleRTRIResults = '<select name="possibleRTRIResults[]" class="form-control input-sm"><option value="">--Select--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'DTS_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
							$possibleResultsOption .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
						if ($pr['scheme_sub_group'] == 'DTS_SYP_FINAL') {
							$possibleSyphilisResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					foreach ($this->rtriPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$possibleRTRIResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";

					$eiaChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->eia as $eiaId => $eiaName) {
						$eiaChoices .= '<option value="' . $eiaId . '">' . $eiaName . '</option>';
					}

					$wbChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->wb as $wbId => $wbName) {
						$wbChoices .= '<option value="' . $wbId . '">' . $wbName . '</option>';
					}

					$allEia = [];
					foreach ($shipmentData['eia'] as $eia) {
						$allEia[] = $eia['sample_id'];
					}

					$allWb = [];
					foreach ($shipmentData['wb'] as $wb) {
						$allWb[] = $wb['sample_id'];
					}
					$allRhiv = [];
					foreach ($shipmentData['rhiv'] as $rhiv) {
						$allRhiv[] = $rhiv['sample_id'];
					}
					$allRgeenius = [];
					foreach ($shipmentData['geenius'] as $geenius) {
						$allRgeenius[] = $geenius['sample_id'];
					}

					$dtskit = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->allTestKits as $kitId => $kitName) {
						$dtskit .= '<option value="' . $kitId . '">' . $kitName . '</option>';
					}
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->dtsPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$allowedAlgorithms = isset($this->config->evaluation->dts->allowedAlgorithms) ? explode(",", $this->config->evaluation->dts->allowedAlgorithms) : array();
					$dtsSchemeType = isset($this->config->evaluation->dts->dtsSchemeType) ? $this->config->evaluation->dts->dtsSchemeType : 'standard';
					$rtriEnabled = isset($this->config->evaluation->dts->rtriEnabled) ? $this->config->evaluation->dts->rtriEnabled : 'no';

					if (isset($dtsSchemeType) && !empty($dtsSchemeType) && $dtsSchemeType == 'updated-3-tests' && isset($rtriEnabled) && !empty($rtriEnabled) && $rtriEnabled == 'yes') { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label"><?= $this->translate->_("Enable RTRI"); ?></label>

							<div class="col-lg-5">
								<select id="enableRtri" name="enableRtri" class="form-control input-sm" title="Please select a RTRI enable or disabled">
									<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
									<option value="yes" <?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php }  ?>


					<div class="form-group">
						<label class="col-lg-3 control-label" for="dtsSampleType"><?= $this->translate->_("Sample Type"); ?> <span class="mandatory">*</span></label>

						<div class="col-lg-5">
							<select id="dtsSampleType" name="dtsSampleType" class="isRequired form-control" title="Please select a Sample Type">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value="dried" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'dried') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Dried Tube Specimen"); ?></option>
								<option value="serum" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'serum') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Serum"); ?></option>
								<option value="plasma" <?php echo (isset($shipmentAttribute['sampleType']) && $shipmentAttribute['sampleType'] == 'plasma') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Plasma"); ?></option>
							</select>
						</div>
					</div>
					<?php
					if (isset($dtsSchemeType) && !empty($dtsSchemeType) && $dtsSchemeType == "ghana") { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label" for="enableSyphilis"><?= $this->translate->_("Enable Syphilis Test for ANC Sites?"); ?> <span class="mandatory">*</span><br> <small><?= $this->translate->_("(This creates a Syphilis panel for all ANC sites)"); ?></small></label>

							<div class="col-lg-5">
								<select id="enableSyphilis" name="enableSyphilis" class="isRequired form-control" title="Please select if this is a Screening Test">
									<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
									<option value="yes" <?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php }
					if (isset($dtsSchemeType) && !empty($dtsSchemeType) && ($dtsSchemeType == "standard" || $dtsSchemeType == "malawi")) { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label"><?= $this->translate->_("No. of tests in this Test Panel"); ?> <span class="mandatory">*</span></label>

							<div class="col-lg-5">
								<select id="noOfTestsInPanel" name="noOfTestsInPanel" class="isRequired form-control input-sm" title="Please select no. of tests in this panel">
									<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
									<option value="2" <?php echo (isset($shipmentAttribute['noOfTestsInPanel']) && $shipmentAttribute['noOfTestsInPanel'] == '2') ? "selected='selected'" : ""; ?>>2</option>
									<option value="3" <?php echo (isset($shipmentAttribute['noOfTestsInPanel']) && $shipmentAttribute['noOfTestsInPanel'] == '3') ? "selected='selected'" : ""; ?>>3</option>
								</select>
							</div>
						</div>
					<?php } ?>

					<div class="form-group">
						<label class="col-lg-3 control-label" for="screeningTest"><?= $this->translate->_("Is this ONLY Screening Test Panel?"); ?> <span class="mandatory">*</span><br> <small><?= $this->translate->_("(This creates a panel with only ONE test)"); ?></small></label>

						<div class="col-lg-5">
							<select id="screeningTest" name="screeningTest" class="isRequired form-control" title="Please select if this is a Screening Test" onchange="screeningTestPanel(this.value)">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value="yes" <?php echo (isset($shipmentAttribute['screeningTest']) && $shipmentAttribute['screeningTest'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
								<option value="no" <?php echo (isset($shipmentAttribute['screeningTest']) && $shipmentAttribute['screeningTest'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
							</select>
						</div>
					</div>
					<?php
					if (isset($dtsSchemeType) && !empty($dtsSchemeType) && $dtsSchemeType == 'updated-3-tests') {
					?>
						<div class="form-group dtsTestPanelType" style="<?php echo (isset($shipmentAttribute['screeningTest']) && $shipmentAttribute['screeningTest'] == 'no') ? '' : 'display:none;'; ?>">
							<label class="col-lg-3 control-label" for="dtsTestPanelType"><?= $this->translate->_("Allow users to Choose Screening/Confirmatory"); ?> </label>

							<div class="col-lg-5">
								<select id="dtsTestPanelType" name="dtsTestPanelType" class="form-control input-sm" title="Please Allow users to Choose Screening/Confirmatory"">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value=" yes" <?php echo (isset($shipmentAttribute['dtsTestPanelType']) && $shipmentAttribute['dtsTestPanelType'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentAttribute['dtsTestPanelType']) && $shipmentAttribute['dtsTestPanelType'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php
					}
					?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="collectQcData"><?= $this->translate->_("Collect QC Data"); ?> </label>
						<div class="col-lg-5">
							<select id="collectQcData" name="collectQcData" class="form-control input-sm" title="Please select Collect QC Data"">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value=" yes" <?php echo (isset($shipmentAttribute['collect_qc_data']) && $shipmentAttribute['collect_qc_data'] == 'yes') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
								<option value="no" <?php echo (isset($shipmentAttribute['collect_qc_data']) && $shipmentAttribute['collect_qc_data'] == 'no') ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
							</select>
						</div>
					</div>
					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th class="syphilis-input" style="width:10%;text-align: center;<?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "" : "display:none" ?>;"><?= $this->translate->_("Syphilis Final Result"); ?></th>
								<th class="rtri-input" style="width:10%;text-align: center;<?php echo (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') ? "" : "display:none" ?>;"><?= $this->translate->_("RTRI Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<!-- <th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th> -->
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Option"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							$counter = 1;
							if (sizeof($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>';
												<?php foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DTS_FINAL') { ?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php }
												} ?>
											</select>
										</td>
										<td class="syphilis-input" style="<?php echo (isset($shipmentAttribute['enableSyphilis']) && $shipmentAttribute['enableSyphilis'] == 'yes') ? "" : "display:none" ?>;">
											<select name="possibleSyphilisResults[]" class="form-control input-sm">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>';
												<?php foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DTS_SYP_FINAL') { ?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['syphilis_reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php }
												} ?>
											</select>
										</td>
										<?php if (isset($shipmentAttribute['enableRtri']) && $shipmentAttribute['enableRtri'] == 'yes') { ?>
											<td class="rtri-input">
												<select name="possibleRTRIResults[]" class="form-control input-sm">
													<option value="">-- <?= $this->translate->_("Select"); ?> --</option>';
													<?php foreach ($this->rtriPossibleResults as $pr) {
														if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') { ?>
															<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['dts_rtri_reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
													<?php }
													} ?>
												</select>
											</td>
										<?php } ?>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<!-- `<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>` -->
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleEia<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
											<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>

											<div id="sampleEia<?php echo $reference['sample_id']; ?>" class="dialog" tabindex="-1" data-width="860">
												<span onClick="hidedefModal()" class="closeModal"></span>
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:10%;text-align: center;">OD</th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allEia)) {
																		$k = 0;
																		foreach ($shipmentData['eia'] as $eia) {
																			if ($eia['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][eia][]"><?php $this->dropdownSelection($this->eia, $eia['eia'], true); ?></select></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>" /></td>
																					<td>
																						<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $eia['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeEiaRow(this,'<?php echo $eia['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][eia][]"><?php echo $eiaChoices; ?></select></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][od][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][cutoff][]" class="form-control" value="" /></td>
																			<td>
																				<select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][result][]">
																					<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			</td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>

												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row" style="overflow-x:scroll;">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="text-align: center;">160</th>
																		<th style="text-align: center;">120</th>
																		<th style="text-align: center;">66</th>
																		<th style="text-align: center;">55</th>
																		<th style="text-align: center;">51</th>
																		<th style="text-align: center;">41</th>
																		<th style="text-align: center;">31</th>
																		<th style="text-align: center;">24</th>
																		<th style="text-align: center;">17</th>
																		<th style="text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allWb)) {
																		$k = 0;

																		foreach ($shipmentData['wb'] as $wb) {

																			if ($wb['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="wb[<?php echo $wb['sample_id']; ?>][wb][]" id="sample<?php echo $wb['sample_id']; ?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb, $wb['wb'], true); ?></select></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>" /></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>" /></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td>
																						<select class="form-control" name="wb[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $wb['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																				$k++;
																			}
																		}
																	} else {
																		?>
																		<tr>

																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" /></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" /></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][result][]">
																					<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>


												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("RAPID HIV TESTING"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Kit Name"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:15%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:5%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allRhiv)) {
																		$k = 0;
																		foreach ($shipmentData['rhiv'] as $rhiv) {
																			if ($rhiv['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="rhiv[<?php echo $rhiv['sample_id']; ?>][kit][]"><?php $this->dropdownSelection($this->allTestKits, $rhiv['testkit'], true); ?></select></td>
																					<td><input type="text" name="rhiv[<?php echo $rhiv['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $rhiv['lot_no']; ?>" /></td>
																					<td><input type="text" name="rhiv[<?php echo $rhiv['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($rhiv['expiry_date']); ?>" /></td>
																					<td>
																						<select class="form-control" name="rhiv[<?php echo $rhiv['sample_id']; ?>][result][]">
																							<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $rhiv['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $rhiv['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeHivRow(this,'<?php echo $rhiv['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="rhiv[<?php echo $reference['sample_id']; ?>][kit][]"><?php echo $dtskit; ?></select></td>
																			<td><input type="text" name="rhiv[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																			<td><input type="text" name="rhiv[<?php echo $reference['sample_id']; ?>'][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																			<td><select class="form-control" name="rhiv[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>

												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("GEENIUS HIV ½ SUPPLEMENTAL ASSAY"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:25%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allRgeenius)) {
																		$k = 0;
																		foreach ($shipmentData['geenius'] as $geenius) {
																			$testSelectedResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
																			foreach ($this->dtsPossibleResults as $pr) {
																				if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					$selected = ($pr['id'] == $geenius['result']) ? "selected='selected'" : "";
																					$testSelectedResults .= '<option value="' . $pr['id'] . '" ' . $selected . '>' . $pr['response'] . '</option>';
																				}
																			}
																			if ($geenius['sample_id'] == $reference['sample_id']) { ?>
																				<tr>
																					<td><input type="text" name="geenius[<?php echo $geenius['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $geenius['lot_no']; ?>" /></td>
																					<td><input type="text" name="geenius[<?php echo $geenius['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($geenius['expiry_date']); ?>" /></td>
																					<td>
																						<select class="form-control" name="geenius[<?php echo $geenius['sample_id']; ?>][result][]">
																							<?php echo $testSelectedResults; ?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,<?php echo $geenius['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeGeeniusRow(this,'<?php echo $geenius['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><input type="text" name="geenius[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																			<td><input type="text" name="geenius[<?php echo $reference['sample_id']; ?>'][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																			<td><select class="form-control" name="geenius[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" onclick="closeShipmentModal('sampleEia<?php echo $reference['sample_id']; ?>');return false;" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>
												</div>
											</div>
										</td>
									</tr>

								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="0"><?= $this->translate->_("No"); ?></option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>

										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<!-- <input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" /> -->
									</td>
									<td>
										<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i><?= $this->translate->_("EIA"); ?> </a>
										<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = 1;
						$(document).ready(function() {
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>

									addNewEiaBlock('<?php echo $i; ?>');
									addNewWbBlock('<?php echo $i; ?>');

								<?php
									$i++;
								}
							} else { ?>
								addNewEiaBlock(sampleCounter);
								addNewWbBlock(sampleCounter);
							<?php } ?>
						});

						function addDtsRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td>\
									<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
								</td>\
								<td> \
									<?php echo $possibleResults; ?> \
								</td>\
								<td class="syphilis-input" style="display:none;"> \
									<?php echo $possibleSyphilisResults; ?> \
								</td>\
								<td class="rtri-input" style="display:none;"> \
									<?php echo $possibleRTRIResults; ?> \
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'sampleEia' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a> \
									<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							if ($("#enableSyphilis").val() == "yes") {
								$("#possibleSyphilisResults").addClass("isRequired")
								$('.syphilis-input').show();
							} else {
								$("#possibleSyphilisResults").removeClass("isRequired")
								$('.syphilis-input').hide();
							}

							if ($("#enableRtri").val() == "yes") {
								$('.rtri-input').show();
							} else {
								$('.rtri-input').hide();
							}
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
							addNewEiaBlock(sampleCounter);
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
							$("#enableSyphilis").change(function() {
								if ($(this).val() == "yes") {
									$('.syphilis-input').show();
									$("#possibleSyphilisResults").addClass("isRequired")
								} else {
									$("#possibleSyphilisResults").removeClass("isRequired")
									$('.syphilis-input').hide();
								}
							});

							$("#enableRtri").change(function() {
								if ($(this).val() == "yes") {
									$('.rtri-input').show();
								} else {
									$('.rtri-input').hide();
								}
							});
						});

						function screeningTestPanel(value) {
							if ($('.dtsTestPanelType')) {
								if (value == 'no') {
									$('.dtsTestPanelType').show();
									// $('#dtsTestPanelType').removeClass('isRequired');
								} else {
									// $('#dtsTestPanelType').addClass('isRequired');
									$('#dtsTestPanelType').val('');
									$('.dtsTestPanelType').hide();
								}
							}
						}

						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}

						function addNewEiaBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="sampleEia' + sampleId + '" class="closeModal">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("OD"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td>\
									<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td>\
									<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td>\
									<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  \
                                   \<div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb[' + sampleId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb[' + sampleId + '][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb[' + sampleId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				     \
				    <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("RAPID HIV TESTING"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;"><?= $this->translate->_("Kit Name"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
									<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="rhiv[' + sampleId + '][kit][]"><?php echo $dtskit; ?></select></td>\
									<td><input type="text" name="rhiv[' + sampleId + '][lot][]" class="form-control"/></td>\
									<td><input type="text" name="rhiv[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><select class="form-control" name="rhiv[' + sampleId + '][result][]"><?php echo $possibleResultsOption; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewHivRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
					<div class="modal-footer">\
					<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleEia' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
						}

						function addNewEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td> \
							<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td> \
							<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td> \
							<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeEiaRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#sampleEia' + sampleId).remove();
							});
						}

						function addNewWbBlock(sampleWbId) {
							$("#wbBlockHolder").after('<div id="sampleWb' + sampleWbId + '" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;"><?= $this->translate->_("WB"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
									<th style="text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});

						}

						function addNewWbRow(obj, sampleWbId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select class="form-control" name="wb[' + sampleId + '][result][]"><?php echo $possibleResultsOption; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,' + sampleWbId + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewHivRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="rhiv[' + sampleId + '][kit][]"><?php echo $dtskit; ?></select></td> \
							<td><input type="text" name="rhiv[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="rhiv[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><select class="form-control" name="rhiv[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewHivRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeHivRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewGeeniusRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><input type="text" name="geenius[' + sampleId + '][lot][]" class="form-control"/></td> \
							<td><input type="text" name="geenius[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><select class="form-control" name="geenius[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewGeeniusRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeGeeniusRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeGeeniusRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function removeHivRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function removeWbRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'covid19') {

					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'COVID19_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";

					$covid19TestType = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->allTestTypes as $kitId => $kitName) {
						$covid19TestType .= '<option value="' . $kitId . '">' . $kitName . '</option>';
					}
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->covid19PossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'COVID19_TEST') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

				?>
					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="covid19SampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory"); ?>?</th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th>
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Option"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							$counter = 1;
							if (sizeof($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>';
												<?php
												foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'COVID19_FINAL') {
												?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
													}
												}
												?>
											</select>

										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('typeName<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
											<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php
											}
											?>
										</td>
									</tr>

								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" />
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = $("#covid19SampleTable tbody tr").length;
						$(document).ready(function() {
							$(".datepicker").on("click", function() {
								//$(this).val('');

								$(this).datepicker({
									dateFormat: '<?php echo $dtFormat; ?>'
								})
							});
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) { ?>
									addNewPlatformNameBlock('<?php echo $i; ?>');

								<?php
									$i++;
								}
							} else { ?>
								addNewPlatformNameBlock(sampleCounter);
							<?php } ?>
						});

						function addCovid19Row(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td>\
									<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
								</td>\
								<td> \
									<?php echo $possibleResults; ?> \
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'typeName' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a> \
									<a href="javascript:void(0);" onclick="addCovid19Row(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
							addNewPlatformNameBlock(sampleCounter);
						}

						function addNewPlatformNameBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="typeName' + sampleId + '" class="dialog">\
							<span onClick="hidedefModal()" class="closeModal"></span>\
							<div class="modal-header">\
								<h4 class="modal-title"> <?= $this->translate->_("COVID-19 TYPE OF TESTING"); ?></h4>\
							</div>\
							<div class="modal-body">\
								<div class="row">\
								<div >\
									<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
										<thead>\
											<tr align="center">\
												<th style="width:20%;text-align: center;"><?= $this->translate->_("Platform Name"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
												<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
												<th style="width:15%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
												<th style="width: 5%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
											</tr>\
										</thead>\
										<tbody>\
											<tr>\
												<td><select class="form-control" name="rtype[' + sampleId + '][type][]"><?php echo $covid19type; ?></select></td>\
												<td><input type="text" name="rtype[' + sampleId + '][lot][]" class="form-control"/></td>\
												<td><input type="text" name="rtype[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
												<td><select class="form-control" name="rtype[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
												<td>\
													<a href="javascript:void(0);" onclick="addCovid19Row(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
												</td>\
											</tr>\
										</tbody>\
									</table>\
								</div>\
								</div>\
							</div>\
												<div class="modal-footer">\
								<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleEia' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
							</div>\
							</div>');
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function removeCovid19Row(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#typeName' + sampleId).remove();
							});
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									addNewPlatformNameBlock('<?php echo $i; ?>');
								<?php
									$i++;
								}
							} else {
								?>
								addNewPlatformNameBlock(sampleCounter);
							<?php
							}
							?>
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});


						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'dbs') {


					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						if ($pr['scheme_sub_group'] == 'DBS_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

					$possibleResults .= "</select>";
					$eiaChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->eia as $eiaId => $eiaName) {
						$eiaChoices .= '<option value="' . $eiaId . '">' . $eiaName . '</option>';
					}

					$wbChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->wb as $wbId => $wbName) {
						$wbChoices .= '<option value="' . $wbId . '">' . $wbName . '</option>';
					}

					$allEia = [];
					foreach ($shipmentData['eia'] as $eia) {
						$allEia[] = $eia['sample_id'];
					}

					$allWb = [];
					foreach ($shipmentData['wb'] as $wb) {
						$allWb[] = $wb['sample_id'];
					}

				?>


					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="dbsSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Final Result"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Score"); ?></th>
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php

							$counter = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>" />
											<input type="hidden" id="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<td>
											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>';
												<?php
												foreach ($shipmentData['possibleResults'] as $pr) {
													if ($pr['scheme_sub_group'] == 'DBS_FINAL') {
												?>
														<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
													}
												}
												?>
											</select>

										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" value="<?php echo $reference['sample_score']; ?>" />
										</td>
										<td>
											<a data-toggle="modal" href="#sampleEia<?php echo $reference['sample_id']; ?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i><?= $this->translate->_("EIA"); ?> </a>
											<a data-toggle="modal" href="#sampleWb<?php echo $reference['sample_id']; ?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> <?= $this->translate->_("WB"); ?></a>
											<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> <?= $this->translate->_("Sample/Control"); ?></a>
											<?php
											if ($counter > 1) {
											?>
												<a href="javascript:void(0);" onclick="removeDbsRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php
											}
											?>
										</td>
									</tr>
									<tr style="display: none;">
										<td colspan="6">
											<div id="sampleEia<?php echo $reference['sample_id']; ?>" class="modal fade" tabindex="-1" data-width="860" style="display: none;">
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
																		<th style="width:10%;text-align: center;">OD</th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>
																		<th style="width:20%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allEia)) {
																		$k = 0;
																		foreach ($shipmentData['eia'] as $eia) {
																			if ($eia['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][eia][]"><?php $this->dropdownSelection($this->eia, $eia['eia'], true); ?></select></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>" /></td>
																					<td><input type="text" name="eia[<?php echo $eia['sample_id']; ?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>" /></td>
																					<td>
																						<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $eia['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>
																					<td>
																						<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeDbsRow(this,'<?php echo $eia['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																			}
																			$k++;
																		}
																	} else {
																		?>
																		<tr>
																			<td><select class="form-control" name="eia[<?php echo $reference['sample_id']; ?>][eia][]"><?php echo $eiaChoices; ?></select></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][od][]" class="form-control" value="" /></td>
																			<td><input type="text" name="eia[<?php echo $reference['sample_id']; ?>][cutoff][]" class="form-control" value="" /></td>
																			<td>
																				<select class="form-control" name="eia[<?php echo $eia['sample_id']; ?>][result][]">
																					<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																					<?php
																					foreach ($this->dtsPossibleResults as $pr) {
																						if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																					?>
																							<option value='<?php echo $pr['id']; ?>'><?php echo $pr['response']; ?></option>
																					<?php
																						}
																					}
																					?>
																				</select>
																			</td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
												</div>
											</div>
										</td>
									</tr>
									<tr style="display: none;">
										<td colspan="6">

											<div id="sampleWb<?php echo $reference['sample_id']; ?>" class="modal fade" tabindex="-1" data-width="960" style="display: none;">
												<div class="modal-header">
													<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>
												</div>
												<div class="modal-body">
													<div class="row" style="overflow-x:scroll;">
														<div>
															<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
																<thead>
																	<tr align="center">
																		<th style="text-align: center;">WB</th>
																		<th style="text-align: center;">Lot</th>
																		<th style="text-align: center;">Expiry</th>
																		<th style="text-align: center;">160</th>
																		<th style="text-align: center;">120</th>
																		<th style="text-align: center;">66</th>
																		<th style="text-align: center;">55</th>
																		<th style="text-align: center;">51</th>
																		<th style="text-align: center;">41</th>
																		<th style="text-align: center;">31</th>
																		<th style="text-align: center;">24</th>
																		<th style="text-align: center;">17</th>
																		<th style="text-align: center;"><?= $this->translate->_("Result"); ?></th>
																		<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>
																	</tr>
																</thead>
																<tbody>
																	<?php
																	if (in_array($reference['sample_id'], $allWb)) {
																		$k = 0;
																		foreach ($shipmentData['wb'] as $wb) {
																			if ($wb['sample_id'] == $reference['sample_id']) {
																	?>
																				<tr>
																					<td><select class="form-control" name="wb[<?php echo $wb['sample_id']; ?>][wb][]" id="sample<?php echo $wb['sample_id']; ?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb, $wb['wb'], true); ?></select></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>" /></td>
																					<td><input type="text" name="wb[<?php echo $wb['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>" /></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td><select name="wb[<?php echo $wb['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																							<option value=""></option>
																							<option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option>
																							<option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option>
																						</select></td>
																					<td>
																						<select class="form-control" name="wb[<?php echo $eia['sample_id']; ?>][result][]">
																							<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																							<?php
																							foreach ($this->dtsPossibleResults as $pr) {
																								if ($pr['scheme_sub_group'] == 'DTS_TEST') {
																							?>
																									<option value='<?php echo $pr['id']; ?>' <?php echo (isset($pr['id']) && $pr['id'] == $wb['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
																							<?php
																								}
																							}
																							?>
																						</select>
																					</td>


																					<td>
																						<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																						<?php
																						if ($k > 0) {
																						?>
																							<a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																						<?php } ?>
																					</td>
																				</tr>
																		<?php
																				$k++;
																			}
																		}
																	} else {
																		?>
																		<tr>

																			<td><select class="form-control" name="wb[<?php echo $reference['sample_id']; ?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" style="width:100px;" /></td>
																			<td><input type="text" name="wb[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" /></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][160][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][120][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][66][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][55][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][51][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][41][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][31][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][24][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td><select name="wb[<?php echo $reference['sample_id']; ?>][17][]" style="width:70px;font-weight:bold;" class="form-control">
																					<option value=""></option>
																					<option value="1">+</option>
																					<option value="0">-</option>
																				</select></td>
																			<td>
																				<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			</td>
																		</tr>
																	<?php } ?>
																</tbody>
															</table>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>
												</div>
											</div>
										</td>
									</tr>
								<?php
									$counter++;
								}
							} else {
								?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
									</td>
									<td>
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score" title="Please enter the score for this control/sample" />
									</td>
									<td>
										<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a>
										<a data-toggle="modal" href="#sampleWb1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB</a>
										<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i><?= $this->translate->_("Sample/Control"); ?></a>

									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<div id="eiaBlockHolder">

					</div> <!-- eiaBlockHolder -->
					<div id="wbBlockHolder">

					</div> <!-- wbBlockHolder -->
					<script type="text/javascript">
						var sampleCounter = 1;

						$(document).ready(function() {
							$(".datepicker").on("click", function() {
								//$(this).val('');

								$(this).datepicker({
									dateFormat: '<?php echo $dtFormat; ?>'
								})
							});
							sampleCounter = $("#dbsSampleTable tbody tr").length;
							<?php
							$i = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $reference) {
							?>
									addNewEiaBlock('<?php echo $i; ?>');
									addNewWbBlock('<?php echo $i; ?>');
								<?php
									$i++;
								}
							} else {
								?>
								addNewEiaBlock(sampleCounter);
								addNewWbBlock(sampleCounter);
							<?php
							}
							?>
						})

						function addDbsRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td>\
									<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
								</td>\
								<td> \
									<?php echo $possibleResults; ?> \
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
								<td> \
									<a data-toggle="modal" href="#sampleEia' + sampleCounter + '" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a> \
									<a data-toggle="modal" href="#sampleWb' + sampleCounter + '" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB </a> \
									<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
									<a href="javascript:void(0);" onclick="removeDbsRow(this,' + sampleCounter + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
							addNewEiaBlock(sampleCounter);
							addNewWbBlock(sampleCounter);

						}

						function addNewEiaRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
									<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td> \
									<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td> \
									<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td> \
									<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
									<td> \
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
										<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td> \
								</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewEiaBlock(sampleId) {
							$("#eiaBlockHolder").after('<div id="sampleEia' + sampleId + '" class="modal fade" tabindex="-1" data-width="860" style="display: none;">\
							<div class="modal-header">\
								<h4 class="modal-title"><?= $this->translate->_("EIA"); ?></h4>\
							</div>\
							<div class="modal-body">\
								<div class="row">\
								<div >\
									<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
										<thead>\
											<tr align="center">\
												<th style="width:20%;text-align: center;"><?= $this->translate->_("EIA"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
												<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("OD"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Cutoff"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
												<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
											</tr>\
										</thead>\
										<tbody>\
											<tr>\
												<td><select class="form-control" name="eia[' + sampleId + '][eia][]"><?php echo $eiaChoices; ?></select></td>\
												<td><input type="text" name="eia[' + sampleId + '][lot][]" class="form-control"/></td>\
												<td><input type="text" name="eia[' + sampleId + '][expiry][]" class="form-control datepicker"/></td>\
												<td><input type="text" name="eia[' + sampleId + '][od][]" class="form-control"/></td>\
												<td><input type="text" name="eia[' + sampleId + '][cutoff][]" class="form-control"/></td>\
												<td><select class="form-control" name="eia[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
												<td>\
													<a href="javascript:void(0);" onclick="addNewEiaRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
												</td>\
											</tr>\
										</tbody>\
									</table>\
								</div>\
								</div>\
							</div>\
							<div class="modal-footer">\
								<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>\
							</div>\
							</div>');

						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function removeDbsRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								$('#sampleEia' + sampleId).remove();
							});
						}

						function addNewWbBlock(sampleWbId) {
							$("#wbBlockHolder").after('<div id="sampleWb' + sampleWbId + '" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
							<div class="modal-header">\
								<h4 class="modal-title"><?= $this->translate->_("WB"); ?></h4>\
							</div>\
							<div class="modal-body">\
								<div class="row" style="overflow-x:scroll;">\
								<div >\
									<table style="width: 100%;margin: 0 auto;overflow:scroll" class="table table-bordered table-striped clearfix">\
										<thead>\
											<tr align="center">\
												<th style="text-align: center;">WB</th>\
												<th style="text-align: center;">Lot</th>\
												<th style="text-align: center;">Expiry</th>\
												<th style="text-align: center;">160</th>\
												<th style="text-align: center;">120</th>\
												<th style="text-align: center;">66</th>\
												<th style="text-align: center;">55</th>\
												<th style="text-align: center;">51</th>\
												<th style="text-align: center;">41</th>\
												<th style="text-align: center;">31</th>\
												<th style="text-align: center;">24</th>\
												<th style="text-align: center;">17</th>\
												<th style="text-align: center;"><?= $this->translate->_("Options"); ?></th>\
											</tr>\
										</thead>\
										<tbody>\
											<tr>\
												<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
												<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
												<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
												<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
												<td>\
													<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
												</td>\
											</tr>\
										</tbody>\
									</table>\
								</div>\
								</div>\
							</div>\
							<div class="modal-footer">\
								<button type="button" data-dismiss="modal" class="btn btn-primary"><?= $this->translate->_("OK"); ?></button>\
							</div>\
							</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});

						}

						function addNewWbRow(obj, sampleWbId) {
							$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb[' + sampleWbId + '][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb[' + sampleWbId + '][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb[' + sampleWbId + '][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb[' + sampleWbId + '][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,' + sampleWbId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,' + sampleWbId + ')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeWbRow(obj, sampleId) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleWb'+sampleId).remove();
							});
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}
					</script>
				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'eid') {

					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($shipmentData['possibleResults'] as $pr) {
						$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
					}

					$possibleResults .= "</select>";

				?>

					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="width:22%;text-align: center;"><?= $this->translate->_("Results"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("HIV CT/OD"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("IC/QS Values"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:13%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;

							foreach ($shipmentData['reference'] as $reference) {

							?>

								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>

										<select name="possibleResults[]" class="isRequired form-control input-sm">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<?php

											foreach ($shipmentData['possibleResults'] as $pr) {
											?>
												<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
											<?php
											}
											?>
										</select>
									</td>
									<td>
										<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values" title="Please enter the HIV CT/OD values here" value="<?php echo $reference['reference_hiv_ct_od'] ?>" />
									</td>
									<td>
										<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values" title="Please enter the IC/QS Values here" value="<?php echo $reference['reference_ic_qs'] ?>" />
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
										<?php
										if ($counter > 1) {

										?>
											<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
										<?php
										}
										?>
									</td>
								</tr>


							<?php
								$counter++;
							} ?>
						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						function addEidRow(obj) {
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
							<td style="text-align: center"> \
								<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
							</td>  \
							<td>\
								<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
							</td>\
							<td> \
								<?php echo $possibleResults; ?> \
							</td> \
							<td> \
								<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /> \
							</td>\
							<td> \
								<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /> \
							</td>\
							<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
									<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
								</select> \
							</td> \
							<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
									<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
								</select> \
							</td> \
							<td> \
								<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}
					</script>


				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'vl') {

					$vlAssayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->vlAssay as $id => $name) {
						$vlAssayChoices .= '<option value="' . $id . '">' . $name . '</option>';
					}

					$allVlRefMethods = [];
					foreach ($shipmentData['vlReferenceMethods'] as $vlRefMet) {
						$allVlRefMethods[] = $vlRefMet['sample_id'];
					}


				?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="methodOfEvaluation"><?= $this->translate->_("Method of Evaluation"); ?> <span class='mandatory'>*</span></label>

						<div class="col-lg-5">
							<select id="methodOfEvaluation" name="methodOfEvaluation" class="isRequired form-control" title="Please select a Method of Evaluation" style=" margin-bottom: 15px; ">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value="iso17043" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'iso17043') ? "selected='selected'" : ""; ?>><?= $this->translate->_("ISO/IEC 17043"); ?></option>
								<option value="standard" <?php echo (isset($shipmentAttribute['methodOfEvaluation']) && $shipmentAttribute['methodOfEvaluation'] == 'standard') ? "selected='selected'" : ""; ?>><?= $this->translate->_("Legacy"); ?></option>
							</select>
						</div>
					</div>
					<table style="width: 850px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:25%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;
							//var_dump($shipmentData['vlReferenceMethods']);die;
							foreach ($shipmentData['reference'] as $reference) {

							?>


								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
									</td>
									<td>
										<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
											<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleReferenceResult'+<?php echo $reference['sample_id']; ?>, 900,550);"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
										<a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
										<?php
										if ($counter > 1) {

										?>
											<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
										<?php
										}
										?>

										<div id="sampleReferenceResult<?php echo $reference['sample_id']; ?>" class="dialog">
											<span onClick="hidedefModal()" class="closeModal"></span>
											<div class="modal-header">
												<h4 class="modal-title"><?= $this->translate->_("Reference Results"); ?></h4>
											</div>
											<div class="modal-body">
												<div class="row">
													<div>
														<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
															<thead>
																<tr align="center">
																	<th style="width:50%;text-align: center;">VL Assay</th>
																	<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>
																	<th style="width:15%;text-align: center;"></th>
																</tr>
															</thead>
															<tbody>
																<?php
																if (in_array($reference['sample_id'], $allVlRefMethods)) {
																	$k = 0;
																	foreach ($shipmentData['vlReferenceMethods'] as $vlref) {
																		if ($vlref['sample_id'] == $reference['sample_id']) {
																?>
																			<tr>
																				<td><select class="form-control" name="vlRef[<?php echo $vlref['sample_id']; ?>][assay][]"><?php $this->dropdownSelection($this->vlAssay, $vlref['assay'], true); ?></select></td>
																				<td><input type="text" name="vlRef[<?php echo $vlref['sample_id']; ?>][value][]" class="form-control" value="<?php echo $vlref['value']; ?>" /></td>
																				<td>
																					<a href="javascript:void(0);" onclick="addNewVlRefRow(this,<?php echo $vlref['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																					<?php
																					if ($k > 0) {
																					?>
																						<a href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																					<?php } ?>
																				</td>
																			</tr>
																	<?php
																		}
																		$k++;
																	}
																} else { ?>
																	<tr>
																		<td><select class="form-control" name="vlRef[<?php echo $reference['sample_id']; ?>][assay][]"><?php echo $vlAssayChoices; ?></select></td>
																		<td><input type="text" name="vlRef[<?php echo $reference['sample_id']; ?>][value][]" class="form-control" /></td>
																		<td>
																			<a href="javascript:void(0);" onclick="addNewVlRefRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																		</td>
																	</tr>
																<?php } ?>
															</tbody>
														</table>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-primary" onclick="closeShipmentModal('<?php echo "sampleReferenceResult" . $reference['sample_id']; ?>')"><?= $this->translate->_("OK"); ?></button>
											</div>
										</div>
									</td>
								</tr>


							<?php
								$counter++;
							}

							?>

						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						function addVlRow(obj) {
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<th><input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" title="Please enter the Sample Name"  placeholder="Please enter the Sample Name" /></th> \
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
							</tr>');
						}

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}


						function addNewReferenceResultBlock(sampleId) {
							$("#sampleReferenceBlockHolder").after('<div id="sampleReferenceResult' + sampleId + '" class="dialog">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title">Reference Results</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:50%;text-align: center;">VL Assay</th>\
									<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>\
									<th style="width:15%;text-align: center;"></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="vlRef[' + sampleId + '][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef[' + sampleId + '][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
						<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleReferenceResult' + sampleId + '\')"><?= $this->translate->_("OK"); ?></button>\
				  </div>\
				</div>');
						}

						function addNewVlRefRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr>\
									<td><select class="form-control" name="vlRef[' + sampleId + '][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef[' + sampleId + '][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
										<a  href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td>\
								</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeVlRefRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}
					</script>


				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'tb') {

					$possibleMicrosopeResults = $possibleResults = [];
					foreach ($this->tbPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'TB_MOLECULAR_FINAL') {
							$possibleResults[$pr['result_code']] = $pr['response'];
						}
						if ($pr['scheme_sub_group'] == 'TB_MICROSCOPY_FINAL') {
							$possibleMicrosopeResults[$pr['result_code']] = $pr['response'];
						}
					}
					$options = "";
					if (isset($this->assay) && !empty($this->assay)) {
						foreach ($this->assay as $row) {
							$options .= '<option value="' . $row['id'] . '" data-type="' . $row['assay_type'] . '" data-drug="' . $row['drug_resistance_test'] . '" data-short="' . $row['short_name'] . '">' . ucwords($row['name']) . '</option>';
						}
					}
				?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="scorePerSample"><?= $this->translate->_("Score Per Sample"); ?></label>
						<div class="col-lg-5">
							<input type="number" class="form-control input-sm" name="scorePerSample" id="scorePerSample" placeholder="Enter the score per sample" title="Please enter the score per sample" value="<?php echo isset($shipmentAttribute['score_per_sample']) ? $shipmentAttribute['score_per_sample'] : ''; ?>">
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="formVersion"><?= $this->translate->_("Form Version"); ?></label>
						<div class="col-lg-5">
							<input type="text" class="form-control input-sm" name="formVersion" id="formVersion" placeholder="Enter the form version" title="Please enter form version" value="<?php echo isset($shipmentAttribute['form_version']) ? $shipmentAttribute['form_version'] : ''; ?>">
						</div>
					</div>
					<?php if (isset($this->feedbackOption) && !empty($this->feedbackOption) && $this->feedbackOption == 'yes') { ?>
						<div class="form-group">
							<label class="col-lg-3 control-label"><?= $this->translate->_("Collect Feedback"); ?></label>

							<div class="col-lg-5">
								<select name="collectFeedBack" id="collectFeedBack" class='form-control' title="Please select feedback active or inactive">
									<option value=""><?= $this->translate->_(" -- Select -- "); ?></option>
									<option value="yes" <?php echo (isset($shipmentData['shipment']['collect_feedback']) && !empty($shipmentData['shipment']['collect_feedback']) && $shipmentData['shipment']['collect_feedback'] == 'yes') ? "selected='selected'" : ''; ?>><?= $this->translate->_("Yes"); ?></option>
									<option value="no" <?php echo (isset($shipmentData['shipment']['collect_feedback']) && !empty($shipmentData['shipment']['collect_feedback']) && $shipmentData['shipment']['collect_feedback'] == 'no') ? "selected='selected'" : ''; ?>><?= $this->translate->_("No"); ?></option>
								</select>
							</div>
						</div>
					<?php } ?>
					<div class="form-group">
						<label class="col-lg-3 control-label" for="tbTest"><?= $this->translate->_("Select Type of TB Test"); ?></label>
						<div class="col-lg-5">
							<select type="text" id="tbTest" name="tbTest" class="form-control input-sm" title="Please select the type of tb test" onchange="loadRefTable(this.value);">
								<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
								<option value="molecular" <?php echo (isset($shipmentAttribute['tb_test_type']) && $shipmentAttribute['tb_test_type'] == 'molecular' ? "selected='selected'" : ""); ?>>Molecular</option>
								<option value="microscopy" <?php echo (isset($shipmentAttribute['tb_test_type']) && $shipmentAttribute['tb_test_type'] == 'microscopy' ? "selected='selected'" : ""); ?>>Microscopy</option>
							</select>
						</div>
					</div>
					<table style="width: 1050px;margin: 0 auto;" border="1" class="hide table table-bordered table-striped reftable clearfix" id="microscopy">
						<thead>
							<tr align="center">
								<th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Is it a Control?"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>
								<!-- <th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Score"); ?></th> -->
								<th style="width:5%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $mcounter = 1;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $key => $reference) { ?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" id="sampleName<?php echo $mcounter; ?>" class="isRequired microscopyfield input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										</td>
										<td>
											<input type="text" name="samplePreparationDate[]" id="samplePreparationDate<?php echo $mcounter; ?>" value="<?php echo $reference['sample_preparation_date']; ?>" readonly="readonly" class="isRequired microscopyfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<td>
											<select name="mtbDetected[]" id="mtbDetected<?php echo $mcounter; ?>" class="isRequired microscopyfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
												<?php $this->dropdownSelection($possibleMicrosopeResults, $reference['mtb_detected'], true); ?>
										</td>
										<td>
											<select name="control[]" id="control<?php echo $mcounter; ?>" class="isRequired controlOrNot microscopyfield form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" id="mandatory<?php echo $mcounter; ?>" class="isRequired form-control microscopyfield input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<a href="javascript:void(0);" onclick="addTbRow(this, 'microscopy');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
											<?php if ($mcounter > 1) { ?>
												<a href="javascript:void(0);" onclick="removeRow(this, 'microscopy')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>
										</td>
									</tr>
								<?php
									$mcounter++;
								}
							} else { ?>
								<tr align="center">
									<th>
										<input type="text" name="sampleName[]" id="sampleName1" value="" class="isRequired microscopyfield form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" />
									</th>
									<td>
										<input type="text" name="samplePreparationDate[]" id="samplePreparationDate1" readonly="readonly" class="isRequired microscopyfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<select name="mtbDetected[]" id="mtbDetected1" class="isRequired microscopyfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
											<?php $this->dropdownSelection($possibleMicrosopeResults, null, true); ?>
										</select>
									</td>
									<td>
										<select name="control[]" id="control1" class="isRequired microscopyfield controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" id="mandatory1" class="isRequired microscopyfield form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addTbRow(this, 'microscopy');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<div style="overflow-x:scroll;" class="table-responsive">
						<table border="1" class="hide table table-bordered table-striped reftable clearfix" id="molecular" style=" border: 1px solid gray; ">
							<thead>
								<tr>
									<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Details"); ?></th>
									<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Add/Remove Row"); ?></th>
								</tr>
							</thead>
							<tbody>
								<?php $counter = 1;
								$showISI = false;
								if (count($shipmentData['reference']) > 0) {
									foreach ($shipmentData['reference'] as $key => $reference) { ?>
										<tr>
											<td>
												<table>
													<tr>
														<th colspan="13"><input type="text" value="<?php echo $reference['sample_label']; ?>" name="sampleName[]" value="" class="isRequired molecularfield form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /></th>
													</tr>
													<tr>
														<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB/Rif"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>
														<th style="text-align: center;vertical-align:middle;">Probe D</th>
														<th style="text-align: center;vertical-align:middle;">Probe C</th>
														<th style="text-align: center;vertical-align:middle;">Probe E</th>
														<th style="text-align: center;vertical-align:middle;">Probe B</th>
														<th style="text-align: center;vertical-align:middle;">SPC Xpert</th>
														<th style="text-align: center;vertical-align:middle;">Probe A</th>
														<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("TB Isolate"); ?></th>
													</tr>
													<tr>
														<td>
															<select name="mtbDetected[<?php echo $reference['sample_id']; ?>]" id="mtbDetected<?php echo ($counter + 1); ?>" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
																<?php $this->dropdownSelection($possibleResults, $reference['mtb_detected'], true); ?>
															</select>
														</td>
														<td>
															<select name="rifResistance[<?php echo $reference['sample_id']; ?>]" id="rifResistance<?php echo ($counter + 1); ?>" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
																<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																<option value="na" <?php echo ($reference['rif_resistance'] == 'na' ? "selected='selected'" : ""); ?>>N/A</option>
																<option value="detected" <?php echo ($reference['rif_resistance'] == 'detected' ? "selected='selected'" : ""); ?>>Detected</option>
																<option value="not-detected" <?php echo ($reference['rif_resistance'] == 'not-detected' ? "selected='selected'" : ""); ?>>Not Detected</option>
																<option value="indeterminate" <?php echo ($reference['rif_resistance'] == 'indeterminate' ? "selected='selected'" : ""); ?>>Indeterminate</option>
																<option value="testing-not-performed" <?php echo ($reference['rif_resistance'] == 'testing-not-performed' ? "selected='selected'" : ""); ?>>Testing NOT Performed</option>
															</select>
														</td>
														<td>
															<input type="text" value="<?php echo $reference['probe_d']; ?>" id="probeD<?php echo ($counter + 1); ?>" name="probeD[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe D" placeholder="D" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['probe_c']; ?>" id="probeC<?php echo ($counter + 1); ?>" name="probeC[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe C" placeholder="C" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['probe_e']; ?>" id="probeE<?php echo ($counter + 1); ?>" name="probeE[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe E" placeholder="E" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['probe_b']; ?>" id="probeB<?php echo ($counter + 1); ?>" name="probeB[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe B" placeholder="B" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['spc_xpert']; ?>" id="spcXpert<?php echo ($counter + 1); ?>" name="spcXpert[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert" placeholder="SPC Xpert" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['probe_a']; ?>" id="probeA<?php echo ($counter + 1); ?>" name="probeA[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal input-probeA1" title="Please enter the Probe A" placeholder="A" />
														</td>
														<td style="border-left: solid 1px gray;">
															<input type="text" value="<?php echo $reference['sample_preparation_date']; ?>" id="sample1PreparationDate<?php echo ($counter + 1); ?>" name="sample1PreparationDate[<?php echo $reference['sample_id']; ?>]" readonly="readonly" class="isRequired molecularfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
														</td>
														<td><input type="text" value="<?php echo $reference['tb_isolate']; ?>" id="tbIsolate<?php echo ($counter + 1); ?>" name="tbIsolate[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm" placeholder="Isolate" title="Please enter the TB Isolate" /></td>
													</tr>
													<tr>
														<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Ultra"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>
														<th style="text-align: center;vertical-align:middle;">IS1081-IS6110</th>
														<th style="text-align: center;vertical-align:middle;">rpoB1</th>
														<th style="text-align: center;vertical-align:middle;">rpoB2</th>
														<th style="text-align: center;vertical-align:middle;">rpoB3</th>
														<th style="text-align: center;vertical-align:middle;">rpoB4</th>
														<th style="text-align: center;vertical-align:middle;">SPC Xpert Ultra</th>
														<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Is it a Control?"); ?></th>
														<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>
													</tr>
													<tr>
														<td>
															<select id="mtbDetectedUltra<?php echo ($counter + 1); ?>" name="mtbDetectedUltra[<?php echo $reference['sample_id']; ?>]" class="isRequired molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
																<?php $this->dropdownSelection($possibleResults, $reference['mtb_detected_ultra'], true); ?>
															</select>
														</td>
														<td>
															<select id="rifResistanceUltra<?php echo ($counter + 1); ?>" name="rifResistanceUltra[<?php echo $reference['sample_id']; ?>]" class="isRequired molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
																<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																<option value="na" <?php echo ($reference['rif_resistance_ultra'] == 'na' ? "selected='selected'" : ""); ?>>N/A</option>
																<option value="detected" <?php echo ($reference['rif_resistance_ultra'] == 'detected' ? "selected='selected'" : ""); ?>>Detected</option>
																<option value="not-detected" <?php echo ($reference['rif_resistance_ultra'] == 'not-detected' ? "selected='selected'" : ""); ?>>Not Detected</option>
																<option value="indeterminate" <?php echo ($reference['rif_resistance_ultra'] == 'indeterminate' ? "selected='selected'" : ""); ?>>Indeterminate</option>
																<option value="testing-not-performed" <?php echo ($reference['rif_resistance_ultra'] == 'testing-not-performed' ? "selected='selected'" : ""); ?>>Testing NOT Performed</option>
															</select>
														</td>
														<td>
															<input type="number" value="<?php echo $reference['is1081_is6110']; ?>" step="0.01" id="ISI<?php echo ($counter + 1); ?>" name="ISI[<?php echo $reference['sample_id']; ?>]" placeholder="IS1081-IS6110" class="form-control oneDecimal input-sm" title="Please enter the IS1081-IS6110" />
														</td>
														<td>
															<input type="number" value="<?php echo $reference['rpo_b1']; ?>" step="0.01" id="rpoB1<?php echo ($counter + 1); ?>" name="rpoB1[<?php echo $reference['sample_id']; ?>]" placeholder="rpoB1" class="form-control oneDecimal input-sm" title="Please enter the B1" />
														</td>
														<td>
															<input type="number" value="<?php echo $reference['rpo_b2']; ?>" step="0.01" id="rpoB2<?php echo ($counter + 1); ?>" name="rpoB2[<?php echo $reference['sample_id']; ?>]" placeholder="rpoB2" class="form-control oneDecimal input-sm" title="Please enter the B2" />
														</td>
														<td>
															<input type="number" value="<?php echo $reference['rpo_b3']; ?>" step="0.01" id="rpoB3<?php echo ($counter + 1); ?>" name="rpoB3[<?php echo $reference['sample_id']; ?>]" placeholder="rpoB3" class="form-control oneDecimal input-sm" title="Please enter the B3" />
														</td>
														<td>
															<input type="number" value="<?php echo $reference['rpo_b4']; ?>" step="0.01" id="rpoB4<?php echo ($counter + 1); ?>" name="rpoB4[<?php echo $reference['sample_id']; ?>]" placeholder="rpoB4" class="form-control oneDecimal input-sm" title="Please enter the B4" />
														</td>
														<td>
															<input type="text" value="<?php echo $reference['spc_xpert_ultra']; ?>" id="spcXpertUltra<?php echo ($counter + 1); ?>" name="spcXpertUltra[<?php echo $reference['sample_id']; ?>]" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert Ultra" placeholder="SPC Xpert Ultra" />
														</td>
														<td style=" border-left: solid 1px gray; ">
															<select name="control[<?php echo $reference['sample_id']; ?>]" id="control<?php echo ($counter + 1); ?>" class="isRequired molecularfield controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
																<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
																<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
															</select>
														</td>
														<td>
															<select name="mandatory[<?php echo $reference['sample_id']; ?>]" id="mandatory<?php echo ($counter + 1); ?>" class="isRequired molecularfield form-control input-sm" title="Please choose whether this sample/control is mandatory">
																<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
																<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
																<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
															</select>
														</td>
													</tr>
												</table>
											</td>
											<td style=" vertical-align: middle; text-align:center; "><a href="javascript:void(0);" onclick="addTbRow(this, 'molecular');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
												<?php if ($counter > 1) { ?>
													<a href="javascript:void(0);" onclick="removeRow(this, 'molecular')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												<?php } ?>
											</td>
										</tr>
									<?php $counter++;
									}
								} else { ?>
									<tr>
										<td>
											<table>
												<tr>
													<th colspan="13"><input type="text" name="sampleName[]" value="" class="isRequired molecularfield form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /></th>
												</tr>
												<tr>
													<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB/Rif"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>
													<th style="text-align: center;vertical-align:middle;">Probe D</th>
													<th style="text-align: center;vertical-align:middle;">Probe C</th>
													<th style="text-align: center;vertical-align:middle;">Probe E</th>
													<th style="text-align: center;vertical-align:middle;">Probe B</th>
													<th style="text-align: center;vertical-align:middle;">SPC Xpert</th>
													<th style="text-align: center;vertical-align:middle;">Probe A</th>
													<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("TB Isolate"); ?></th>
												</tr>
												<tr>
													<td>
														<select name="mtbDetected[]" id="mtbDetected1" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
															<?php $this->dropdownSelection($possibleResults, null, true); ?>
														</select>
													</td>
													<td>
														<select name="rifResistance[]" id="rifResistance1" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
															<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
															<option value="na">N/A</option>
															<option value="detected">Detected</option>
															<option value="not-detected">Not Detected</option>
															<option value="indeterminate">Indeterminate</option>
															<option value="testing-not-performed">Testing NOT Performed</option>
														</select>
													</td>
													<td>
														<input type="text" name="probeD[]" id="probeD1" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe D" placeholder="D" />
													</td>
													<td>
														<input type="text" name="probeC[]" id="probeC1" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe C" placeholder="C" />
													</td>
													<td>
														<input type="text" name="probeE[]" id="probeE1" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe E" placeholder="E" />
													</td>
													<td>
														<input type="text" name="probeB[]" id="probeB1" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe B" placeholder="B" />
													</td>
													<td>
														<input type="text" name="spcXpert[]" id="spcXpert1" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert" placeholder="SPC Xpert" />
													</td>
													<td>
														<input type="text" name="probeA[]" id="probeA1" class="form-control input-sm oneDecimal input-probeA1" title="Please enter the Probe A" placeholder="A" />
													</td>
													<td style=" border-left: solid 1px gray; "><input type="text" name="samplePreparationDate[]" id="samplePreparationDate1" readonly="readonly" class="isRequired molecularfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" /></td>
													<td><input type="text" name="tbIsolate[]" id="tbIsolate1" class="form-control input-sm" placeholder="Isolate" title="Please enter the TB Isolate" /></td>
												</tr>
												<tr>
													<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Ultra"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>
													<th style="text-align: center;vertical-align:middle;">IS1081-IS6110</th>
													<th style="text-align: center;vertical-align:middle;">rpoB1</th>
													<th style="text-align: center;vertical-align:middle;">rpoB2</th>
													<th style="text-align: center;vertical-align:middle;">rpoB3</th>
													<th style="text-align: center;vertical-align:middle;">rpoB4</th>
													<th style="text-align: center;vertical-align:middle;">SPC Xpert Ultra</th>
													<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Is it a Control?"); ?></th>
													<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>
												</tr>
												<tr>
													<td>
														<select name="mtbDetectedUltra[]" id="mtbDetectedUltra1" class="isRequired molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
															<?php $this->dropdownSelection($possibleResults, null, true); ?>
														</select>
													</td>
													<td>
														<select name="rifResistanceUltra[]" id="rifResistanceUltra1" class="isRequired molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
															<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
															<option value="na">N/A</option>
															<option value="detected">Detected</option>
															<option value="not-detected">Not Detected</option>
															<option value="indeterminate">Indeterminate</option>
															<option value="testing-not-performed">Testing NOT Performed</option>
														</select>
													</td>
													<td>
														<input type="number" step="0.01" name="ISI[]" id="ISI1" placeholder="IS1081-IS6110" class="form-control oneDecimal input-sm" title="Please enter the IS1081-IS6110" />
													</td>
													<td>
														<input type="number" step="0.01" name="rpoB1[]" id="rpoB11" placeholder="rpoB1" class="form-control oneDecimal input-sm" title="Please enter the B1" />
													</td>
													<td>
														<input type="number" step="0.01" name="rpoB2[]" id="rpoB21" placeholder="rpoB2" class="form-control oneDecimal input-sm" title="Please enter the B2" />
													</td>
													<td>
														<input type="number" step="0.01" name="rpoB3[]" id="rpoB31" placeholder="rpoB3" class="form-control oneDecimal input-sm" title="Please enter the B3" />
													</td>
													<td>
														<input type="number" step="0.01" name="rpoB4[]" id="rpoB41" placeholder="rpoB4" class="form-control oneDecimal input-sm" title="Please enter the B4" />
													</td>
													<td>
														<input type="text" name="spcXpertUltra[]" id="spcXpertUltra1" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert Ultra" placeholder="SPC Xpert Ultra" />
													</td>
													<td style=" border-left: solid 1px gray; ">
														<select name="control[]" id="control1" class="isRequired molecularfield controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
															<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
															<option value="1"><?= $this->translate->_("Yes"); ?></option>
															<option value="0"><?= $this->translate->_("No"); ?></option>
														</select>
													</td>
													<td>
														<select name="mandatory[]" id="mandatory1" class="isRequired molecularfield form-control input-sm" title="Please choose whether this sample/control is mandatory">
															<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
															<option value="1"><?= $this->translate->_("Yes"); ?></option>
															<option value="0"><?= $this->translate->_("No"); ?></option>
														</select>
													</td>
												</tr>
											</table>
										</td>
										<td style=" vertical-align: middle; text-align:center; "><a href="javascript:void(0);" onclick="addTbRow(this, 'molecular');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a></td>
									</tr>
								<?php } ?>
							</tbody>
						</table>
					</div>
					<br>

					<script type="text/javascript">
						$(function() {
							$('#tbTest').val('<?php echo $shipmentAttribute['tb_test_type'] ?? null; ?>');

							let _tbTestType = '<?php echo $shipmentAttribute['tb_test_type'] ?? null; ?>';
							if (_tbTestType != '') {
								loadRefTable(_tbTestType);
							}
							<?php if ($showISI) { ?>
								$(".ISI").show();
							<?php } ?>
						});
						var sampleCounter = 2;

						function loadRefTable(type) {
							if (type == 'microscopy') {
								sampleCounter = ($("#microscopy tbody tr").length + 1);
								$('#molecular').addClass('hide');
								$('#microscopy').removeClass('hide');
								$('.molecularfield').removeClass('isRequired');
								$('.molecularfield').prop('disabled', true);
								$('.microscopyfield').prop('disabled', false);
								<?php if (isset($shipmentAttribute['tb_test_type']) && $shipmentAttribute['tb_test_type'] != 'molecular') { ?>
									$('.molecularfield').val('');
								<?php } ?>
							} else {
								sampleCounter = ($("#molecular tbody tr").length + 1);
								$('#microscopy').addClass('hide');
								$('#molecular').removeClass('hide');
								$('.molecularfield').prop('disabled', false);
								$('.microscopyfield').removeClass('isRequired');
								$('.microscopyfield').prop('disabled', true);
								<?php if (isset($shipmentAttribute['tb_test_type']) && $shipmentAttribute['tb_test_type'] != 'microscopy') { ?>
									$('.microscopyfield').val('');
								<?php } ?>
							}
						}

						function loadOtherAssay(obj, row) {
							let _short = $(obj).find(':selected').data('short');
							if (_short == 'xpert-mtb-rif-ultra') {
								$(".input-ISI" + row + ",.rpoB" + row).show();
								$(".probe" + row + ",.probeA" + row).hide();
								$(".probHD").text("rpoB1");
								$(".probHC").text("rpoB2");
								$(".probHE").text("rpoB3");
								$(".probHB").text("rpoB4");
							} else {
								$(".input-ISI" + row + ",.rpoB" + row).hide();
								$(".probe" + row + ",.probeA" + row).show();
							}
							if (_short == 'other') {
								$('.other-assay-' + row).show();
								$('.other-assay-' + row).addClass('isRequired');
							} else {
								$('.other-assay-' + row).hide();
								$('.other-assay-' + row).removeClass('isRequired');
							}
						}

						function addTbRow(obj, type) {
							sampleCounter++;
							if (type == 'microscopy') {
								var html = '<tr> \
									<th> \
										<input type="text" name="sampleName[]" value="" class="isRequired microscopyfield form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /> \
									</th> \
									<td>\
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired microscopyfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
									</td>\
									<td> \
										<select name="mtbDetected[]" class="isRequired form-control microscopyfield input-sm"  title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample"> \
										<?php $this->dropdownSelection($possibleMicrosopeResults, null, true); ?> \
										</select> \
									</td> \
									<td> \
										<select name="control[]" class="isRequired controlOrNot microscopyfield form-control input-sm" title="Please choose whether this sample is a control"> \
											<option value="">--Select--</option> \
											<option value="1">Yes</option> \
											<option value="0">No</option> \
										</select> \
									</td> \
									<td> \
										<select name="mandatory[]" class="isRequired form-control microscopyfield input-sm" title="Please choose whether this sample/control is mandatory"> \
											<option value="">--Select--</option> \
											<option value="1">Yes</option> \
											<option value="0">No</option> \
										</select> \
									</td> \
									<td><a href="javascript:void(0);" onclick="addTbRow(this, \'microscopy\');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this, \'microscopy\')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
								</tr>'
							}
							if (type == 'molecular') {
								var html = '<tr>\
								<td>\
									<table>\
										<tr>\
											<th colspan="13"><input type="text" id="sampleName' + sampleCounter + '" name="sampleName[]" value="" class="isRequired molecularfield form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /></th>\
										</tr>\
										<tr>\
											<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB/Rif"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>\
											<th style="text-align: center;vertical-align:middle;">Probe D</th>\
											<th style="text-align: center;vertical-align:middle;">Probe C</th>\
											<th style="text-align: center;vertical-align:middle;">Probe E</th>\
											<th style="text-align: center;vertical-align:middle;">Probe B</th>\
											<th style="text-align: center;vertical-align:middle;">SPC Xpert</th>\
											<th style="text-align: center;vertical-align:middle;">Probe A</th>\
											<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Sample Preparation Date"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("TB Isolate"); ?></th>\
										</tr>\
										<tr>\
											<td>\
												<select id="mtbDetected' + sampleCounter + '" name="mtbDetected[]" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">\
												<?php $this->dropdownSelection($possibleResults, null, true); ?>\
												</select>\
											</td>\
											<td>\
												<select id="rifResistance' + sampleCounter + '" name="rifResistance[]" class="isRequired molecularfieldChange molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">\
													<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
													<option value="na">N/A</option>\
													<option value="detected">Detected</option>\
													<option value="not-detected">Not Detected</option>\
													<option value="indeterminate">Indeterminate</option>\
													<option value="testing-not-performed">Testing NOT Performed</option>\
												</select>\
											</td>\
											<td>\
												<input id="probeD' + sampleCounter + '" type="text" name="probeD[]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe D" placeholder="D" />\
											</td>\
											<td>\
												<input id="probeC' + sampleCounter + '" type="text" name="probeC[]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe C" placeholder="C" />\
											</td>\
											<td>\
												<input id="probeE' + sampleCounter + '" type="text" name="probeE[]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe E" placeholder="E" />\
											</td>\
											<td>\
												<input id="probeB' + sampleCounter + '" type="text" name="probeB[]" class="form-control input-sm oneDecimal probe1" title="Please enter the Probe B" placeholder="B" />\
											</td>\
											<td>\
												<input id="spcXpert' + sampleCounter + '" type="text" name="spcXpert[]" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert" placeholder="SPC Xpert" />\
											</td>\
											<td>\
												<input id="probeA' + sampleCounter + '" type="text" name="probeA[]" class="form-control input-sm oneDecimal input-probeA1" title="Please enter the Probe A" placeholder="A" />\
											</td>\
											<td style=" border-left: solid 1px gray; "><input type="text" id="samplePreparationDate' + sampleCounter + '" name="samplePreparationDate[]" readonly="readonly" class="isRequired molecularfield form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" /></td>\
											<td><input type="text" id="tbIsolate' + sampleCounter + '" name="tbIsolate[]" class="form-control input-sm" placeholder="Isolate" title="Please enter the TB Isolate" /></td>\
										</tr>\
										<tr>\
											<th rowspan="2" style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Ultra"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("MTB Detected"); ?><br /><?= $this->translate->_("(Level)"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Rif Resistance"); ?></th>\
											<th style="text-align: center;vertical-align:middle;">IS1081-IS6110</th>\
											<th style="text-align: center;vertical-align:middle;">rpoB1</th>\
											<th style="text-align: center;vertical-align:middle;">rpoB2</th>\
											<th style="text-align: center;vertical-align:middle;">rpoB3</th>\
											<th style="text-align: center;vertical-align:middle;">rpoB4</th>\
											<th style="text-align: center;vertical-align:middle;">SPC Xpert Ultra</th>\
											<th style="text-align: center;vertical-align:middle;border-left: solid 1px gray;"><?= $this->translate->_("Is it a Control?"); ?></th>\
											<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>\
										</tr>\
										<tr>\
											<td>\
												<select id="mtbDetectedUltra' + sampleCounter + '" name="mtbDetectedUltra[]" class="isRequired molecularfield form-control input-sm" title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">\
												<?php $this->dropdownSelection($possibleResults, null, true); ?>\
												</select>\
											</td>\
											<td>\
												<select id="rifResistanceUltra' + sampleCounter + '" name="rifResistanceUltra[]" class="isRequired molecularfield form-control input-sm" title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">\
													<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
													<option value="na">N/A</option>\
													<option value="detected">Detected</option>\
													<option value="not-detected">Not Detected</option>\
													<option value="indeterminate">Indeterminate</option>\
													<option value="testing-not-performed">Testing NOT Performed</option>\
												</select>\
											</td>\
											<td>\
												<input type="number" step="0.01" id="ISI' + sampleCounter + '" name="ISI[]" placeholder="IS1081-IS6110" class="form-control oneDecimal input-sm" title="Please enter the IS1081-IS6110" />\
											</td>\
											<td>\
												<input type="number" step="0.01" id="rpoB1' + sampleCounter + '" name="rpoB1[]" placeholder="rpoB1" class="form-control oneDecimal input-sm" title="Please enter the B1" />\
											</td>\
											<td>\
												<input type="number" step="0.01" id="rpoB2' + sampleCounter + '" name="rpoB2[]" placeholder="rpoB2" class="form-control oneDecimal input-sm" title="Please enter the B2" />\
											</td>\
											<td>\
												<input type="number" step="0.01" id="rpoB3' + sampleCounter + '" name="rpoB3[]" placeholder="rpoB3" class="form-control oneDecimal input-sm" title="Please enter the B3" />\
											</td>\
											<td>\
												<input type="number" step="0.01" id="rpoB4' + sampleCounter + '" name="rpoB4[]" placeholder="rpoB4" class="form-control oneDecimal input-sm" title="Please enter the B4" />\
											</td>\
											<td>\
												<input type="text" name="spcXpertUltra[]" id="spcXpertUltra' + sampleCounter + '" class="form-control input-sm oneDecimal" title="Please enter the SPC Xpert Ultra" placeholder="SPC Xpert Ultra" />\
											</td>\
											<td style=" border-left: solid 1px gray; ">\
												<select name="control[]" id="control' + sampleCounter + '" class="isRequired molecularfield controlOrNot form-control input-sm" title="Please choose whether this sample is a control">\
													<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
													<option value="1"><?= $this->translate->_("Yes"); ?></option>\
													<option value="0"><?= $this->translate->_("No"); ?></option>\
												</select>\
											</td>\
											<td>\
												<select name="mandatory[]" id="mandatory' + sampleCounter + '" class="isRequired molecularfield form-control input-sm" title="Please choose whether this sample/control is mandatory">\
													<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
													<option value="1"><?= $this->translate->_("Yes"); ?></option>\
													<option value="0"><?= $this->translate->_("No"); ?></option>\
												</select>\
											</td>\
										</tr>\
									</table>\
								</td>\
								<td style=" vertical-align: middle; text-align:center; "><a href="javascript:void(0);" onclick="addTbRow(this, \'molecular\');" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this, \'molecular\')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
							</tr>'
							}
							$(obj.parentNode.parentNode).after(html);
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $this->defaultDateFormat(); ?>'
							});
							/* $('.molecularfieldChange').change(function() {
								// Dynamically get row number
								const _name = $(this).attr('name');
								const _id = this.id;
								const unmatched = [..._id].filter(char => !_name.includes(char));
								let uniqueId = unmatched.join("");
								if (_name.includes('mtbDetected[]') && this.value != '') {
									$('#mtbDetectedUltra' + uniqueId).val(this.value);
								} else if (this.value) {
									$('#rifResistanceUltra' + uniqueId).val(this.value);
								}
							}); */
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $this->defaultDateFormat(); ?>'
							});
							/* $('.molecularfieldChange').change(function() {
								// Dynamically get row number
								const _name = $(this).attr('name');
								const _id = this.id;
								console.log(_name);
								console.log(_id);
								const unmatched = [..._id].filter(char => !_name.includes(char));
								let uniqueId = unmatched.join("");
								console.log(uniqueId);
								if (_name.includes('mtbDetected') && this.value != '') {
									$('#mtbDetectedUltra' + uniqueId).val(this.value);
								} else if (this.value) {
									$('#rifResistanceUltra' + uniqueId).val(this.value);
								}
							}); */
						});

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}
					</script>


				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'generic-test' || $shipmentData['shipment']['is_user_configured'] == 'yes') {
					$jsonConfig = Zend_Json_Decoder::decode($this->schemeDetails['user_test_config'], true);

					$possibleResults = '<select name="finalResult[]" class="isRequired form-control input-sm" title="Please choose one" placeholder="Please choose final result for this sample"><option value="">--Select--</option>';
					foreach ($this->otherTestsPossibleResults as $pres) {
						$selected = ($pres['result_code'] == $reference['reference_result']) ? "selected='selected'" : "";
						$possibleResults .= '<option value="' . $pres['result_code'] . '" ' . $selected . '>' . $pres['response'] . '</option>';
					}
					$possibleResults .= "</select>";


				?>
					<table style="width: 1050px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="genericSampleTable">
						<thead>
							<tr>
								<th style="width:25%;">Sample ID</th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<?php if ((!isset($jsonConfig['testType']) || empty($jsonConfig['testType'])) || $jsonConfig['testType'] != 'quantitative') { ?>
									<th style="width:20%;">Final Result <span class='mandatory'>*</span></th>
								<?php } ?>
								<th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Is it a Control?"); ?></th>
								<th style="width:10%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:5%;text-align: center;vertical-align:middle;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php $counter = 1;
							$showISI = false;
							if (count($shipmentData['reference']) > 0) {
								foreach ($shipmentData['reference'] as $key => $reference) {
									$jsonConfig = Zend_Json_Decoder::decode($this->schemeDetails['user_test_config'], true);

									$localPossibleResults = '<select name="finalResult[]" class="isRequired form-control input-sm" title="Please choose one" placeholder="Please choose final result for this sample"><option value="">--Select--</option>';
									foreach ($this->otherTestsPossibleResults as $pres) {
										$selected = ($pres['result_code'] == $reference['reference_result']) ? "selected='selected'" : "";
										$localPossibleResults .= '<option value="' . $pres['result_code'] . '" ' . $selected . '>' . $pres['response'] . '</option>';
									}
									$localPossibleResults .= "</select>";
							?>
									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
										</td>
										<td>
											<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<?php if ((!isset($jsonConfig['testType']) || empty($jsonConfig['testType'])) || $jsonConfig['testType'] != 'quantitative') { ?>
											<td><?= $localPossibleResults; ?></td>
										<?php } ?>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<a href="javascript:void(0);" onclick="addGenericRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
											<?php if ($counter > 1) { ?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>
										</td>
									</tr>
								<?php
									$counter++;
								}
							} else { ?>
								<tr align="center">
									<th>
										<input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" />
									</th>
									<td>
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<?php if ((!isset($jsonConfig['testType']) || empty($jsonConfig['testType'])) || $jsonConfig['testType'] != 'quantitative') { ?>
										<td><?php echo $possibleResults; ?></td>
									<?php } ?>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" onclick="addGenericRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
									</td>
								</tr>
							<?php } ?>

						</tbody>
					</table>
					<br>

					<script type="text/javascript">
						var sampleCounter = $("#genericSampleTable tbody tr").length;

						function addGenericRow(obj) {
							sampleCounter++;

							var html = '<tr align="center"> \
								<th> \
									<input type="text" name="sampleName[]" class="isRequired form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /> \
								</th> \
								<td>\
									<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
								</td>\
								<?php if ((!isset($jsonConfig['testType']) || empty($jsonConfig['testType'])) || $jsonConfig['testType'] != 'quantitative') { ?> \
									<td><?php echo $possibleResults; ?></td>\
								<?php } ?> \
								<td> \
									<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option> \
										<option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option> \
										<option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><a href="javascript:void(0);" onclick="addGenericRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
							</tr>';
							$(obj.parentNode.parentNode).after(html);
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $this->defaultDateFormat(); ?>'
							});
							<?php if ($showISI) { ?>
								$(".ISI").show();
							<?php } ?>
						});

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}
					</script>


				<?php
				} elseif ($shipmentData['shipment']['scheme_type'] == 'recency') {
					$assayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyAssay as $assayId => $assayName) {
						$assayChoices .= '<option value="' . $assayId . '">' . $assayName . '</option>';
					}
					$allRecencyAssay = [];
					foreach ($shipmentData['recencyAssay'] as $recencyAssay) {
						$allRecencyAssay[] = $recencyAssay['sample_id'];
					}
					$assayChoices = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyAssay as $assayId => $assayName) {
						$assayChoices .= '<option value="' . $assayId . '">' . $assayName . '</option>';
					}
					$possibleResults = '<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$possibleResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}
					$possibleResults .= "</select>";
					$testResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
					foreach ($this->recencyPossibleResults as $pr) {
						if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
							$testResults .= '<option value="' . $pr['id'] . '">' . $pr['response'] . '</option>';
						}
					}

				?>

					<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
						<thead>
							<tr align="center">
								<th style="width:20%;text-align: center;"><?= $this->translate->_("Control/Sample"); ?></th>
								<th style="text-align: center;vertical-align:middle;"><?= $this->translate->_("Sample Preparation Date"); ?></th>
								<th style="width:22%;text-align: center;"><?= $this->translate->_("Results"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Verification Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Longterm Line"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Control?"); ?></th>
								<th style="width:10%;text-align: center;"><?= $this->translate->_("Mandatory?"); ?></th>
								<th style="width:13%;text-align: center;"><?= $this->translate->_("Add/Remove Row"); ?></th>
							</tr>
						</thead>
						<tbody>
							<?php
							if (isset($shipmentData['reference']) && count($shipmentData['reference']) > 0) {

								$counter = 1;
								foreach ($shipmentData['reference'] as $reference) { ?>

									<tr align="center">
										<td style="text-align: center">
											<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>" />
											<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
										</td>
										<td>
											<input type="text" value="<?php echo $this->dateFormat($reference['sample_preparation_date']); ?>" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
										</td>
										<td>

											<select name="possibleResults[]" class="isRequired form-control input-sm">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<?php

												foreach ($shipmentData['possibleResults'] as $pr) {
												?>
													<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
												<?php
												}
												?>
											</select>
										</td>
										<td>
											<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="present" <?php echo ($reference['reference_control_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_control_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="present" <?php echo ($reference['reference_diagnosis_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_diagnosis_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="present" <?php echo ($reference['reference_longterm_line'] == "present") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Present"); ?></option>
												<option value="absent" <?php echo ($reference['reference_longterm_line'] == "absent") ? "selected='selected'" : ""; ?>><?= $this->translate->_("Absent"); ?></option>
											</select>
										</td>
										<td>
											<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
												<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
												<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : ""; ?>><?= $this->translate->_("Yes"); ?></option>
												<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : ""; ?>><?= $this->translate->_("No"); ?></option>
											</select>
										</td>
										<td>
											<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleAssay<?php echo $reference['sample_id']; ?>', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a>
											<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
											<?php if ($counter > 1) { ?>
												<a href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
											<?php } ?>
										</td>
									</tr>
								<?php
									$counter++;
								}
							} else { ?>
								<tr align="center">
									<td style="text-align: center">
										<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" />
									</td>
									<td>
										<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />
									</td>
									<td>
										<?php echo $possibleResults; ?>
									</td>
									<td>
										<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="present"><?= $this->translate->_("Present"); ?></option>
											<option value="absent"><?= $this->translate->_("Absent"); ?></option>
										</select>
									</td>
									<td>
										<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
											<option value="">-- <?= $this->translate->_("Select"); ?> --</option>
											<option value="1"><?= $this->translate->_("Yes"); ?></option>
											<option value="0"><?= $this->translate->_("No"); ?></option>
										</select>
									</td>
									<td>
										<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleAssay1', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>
										<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
									</td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
					<br>
					<?php if (isset($shipmentData['reference']) && count($shipmentData['reference']) > 0) {
						$counter = 1;
						foreach ($shipmentData['reference'] as $reference) { ?>
							<div id="recencyAssayBlockHolder">
								<div id="sampleAssay<?php echo $reference['sample_id']; ?>" class="dialog">
									<span onClick="hidedefModal()" class="closeModal"></span>
									<div class="modal-header">
										<h4 class="modal-title"><?= $this->translate->_("Assay"); ?></h4>
									</div>
									<div class="modal-body">
										<div class="row">
											<div>
												<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
													<thead>
														<tr align="center">
															<th style="width:20%;text-align: center;"><?= $this->translate->_("Recency Assay"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>
															<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>
															<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>
														</tr>
													</thead>
													<tbody>
														<?php
														if (in_array($reference['sample_id'], $allRecencyAssay)) {
															$k = 0;
															foreach ($shipmentData['recencyAssay'] as $recencyAssay) {
																$testSelectedResults = '<option value="">--' . $this->translate->_("Select") . '--</option>';
																foreach ($this->recencyPossibleResults as $pr) {
																	if ($pr['scheme_sub_group'] == 'RECENCY_FINAL') {
																		$selected = ($pr['id'] == $recencyAssay['result']) ? "selected='selected'" : "";
																		$testSelectedResults .= '<option value="' . $pr['id'] . '" ' . $selected . '>' . $pr['response'] . '</option>';
																	}
																}
																if ($recencyAssay['sample_id'] == $reference['sample_id']) { ?>
																	<tr>
																		<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][assay][]"><?php $this->dropdownSelection($this->recencyAssay, $recencyAssay['assay'], true); ?></select></td>
																		<td><input type="text" name="assay[<?php echo $recencyAssay['sample_id']; ?>][lot][]" class="form-control" value="<?php echo $recencyAssay['lot_no']; ?>" /></td>
																		<td><input type="text" name="assay[<?php echo $recencyAssay['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($recencyAssay['expiry_date']); ?>" /></td>
																		<td>
																			<select class="form-control" name="assay[<?php echo $recencyAssay['sample_id']; ?>][result][]">
																				<?php echo $testSelectedResults; ?>
																			</select>
																		</td>
																		<td>
																			<a href="javascript:void(0);" onclick="addNewAssayRow(this,<?php echo $recencyAssay['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																			<?php
																			if ($k > 0) {
																			?>
																				<a href="javascript:void(0);" onclick="removeAssayRow(this,'<?php echo $recencyAssay['sample_id']; ?>')" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
																			<?php } ?>
																		</td>
																	</tr>
															<?php }
																$k++;
															}
														} else { ?>
															<tr>
																<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][assay][]"><?php echo $assayChoices; ?></select></td>
																<td><input type="text" name="assay[<?php echo $reference['sample_id']; ?>][lot][]" class="form-control" /></td>
																<td><input type="text" name="assay[<?php echo $reference['sample_id']; ?>][expiry][]" class="form-control datepicker" readonly="readonly" /></td>
																<td><select class="form-control" name="assay[<?php echo $reference['sample_id']; ?>][result][]"><?php echo $testResults; ?></select></td>
																<td>
																	<a href="javascript:void(0);" onclick="addNewAssayRow(this,<?php echo $reference['sample_id']; ?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
																</td>
															</tr>
														<?php } ?>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-primary" onclick="closeShipmentModal('sampleAssay<?php echo $reference['sample_id']; ?>')"><?= $this->translate->_("OK"); ?></button>
									</div>
								</div>
							</div> <!-- recencyAssayBlockHolder -->
						<?php }
					} else { ?>
						<div id="recencyAssayBlockHolder">
						</div> <!-- recencyAssayBlockHolder -->
					<?php } ?>
					<script type="text/javascript">
						var sampleCounter = 1;

						function addRecencyRow(obj) {
							sampleCounter++;
							//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
							$(obj.parentNode.parentNode).after('<tr align="center"> \
								<td style="text-align: center"> \
									<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
								</td>  \
								<td>\
									<input type="text" name="samplePreparationDate[]" readonly="readonly" class="isRequired form-control input-sm datepicker" placeholder="Please enter the sample preparation date" title="Please enter the sample preparation date" />\
								</td>\
								<td> \
									<?php echo $possibleResults; ?> \
								</td> \
								<td>\
									<select name="controlLine[]" class="isRequired form-control input-sm" title="Please choose control line">\
										<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td>\
									<select name="verificationLine[]" class="isRequired form-control input-sm" title="Please choose verification line">\
										<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td>\
									<select name="longtermLine[]" class="isRequired form-control input-sm" title="Please choose Longterm line">\
										<option value="">-- <?= $this->translate->_("Select"); ?> --</option>\
										<option value="present"><?= $this->translate->_("Present"); ?></option>\
										<option value="absent"><?= $this->translate->_("Absent"); ?></option>\
									</select>\
								</td>\
								<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
										<option value="1"><?= $this->translate->_("Yes"); ?></option><option value="0" selected="selected"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
										<option value="1" selected="selected"><?= $this->translate->_("Yes"); ?></option><option value="0"><?= $this->translate->_("No"); ?></option> \
									</select> \
								</td> \
								<td> \
									<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'sampleAssay' + sampleCounter + '\', 900,600);loadCal();"><i class="icon-beaker"></i> <?= $this->translate->_("Ref. Results"); ?> </a>\
									<a href="javascript:void(0);" onclick="addRecencyRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
									<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $this->defaultDateFormat(); ?>'
							});
							addNewAssayBlock(sampleCounter);
						}

						$(document).ready(function() {
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $this->defaultDateFormat(); ?>'
							});
						});

						function removeRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
							});
						}

						function addNewAssayBlock(sampleId) {
							$("#recencyAssayBlockHolder").after('<div id="sampleAssay' + sampleId + '" class="dialog">\
								<span onClick="hidedefModal()" class="closeModal"></span>\
								<div class="modal-header">\
									<h4 class="modal-title"><?= $this->translate->_("Assay"); ?></h4>\
								</div>\
								<div class="modal-body">\
									<div class="row">\
										<div >\
										<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
											<thead>\
												<tr align="center">\
													<th style="width:20%;text-align: center;"><?= $this->translate->_("Recency Assay"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Lot"); ?></th>\
													<th style="width:12%;text-align: center;"><?= $this->translate->_("Expiry"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Result"); ?></th>\
													<th style="width:10%;text-align: center;"><?= $this->translate->_("Options"); ?></th>\
												</tr>\
											</thead>\
											<tbody>\
												<tr>\
													<td><select class="form-control" name="assay[' + sampleId + '][assay][]"><?php echo $assayChoices; ?></select></td>\
													<td><input type="text" name="assay[' + sampleId + '][lot][]" class="form-control"/></td>\
													<td><input type="text" name="assay[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
													<td><select class="form-control" name="assay[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
													<td>\
														<a href="javascript:void(0);" onclick="addNewAssayRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
													</td>\
												</tr>\
											</tbody>\
										</table>\
										</div>\
									</div>\
									</div>\
									<div class="modal-footer">\
										<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleAssay' + sampleId + '\')">OK</button>\
									</div>\
								</div>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function addNewAssayRow(obj, sampleId) {
							$(obj.parentNode.parentNode).after('<tr> \
								<td><select class="form-control" name="assay[' + sampleId + '][assay][]"><?php echo $assayChoices; ?></select></td> \
								<td><input type="text" name="assay[' + sampleId + '][lot][]" class="form-control"/></td> \
								<td><input type="text" name="assay[' + sampleId + '][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
								<td><select class="form-control" name="assay[' + sampleId + '][result][]"><?php echo $testResults; ?></select></td>\
								<td> \
									<a href="javascript:void(0);" onclick="addNewAssayRow(this,' + sampleId + ')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
									<a  href="javascript:void(0);" onclick="removeAssayRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
								</td> \
							</tr>');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						}

						function removeAssayRow(obj) {
							$(obj.parentNode.parentNode).fadeOut("normal", function() {
								$(this).remove();
								//$('#sampleEia'+sampleId).remove();
							});
						}

						$(document).ready(function() {
							<?php if (!isset($shipmentData['reference']) && count($shipmentData['reference']) == 0) { ?>
								addNewAssayBlock('1');
							<?php } ?>
							//addNewWbBlock('1');
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							});
						});

						function loadCal() {
							$(".datepicker").removeClass("hasDatepicker");
							$(".datepicker").datepicker({
								dateFormat: '<?php echo $dtFormat; ?>'
							})
						}

						function closeShipmentModal(divId) {
							document.getElementById(divId).innerHTML = getEl("mbd").innerHTML;

							$("#mbd input:text").each(function(i, obj) {
								$("#" + divId + " input:text:eq(" + i + ")").val($(this).val());
							});
							$("#mbd select").each(function(i, obj) {
								$("#" + divId + " select:eq(" + i + ")").val($(this).val());
							});

							hidedefModal();
						}
					</script>


				<?php } ?>

			</div>

			<div style="margin: 0px auto 0px auto; text-align: center;" align="center">
				<input name="submitbtn" class="btn btn-primary btn-sm" type="button" onclick="validateNow();return false;" tabindex="7" value="Update Shipment" />
				<input class="btn btn-danger btn-sm" type="button" onclick="window.history.go(-1);" tabindex="8" value="<?= $this->translate->_("Cancel"); ?>" />
			</div>
		</form>
	</fieldset>
</div>

<script>
	var duplicated = false;

	function checkDuplicate(tableName, fieldName, obj, fnct, msg) {
		if (obj.val() == "" || obj.val() == null) {
			return;
		}
		$.post("<?php echo $this->url(array('module' => 'default', 'controller' => 'common', 'action' => 'check-duplicate')); ?>", {
				tableName: tableName,
				fieldName: fieldName,
				value: obj.val(),
				fnct: fnct,
				format: "html"
			},
			function(data) {
				if (data > 0) {
					alert(msg, "err");
					duplicated = true;
					obj.focus();
				} else {
					duplicated = false;
				}
			});
	}


	<?php
	$vHelper = $this->getHelper('DateFormat');
	$dtFormat =  $vHelper->getDateFormat();
	?>
	$(document).ready(function() {
		$(".datepicker").datepicker({
			dateFormat: '<?php echo $dtFormat; ?>'
		});

		$('#shipmentCode').on('input', function(event) {
			allowOnlyAlphaNumericAndHyphen('#shipmentCode');
		});
		$("body").on("change", 'select.controlOrNot', function() {
			var scoreElem = $(this).parent().parent().find('.score');
			if ($(this).val() == 1) {
				$(scoreElem).val(0);
				$(scoreElem).attr('readonly', 'readonly');
			} else {
				$(scoreElem).removeAttr('readonly');
			}

		});

		$('#captureAdditionalDetails').on("change", function() {
			if ($(this).val() == 'yes') {
				$("#additionalDetailLabel").attr("disabled", false);
				$("#additionalDetailLabel").addClass("isRequired");
			} else {
				$("#additionalDetailLabel").attr("disabled", true);
				$("#additionalDetailLabel").removeClass("isRequired");
			}

		});
	});



	function validateNow() {
		allowOnlyAlphaNumericAndHyphen('#shipmentCode');
		//checkDuplicate('shipment', 'shipment_code', $("#shipmentCode"), '<?php echo "shipment_id##" . $shipmentData['shipment']['shipment_id']; ?>', 'This Code already exists for another Shipment. Please try something else.')
		flag = deforayValidator.init({
			formId: 'shipmentForm'
		});
		if (flag && !duplicated) {
			$.blockUI();
			document.getElementById('shipmentForm').submit();
		}
	}
</script>
