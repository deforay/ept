<?php

//Zend_Debug::dump($this->shipmentData);
$shipmentData = $this->shipmentData;
$vHelper = $this->getHelper('DateFormat');
$dtFormat=  $vHelper->getDateFormat();
?>
<link rel="stylesheet" href="<?php echo $this->baseUrl("css/bootstrap-modal.css"); ?>" type="text/css" media="all">
<style type="text/css">
	.modal-scrollable{
		z-index: 1000 !important;
	}
	.modal-backdrop{
		z-index: 900 !important;
	}
	#mbd{
    overflow-y:scroll;
    max-height:100%;
}
</style>
<div class="well">
	<fieldset>
		<legend>Update Shipment Sample Details - <?php echo $shipmentData['shipment']['shipment_code']; ?></legend>
<form class="form-horizontal" name="shipmentForm" id="shipmentForm" method="post" action="<?php echo $this->url(array('module' => 'admin', 'controller' => 'shipment', 'action' => 'edit')); ?>" autocomplete="off">
            <div class="form-group">
                <label class="col-lg-3 control-label">Distribution Code </label>

                <div class="col-lg-5">
					<input type='text' disabled='disabled' class ='form-control' value='<?php echo $shipmentData['shipment']['distribution_code']; ?>' />
				</div>
				
				<input type="hidden" name="shipmentId" id="shipmentId" value="<?php echo $shipmentData['shipment']['shipment_id']; ?>" class="isRequired" title="Please choose a Scheme Type on the top of this page"/>
				<input type="hidden" name="selectedDistribution" id="selectedDistribution" class="" value="<?php echo $this->selectedDistribution; ?>"/>
				
            </div>		
            <div class="form-group">
                <label class="col-lg-3 control-label">Shipment Code </label>

                <div class="col-lg-5">
					<input type='text' name="shipmentCode" id="shipmentCode" class ='form-control isRequired' value='<?php echo $shipmentData['shipment']['shipment_code']; ?>' title="Please enter the Shipment Code" />
				</div>
				
				
            </div>		
		<div class="form-group">
			<label class="col-lg-3 control-label">Result Due Date</label>
			
			<div class="col-lg-5">
				<input type='text' readonly='readonly' name="lastDate" id="lastDate" class ='form-control datepicker isRequired' value='<?php echo $this->dateFormat($shipmentData['shipment']['lastdate_response']); ?>' title="Please choose the last response date" />
			</div>
				    
				    
		</div>		
		<div class="form-group" id="sampleFormFragment">


<?php
if($shipmentData['shipment']['scheme_type'] == 'dts'){
	
	$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		if($pr['scheme_sub_group'] == 'DTS_FINAL'){
			$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	$possibleResults .= "</select>";
	
	$eiaChoices ='<option value="">--Select--</option>';
	foreach($this->eia as $eiaId => $eiaName){
		$eiaChoices .= '<option value="'.$eiaId.'">'.$eiaName.'</option>';
	}
	
	$wbChoices ='<option value="">--Select--</option>';
	foreach($this->wb as $wbId => $wbName){
		$wbChoices .= '<option value="'.$wbId.'">'.$wbName.'</option>';
	}

	$allEia=array();
	foreach($shipmentData['eia'] as $eia){
		$allEia[]=$eia['sample_id'];
	}
	
	$allWb=array();
	foreach($shipmentData['wb'] as $wb){
		$allWb[]=$wb['sample_id'];
	}
	$allRhiv=array();
	foreach($shipmentData['rhiv'] as $rhiv){
		$allRhiv[]=$rhiv['sample_id'];
	}
	$dtskit ='<option value="">--Select--</option>';
	foreach($this->allTestKits as $kitId => $kitName){
		$dtskit .= '<option value="'.$kitId.'">'.$kitName.'</option>';
	}
	$testResults ='<option value="">--Select--</option>';
	foreach($this->dtsPossibleResults as $pr){
		if($pr['scheme_sub_group'] == 'DTS_TEST'){
			$testResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	?>
<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:25%;text-align: center;">Sample</th>
			<th style="width:10%;text-align: center;">Final Result</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="width:10%;text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">Score</th>
			<th style="width:20%;text-align: center;">Option</th>
		</tr>
	</thead>
	<tbody>
		<?php
		$counter = 1;
		if(sizeof($shipmentData['reference'])>0){
		foreach($shipmentData['reference'] as $reference){
		?>
		<tr align="center">
			<td style="text-align: center">
				<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>"/>
				<input type="hidden" id ="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id'];?>" />
				<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
			</td>
			<td>
				<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
					<?php
					foreach($shipmentData['possibleResults'] as $pr){
						if($pr['scheme_sub_group'] == 'DTS_FINAL'){
					?>
						<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
					<?php
						}
					}
					?>
				</select>
				
			</td>
			<td>
				<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
					<option value="">--Select--</option>
					<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
					<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
				</select>
			</td>
			<td>
				<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
					<option value="">--Select--</option>
					<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
					<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
				</select>
			</td>
			<td>
				<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
			</td>
			<td>
				<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleEia<?php echo $reference['sample_id'];?>', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a>
				<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a>
				<?php
				if($counter > 1){
					?>
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
					<?php
				}
				?>
				
				
				
					<div id="sampleEia<?php echo $reference['sample_id'];?>" class="dialog" tabindex="-1" data-width="860">
					<span onClick="hidedefModal()" class="closeModal"></span>
						<div class="modal-header">
						      <h4 class="modal-title">EIA</h4>
						</div>
						<div class="modal-body">
						      <div class="row">
							      <div>
								      <table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
									      <thead>
										      <tr align="center">
											      <th style="width:20%;text-align: center;">EIA</th>
											      <th style="width:10%;text-align: center;">Lot</th>
											      <th style="width:12%;text-align: center;">Expiry</th>
											      <th style="width:10%;text-align: center;">OD</th>
											      <th style="width:10%;text-align: center;">Cutoff</th>
											      <th style="width:10%;text-align: center;">Options</th>
										      </tr>
									      </thead>
									      <tbody>
										      <?php
											if (in_array($reference['sample_id'], $allEia)){
												$k=0;
											foreach($shipmentData['eia'] as $eia){
												if($eia['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
											      <td><select class="form-control" name="eia[<?php echo $eia['sample_id'];?>][eia][]" ><?php $this->dropdownSelection($this->eia,$eia['eia'],true); ?></select></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][expiry][]"  class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>"/></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeDbsRow(this,'<?php echo $eia['sample_id'];?>')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
												}
												$k++;
											}
											}else{
										      ?>
										      <tr>
											      <td><select class="form-control" name="eia[<?php echo $reference['sample_id'];?>][eia][]"><?php echo $eiaChoices; ?></select></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][lot][]" class="form-control" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][od][]" class="form-control" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][cutoff][]" class="form-control" value=""/></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
											      </td>
										      </tr>
										      <?php } ?>
									      </tbody>
								      </table>
							      </div>
						      </div>
						</div>
						
						<div class="modal-header">
							<h4 class="modal-title">WB</h4>
						</div>
						
						
						
						<div class="modal-body">
						      <div class="row" style="overflow-x:scroll;">
							      <div>
								      <table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
									      <thead>
										      <tr align="center">
												<th style="text-align: center;">WB</th>
												<th style="text-align: center;">Lot</th>
												<th style="text-align: center;">Expiry</th>
												<th style="text-align: center;">160</th>
												<th style="text-align: center;">120</th>
												<th style="text-align: center;">66</th>
												<th style="text-align: center;">55</th>
												<th style="text-align: center;">51</th>
												<th style="text-align: center;">41</th>
												<th style="text-align: center;">31</th>
												<th style="text-align: center;">24</th>
												<th style="text-align: center;">17</th>
												<th style="text-align: center;">Options</th>
										      </tr>
									      </thead>
									      <tbody>
										      <?php
											if (in_array($reference['sample_id'], $allWb)){
												$k=0;
											foreach($shipmentData['wb'] as $wb){
												if($wb['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
												<td><select class="form-control" name="wb[<?php echo $wb['sample_id'];?>][wb][]" id="sample<?php echo $wb['sample_id'];?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb,$wb['wb'],true); ?></select></td>
												<td><input type="text" name="wb[<?php echo $wb['sample_id'];?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>"/></td>
												<td><input type="text" name="wb[<?php echo $wb['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>"/></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
											      
											      
											      <td>
												      <a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id'];?>')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
											$k++;
												}
												
											}
											}else{
										      ?>
										      <tr>
												
												<td><select class="form-control" name="wb[<?php echo $reference['sample_id'];?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
												<td><input type="text" name="wb[<?php echo $reference['sample_id'];?>][lot][]" class="form-control" style="width:100px;"/></td>
												<td><input type="text" name="wb[<?php echo $reference['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td>
													<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												</td>
										      </tr>
										      <?php } ?>
									      </tbody>
								      </table>
							      </div>
						      </div>
						</div>
						
						
						<div class="modal-header">
						      <h4 class="modal-title">RAPID HIV TESTING</h4>
						</div>
						<div class="modal-body">
						      <div class="row">
							      <div>
								      <table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
									      <thead>
										      <tr align="center">
											        <th style="width:20%;text-align: center;">Kit Name</th>
												<th style="width:10%;text-align: center;">Lot</th>
												<th style="width:12%;text-align: center;">Expiry</th>
												<th style="width:15%;text-align: center;">Result</th>
												<th style="width:5%;text-align: center;">Options</th>
										      </tr>
									      </thead>
									      <tbody>
										      <?php
											if (in_array($reference['sample_id'], $allRhiv)){
												$k=0;
											foreach($shipmentData['rhiv'] as $rhiv){
												if($rhiv['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
											      <td><select class="form-control" name="rhiv[<?php echo $rhiv['sample_id'];?>][kit][]" ><?php $this->dropdownSelection($this->allTestKits,$rhiv['testkit'],true); ?></select></td>
											      <td><input type="text" name="rhiv[<?php echo $rhiv['sample_id'];?>][lot][]" class="form-control" value="<?php echo $rhiv['lot_no']; ?>"/></td>
											      <td><input type="text" name="rhiv[<?php echo $rhiv['sample_id'];?>][expiry][]"  class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($rhiv['expiry_date']); ?>"/></td>
											      <td>
												<select class="form-control" name="rhiv[<?php echo $rhiv['sample_id'];?>][result][]">
												<option value="">--Select--</option>
												<?php
												foreach($this->dtsPossibleResults as $pr){
													if($pr['scheme_sub_group'] == 'DTS_TEST'){
												?>
												<option value='<?php echo $pr['id'];?>' <?php echo (isset($pr['id']) && $pr['id'] == $rhiv['result']) ? "selected='selected'" : ""; ?>><?php echo $pr['response'];?></option>
												<?php
												}
												}
												?>
											      </select>
											      </td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $rhiv['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeHivRow(this,'<?php echo $rhiv['sample_id'];?>')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
												}
												$k++;
											}
											}else{
										      ?>
										      <tr>
											        <td><select class="form-control" name="rhiv[<?php echo $reference['sample_id'];?>][kit][]"><?php echo $dtskit; ?></select></td> 
												<td><input type="text" name="rhiv[<?php echo $reference['sample_id'];?>][lot][]" class="form-control"/></td> 
												<td><input type="text" name="rhiv[<?php echo $reference['sample_id'];?>'][expiry][]" class="form-control datepicker" readonly="readonly"/></td> 
												<td><select class="form-control" name="rhiv[<?php echo $reference['sample_id'];?>][result][]"><?php echo $testResults; ?></select></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewHivRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
											      </td>
										      </tr>
										      <?php } ?>
									      </tbody>
								      </table>
							      </div>
						      </div>
						</div>
						
						
						

						<div class="modal-footer">
						      <button type="button" onclick="closeShipmentModal('sampleEia<?php echo $reference['sample_id'];?>');return false;" class="btn btn-primary">OK</button>
						</div>
					</div>
				
				
				
				
				
			</td>
		</tr>

		<?php
		$counter++;
		}}else{
		?>
		<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<?php echo $possibleResults; ?>
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1">Yes</option>
						<option value="0">No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1">Yes</option>
						<option value="0">No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" />
				</td>
				<td>
					<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a>
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a>
					
				</td>
			</tr>
		<?php } ?>
	</tbody>
</table>
<br>
<div id="eiaBlockHolder">

</div> <!-- eiaBlockHolder -->
<div id="wbBlockHolder">

</div> <!-- wbBlockHolder -->
<script type="text/javascript">
	var sampleCounter = 1;
	$(document).ready(function(){
		<?php
		$i=1;
		if(count($shipmentData['reference'])>0){
		foreach($shipmentData['reference'] as $reference){
		?>
		
		addNewEiaBlock('<?php echo $i; ?>');
		addNewWbBlock('<?php echo $i; ?>');
		
		<?php
		$i++;
		} }else{?>
		addNewEiaBlock(sampleCounter);
		addNewWbBlock(sampleCounter);
		<?php } ?>
	});
	
	function addDtsRow(obj) {
            sampleCounter++;
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal(\'sampleEia'+sampleCounter+'\', 900,600);loadCal();"><i class="icon-beaker"></i> Ref. Results </a> \
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
		addNewEiaBlock(sampleCounter);
		
                
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}
	
	$(document).ready(function(){
		$(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	});
	
        
	function closeShipmentModal(divId) {
		document.getElementById(divId).innerHTML=getEl("mbd").innerHTML;
		
		$("#mbd input:text" ).each(function(i, obj) {
		    $("#"+divId+" input:text:eq("+i+")").val($(this).val());
		});
		$("#mbd select" ).each(function(i, obj) {
		    $("#"+divId+" select:eq("+i+")").val($(this).val());
		});
	    
		hidedefModal();
        }	
	
function addNewEiaBlock(sampleId) {
		$("#eiaBlockHolder").after('<div id="sampleEia'+sampleId+'" class="closeModal">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title">EIA</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;">EIA</th>\
									<th style="width:10%;text-align: center;">Lot</th>\
									<th style="width:12%;text-align: center;">Expiry</th>\
									<th style="width:10%;text-align: center;">OD</th>\
									<th style="width:10%;text-align: center;">Cutoff</th>\
									<th style="width:10%;text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="eia['+sampleId+'][eia][]"><?php echo $eiaChoices; ?></select></td>\
									<td><input type="text" name="eia['+sampleId+'][lot][]" class="form-control"/></td>\
									<td><input type="text" name="eia['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><input type="text" name="eia['+sampleId+'][od][]" class="form-control"/></td>\
									<td><input type="text" name="eia['+sampleId+'][cutoff][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  \
                                   \<div class="modal-header">\
					<h4 class="modal-title">WB</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;">WB</th>\
									<th style="text-align: center;">Lot</th>\
									<th style="text-align: center;">Expiry</th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb['+sampleId+'][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb['+sampleId+'][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb['+sampleId+'][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleId+'][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				     \
				    <div class="modal-header">\
					<h4 class="modal-title"> RAPID HIV TESTING</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;">Kit Name</th>\
									<th style="width:10%;text-align: center;">Lot</th>\
									<th style="width:12%;text-align: center;">Expiry</th>\
									<th style="width:10%;text-align: center;">Result</th>\
									<th style="width:10%;text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="rhiv['+sampleId+'][kit][]"><?php echo $dtskit; ?></select></td>\
									<td><input type="text" name="rhiv['+sampleId+'][lot][]" class="form-control"/></td>\
									<td><input type="text" name="rhiv['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly"/></td>\
									<td><select class="form-control" name="rhiv['+sampleId+'][result][]"><?php echo $testResults; ?></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewHivRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
                                     <div class="modal-footer">\
					<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleEia'+sampleId+'\')">OK</button>\
				  </div>\
				</div>');
	}
	
	function addNewEiaRow(obj,sampleId) {
		$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="eia['+sampleId+'][eia][]"><?php echo $eiaChoices; ?></select></td> \
							<td><input type="text" name="eia['+sampleId+'][lot][]" class="form-control"/></td> \
							<td><input type="text" name="eia['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><input type="text" name="eia['+sampleId+'][od][]" class="form-control"/></td> \
							<td><input type="text" name="eia['+sampleId+'][cutoff][]" class="form-control"/></td> \
							<td> \
								<a href="javascript:void(0);" onclick="addNewEiaRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeEiaRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}
	
	function removeEiaRow(obj,sampleId) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
			$('#sampleEia'+sampleId).remove();
		});
	}
	
	function addNewWbBlock(sampleWbId) {
		$("#wbBlockHolder").after('<div id="sampleWb'+sampleWbId+'" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title">WB</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;">WB</th>\
									<th style="text-align: center;">Lot</th>\
									<th style="text-align: center;">Expiry</th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb['+sampleWbId+'][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb['+sampleWbId+'][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb['+sampleWbId+'][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb['+sampleWbId+'][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,'+sampleWbId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>\
				  </div>\
				</div>');
		$(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
		
	}
	
	function addNewWbRow(obj,sampleWbId) {
		$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb['+sampleWbId+'][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb['+sampleWbId+'][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb['+sampleWbId+'][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb['+sampleWbId+'][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,'+sampleWbId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,'+sampleWbId+')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}
	function addNewHivRow(obj,sampleId) {
		$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="rhiv['+sampleId+'][kit][]"><?php echo $dtskit; ?></select></td> \
							<td><input type="text" name="rhiv['+sampleId+'][lot][]" class="form-control"/></td> \
							<td><input type="text" name="rhiv['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
							<td><select class="form-control" name="rhiv['+sampleId+'][result][]"><?php echo $testResults; ?></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewHivRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeHivRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}
	
	function removeHivRow(obj,sampleId) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
			//$('#sampleWb'+sampleId).remove();
		});
	}
	
	function removeWbRow(obj,sampleId) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
			//$('#sampleWb'+sampleId).remove();
		});
	}
	
	function loadCal() {
		$(".datepicker").removeClass("hasDatepicker");
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'})
	}
	
</script>
<?php
}
if($shipmentData['shipment']['scheme_type'] == 'dbs'){
	
	
	$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		if($pr['scheme_sub_group'] == 'DBS_FINAL'){
			$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	$possibleResults .= "</select>";
	$eiaChoices ='<option value="">--Select--</option>';
	foreach($this->eia as $eiaId => $eiaName){
		$eiaChoices .= '<option value="'.$eiaId.'">'.$eiaName.'</option>';
	}
	
	$wbChoices ='<option value="">--Select--</option>';
	foreach($this->wb as $wbId => $wbName){
		$wbChoices .= '<option value="'.$wbId.'">'.$wbName.'</option>';
	}

	$allEia=array();
	foreach($shipmentData['eia'] as $eia){
		$allEia[]=$eia['sample_id'];
	}
	
	$allWb=array();
	foreach($shipmentData['wb'] as $wb){
		$allWb[]=$wb['sample_id'];
	}
	
	?>


<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="dbsSampleTable">
	<thead>
		<tr align="center">
			<th style="width:20%;text-align: center;">Sample</th>
			<th style="width:10%;text-align: center;">Final Result</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="width:10%;text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">Score</th>
			<th style="width:20%;text-align: center;">Options</th>
		</tr>
	</thead>
	<tbody>
		<?php
		
		$counter = 1;
		if(count($shipmentData['reference'])>0){
		foreach($shipmentData['reference'] as $reference){
	    ?>
		 <tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>"/>
					<input type="hidden" id ="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id'];?>" />
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
						<?php
						foreach($shipmentData['possibleResults'] as $pr){
							if($pr['scheme_sub_group'] == 'DBS_FINAL'){
								?>
								<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
								<?php
							}
						}
						?>
					</select>
						
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
				<td>
					<a data-toggle="modal" href="#sampleEia<?php echo $reference['sample_id'];?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a>
					<a data-toggle="modal" href="#sampleWb<?php echo $reference['sample_id'];?>" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB</a>
					<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a>
					<?php
					if($counter > 1){
						?>
						<a  href="javascript:void(0);" onclick="removeDbsRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
			<tr style="display: none;">
				<td colspan="6">
					<div id="sampleEia<?php echo $reference['sample_id'];?>" class="modal fade" tabindex="-1" data-width="860" style="display: none;">
						<div class="modal-header">
						      <h4 class="modal-title">EIA</h4>
						</div>
						<div class="modal-body">
						      <div class="row">
							      <div>
								      <table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
									      <thead>
										      <tr align="center">
											      <th style="width:20%;text-align: center;">EIA</th>
											      <th style="width:10%;text-align: center;">Lot</th>
											      <th style="width:12%;text-align: center;">Expiry</th>
											      <th style="width:10%;text-align: center;">OD</th>
											      <th style="width:10%;text-align: center;">Cutoff</th>
											      <th style="width:10%;text-align: center;">Options</th>
										      </tr>
									      </thead>
									      <tbody>
										      <?php
											if (in_array($reference['sample_id'], $allEia)){
												$k=0;
											foreach($shipmentData['eia'] as $eia){
												if($eia['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
											      <td><select class="form-control" name="eia[<?php echo $eia['sample_id'];?>][eia][]" ><?php $this->dropdownSelection($this->eia,$eia['eia'],true); ?></select></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][lot][]" class="form-control" value="<?php echo $eia['lot']; ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" value="<?php echo $this->dateFormat($eia['exp_date']); ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][od][]" class="form-control" value="<?php echo $eia['od']; ?>"/></td>
											      <td><input type="text" name="eia[<?php echo $eia['sample_id'];?>][cutoff][]" class="form-control" value="<?php echo $eia['cutoff']; ?>"/></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $eia['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeDbsRow(this,'<?php echo $eia['sample_id'];?>')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
												}
												$k++;
											}
											}else{
										      ?>
										      <tr>
											      <td><select class="form-control" name="eia[<?php echo $reference['sample_id'];?>][eia][]"><?php echo $eiaChoices; ?></select></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][lot][]" class="form-control" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][od][]" class="form-control" value=""/></td>
											      <td><input type="text" name="eia[<?php echo $reference['sample_id'];?>][cutoff][]" class="form-control" value=""/></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewEiaRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
											      </td>
										      </tr>
										      <?php } ?>
									      </tbody>
								      </table>
							      </div>
						      </div>
						</div>
						<div class="modal-footer">
						      <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
						</div>
					</div>
				</td>
			</tr>
			<tr style="display: none;">
				<td colspan="6">
					
					<div id="sampleWb<?php echo $reference['sample_id'];?>" class="modal fade" tabindex="-1" data-width="960" style="display: none;">
						<div class="modal-header">
							<h4 class="modal-title">WB</h4>
						</div>
						<div class="modal-body">
						      <div class="row" style="overflow-x:scroll;">
							      <div>
								      <table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
									      <thead>
										      <tr align="center">
												<th style="text-align: center;">WB</th>
												<th style="text-align: center;">Lot</th>
												<th style="text-align: center;">Expiry</th>
												<th style="text-align: center;">160</th>
												<th style="text-align: center;">120</th>
												<th style="text-align: center;">66</th>
												<th style="text-align: center;">55</th>
												<th style="text-align: center;">51</th>
												<th style="text-align: center;">41</th>
												<th style="text-align: center;">31</th>
												<th style="text-align: center;">24</th>
												<th style="text-align: center;">17</th>
												<th style="text-align: center;">Options</th>
										      </tr>
									      </thead>
									      <tbody>
										      <?php
											if (in_array($reference['sample_id'], $allWb)){
												$k=0;
											foreach($shipmentData['wb'] as $wb){
												if($wb['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
												<td><select class="form-control" name="wb[<?php echo $wb['sample_id'];?>][wb][]" id="sample<?php echo $wb['sample_id'];?>-wb" style="width:125px;"><?php $this->dropdownSelection($this->wb,$wb['wb'],true); ?></select></td>
												<td><input type="text" name="wb[<?php echo $wb['sample_id'];?>][lot][]" class="form-control" style="width:100px;" value="<?php echo $wb['lot']; ?>"/></td>
												<td><input type="text" name="wb[<?php echo $wb['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;" value="<?php echo $this->dateFormat($wb['exp_date']); ?>"/></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['160']) && $wb['160'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['160']) && $wb['160'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['120']) && $wb['120'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['120']) && $wb['120'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['66']) && $wb['66'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['66']) && $wb['66'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['55']) && $wb['55'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['55']) && $wb['55'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['51']) && $wb['51'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['51']) && $wb['51'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['41']) && $wb['41'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['41']) && $wb['41'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['31']) && $wb['31'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['31']) && $wb['31'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['24']) && $wb['24'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['24']) && $wb['24'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
												<td><select name="wb[<?php echo $wb['sample_id'];?>][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1" <?php echo (isset($wb['17']) && $wb['17'] == 1) ? "selected='selected'" : ""; ?>>+</option><option value="0" <?php echo (isset($wb['17']) && $wb['17'] == 0) ? "selected='selected'" : ""; ?>>-</option></select></td>
											      
											      
											      <td>
												      <a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $wb['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeWbRow(this,'<?php echo $wb['sample_id'];?>')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
											$k++;
												}
												
											}
											}else{
										      ?>
										      <tr>
												
												<td><select class="form-control" name="wb[<?php echo $reference['sample_id'];?>][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>
												<td><input type="text" name="wb[<?php echo $reference['sample_id'];?>][lot][]" class="form-control" style="width:100px;"/></td>
												<td><input type="text" name="wb[<?php echo $reference['sample_id'];?>][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td><select name="wb[<?php echo $reference['sample_id'];?>][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>
												<td>
													<a href="javascript:void(0);" onclick="addNewWbRow(this,<?php echo $reference['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												</td>
										      </tr>
										      <?php } ?>
									      </tbody>
								      </table>
							      </div>
						      </div>
						</div>
						<div class="modal-footer">
						      <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
						</div>
					</div>
				</td>
			</tr>
		<?php
		$counter++;
		}
		}else{
		?>
		 <tr align="center">
			<td style="text-align: center">
				<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/>
			</td>
			<td>
				<?php echo $possibleResults; ?>
			</td>
			<td>
				<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
					<option value="">--Select--</option>
					<option value="1">Yes</option>
					<option value="0">No</option>
				</select>
			</td>
			<td>
				<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
					<option value="">--Select--</option>
					<option value="1">Yes</option>
					<option value="0">No</option>
				</select>
			</td>
			<td>
				<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" />
			</td>
			<td>
				<a data-toggle="modal" href="#sampleEia1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a>
				<a data-toggle="modal" href="#sampleWb1" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB</a>
				<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i>Sample/Control</a>
				
			</td>
		</tr>
		<?php } ?>
	</tbody>
</table>
<br>
<div id="eiaBlockHolder">

</div> <!-- eiaBlockHolder -->
<div id="wbBlockHolder">

</div> <!-- wbBlockHolder -->
<script type="text/javascript">
	var sampleCounter = 1;
	
	$(document).ready(function(){
		$(".datepicker").on("click",function(){
		//$(this).val('');
		
		$(this).datepicker({dateFormat: '<?php echo $dtFormat;?>'})
	});
		sampleCounter = $("#dbsSampleTable tbody tr").length;
		<?php
		$i=1;
		if(count($shipmentData['reference'])>0){
		foreach($shipmentData['reference'] as $reference){
		?>
		addNewEiaBlock('<?php echo $i; ?>');
		addNewWbBlock('<?php echo $i; ?>');
		<?php
		$i++;
		}
		}else{
		?>
		addNewEiaBlock(sampleCounter);
		addNewWbBlock(sampleCounter);
		<?php
		}
		?>
	})
	function addDbsRow(obj) {
		sampleCounter++;
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a data-toggle="modal" href="#sampleEia'+sampleCounter+'" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> EIA </a> \
					<a data-toggle="modal" href="#sampleWb'+sampleCounter+'" class="btn btn-xs btn-primary" onclick="loadCal()"><i class="icon-beaker"></i> WB </a> \
					<a href="javascript:void(0);" onclick="addDbsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i> Sample/Control</a> \
					<a href="javascript:void(0);" onclick="removeDbsRow(this,'+sampleCounter+')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
		addNewEiaBlock(sampleCounter);
		addNewWbBlock(sampleCounter);
		
	}
	function addNewEiaRow(obj,sampleId) {
		$(obj.parentNode.parentNode).after('<tr> \
									<td><select class="form-control" name="eia['+sampleId+'][eia][]"><?php echo $eiaChoices; ?></select></td> \
									<td><input type="text" name="eia['+sampleId+'][lot][]" class="form-control"/></td> \
									<td><input type="text" name="eia['+sampleId+'][expiry][]" class="form-control datepicker" readonly="readonly"/></td> \
									<td><input type="text" name="eia['+sampleId+'][od][]" class="form-control"/></td> \
									<td><input type="text" name="eia['+sampleId+'][cutoff][]" class="form-control"/></td> \
									<td> \
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
										<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td> \
								</tr>');
		$(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}
	function addNewEiaBlock(sampleId) {
		$("#eiaBlockHolder").after('<div id="sampleEia'+sampleId+'" class="modal fade" tabindex="-1" data-width="860" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title">EIA</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:20%;text-align: center;">EIA</th>\
									<th style="width:10%;text-align: center;">Lot</th>\
									<th style="width:12%;text-align: center;">Expiry</th>\
									<th style="width:10%;text-align: center;">OD</th>\
									<th style="width:10%;text-align: center;">Cutoff</th>\
									<th style="width:10%;text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="eia['+sampleId+'][eia][]"><?php echo $eiaChoices; ?></select></td>\
									<td><input type="text" name="eia['+sampleId+'][lot][]" class="form-control"/></td>\
									<td><input type="text" name="eia['+sampleId+'][expiry][]" class="form-control datepicker"/></td>\
									<td><input type="text" name="eia['+sampleId+'][od][]" class="form-control"/></td>\
									<td><input type="text" name="eia['+sampleId+'][cutoff][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewEiaRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>\
				  </div>\
				</div>');
		
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
	function removeDbsRow(obj,sampleId) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
			$('#sampleEia'+sampleId).remove();
		});
	}
	
	function addNewWbBlock(sampleWbId) {
		$("#wbBlockHolder").after('<div id="sampleWb'+sampleWbId+'" class="modal fade" tabindex="-1" data-width="960" style="display: none;">\
				  <div class="modal-header">\
					<h4 class="modal-title">WB</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row" style="overflow-x:scroll;">\
					  <div >\
						<table style="width: 100%;margin: 0 auto;overflow:scroll" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="text-align: center;">WB</th>\
									<th style="text-align: center;">Lot</th>\
									<th style="text-align: center;">Expiry</th>\
									<th style="text-align: center;">160</th>\
									<th style="text-align: center;">120</th>\
									<th style="text-align: center;">66</th>\
									<th style="text-align: center;">55</th>\
									<th style="text-align: center;">51</th>\
									<th style="text-align: center;">41</th>\
									<th style="text-align: center;">31</th>\
									<th style="text-align: center;">24</th>\
									<th style="text-align: center;">17</th>\
									<th style="text-align: center;">Options</th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="wb['+sampleWbId+'][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
									<td><input type="text" name="wb['+sampleWbId+'][lot][]" class="form-control" style="width:100px;"/></td>\
									<td><input type="text" name="wb['+sampleWbId+'][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
									<td><select name="wb['+sampleWbId+'][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td><select name="wb['+sampleWbId+'][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewWbRow(this,'+sampleWbId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
					<button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>\
				  </div>\
				</div>');
		$(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
		
	}
	
	function addNewWbRow(obj,sampleWbId) {
		$(obj.parentNode.parentNode).after('<tr> \
							<td><select class="form-control" name="wb['+sampleWbId+'][wb][]" style="width:125px;"><?php echo $wbChoices; ?></select></td>\
							<td><input type="text" name="wb['+sampleWbId+'][lot][]" class="form-control" style="width:100px;"/></td>\
							<td><input type="text" name="wb['+sampleWbId+'][expiry][]" class="form-control datepicker" readonly="readonly" style="width:125px;"/></td>\
							<td><select name="wb['+sampleWbId+'][160][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][120][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][66][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][55][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][51][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][41][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][31][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][24][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td><select name="wb['+sampleWbId+'][17][]" style="width:70px;font-weight:bold;" class="form-control"><option value=""></option><option value="1">+</option><option value="0">-</option></select></td>\
							<td> \
								<a href="javascript:void(0);" onclick="addNewWbRow(this,'+sampleWbId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a> \
								<a  href="javascript:void(0);" onclick="removeWbRow(this,'+sampleWbId+')" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
							</td> \
						</tr>');
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}
	
	function removeWbRow(obj,sampleId) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
			//$('#sampleWb'+sampleId).remove();
		});
	}
	
	function loadCal() {
		$(".datepicker").removeClass("hasDatepicker");
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'})
	}
</script>
<?php
}
if($shipmentData['shipment']['scheme_type'] == 'eid'){

	$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
	}
	
	$possibleResults .= "</select>";
	
	?>
	
<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:20%;text-align: center;">Control/Sample</th>
			<th style="width:22%;text-align: center;">Results</th>
			<th style="width:10%;text-align: center;">HIV CT/OD</th>
			<th style="width:10%;text-align: center;">IC/QS Values</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="width:10%;text-align: center;">Mandatory ?</th>			
			<th style="width:13%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php  $counter = 1;

		foreach($shipmentData['reference'] as $reference){ 
		
		?>
		
			<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					
					<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>
						<?php
						 
							foreach($shipmentData['possibleResults'] as $pr){
								?>
								<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
								<?php
							}
						?>
					</select>
				</td>
				<td>
					<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values"  title="Please enter the HIV CT/OD values here" value="<?php echo $reference['reference_hiv_ct_od'] ?>"/>
				</td>
				<td>
					<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values"  title="Please enter the IC/QS Values here" value="<?php echo $reference['reference_ic_qs'] ?>" />
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
			    <td>
					<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		
		
		<?php
		$counter++;
		} ?>
	</tbody>
</table>
<br>

<script type="text/javascript">
	function addEidRow(obj) {
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td> \
				<td> \
					<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /> \
				</td>\
				<td> \
					<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td> \
					<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>


	<?php
} else if($shipmentData['shipment']['scheme_type'] == 'vl'){
	
	$vlAssayChoices ='<option value="">--Select--</option>';
	foreach($this->vlAssay as $id => $name){
		$vlAssayChoices .= '<option value="'.$id.'">'.$name.'</option>';
	}
	
	$allVlRefMethods=array();
	foreach($shipmentData['vlReferenceMethods'] as $vlRefMet){
		$allVlRefMethods[]=$vlRefMet['sample_id'];
	}
	
	
	?>
	
<table style="width: 850px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:25%;text-align: center;">Control/Sample</th>
			<th style="text-align: center;">Control ?</th>
			<th style="text-align: center;">Mandatory ?</th>
			<th style="width:25%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php $counter =1;
		//var_dump($shipmentData['vlReferenceMethods']);die;
		foreach($shipmentData['reference'] as $reference){
		
		?>
		
		
			<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
			    <td>
					<a href="javascript:void(0);" class="btn btn-xs btn-primary" onclick="showdefModal('sampleReferenceResult'+<?php echo $reference['sample_id']; ?>, 900,550);"><i class="icon-beaker"></i> Ref. Results </a>
					<a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
					
				<div id="sampleReferenceResult<?php echo $reference['sample_id']; ?>" class="dialog">
                <span onClick="hidedefModal()" class="closeModal"></span>
				  <div class="modal-header">
					<h4 class="modal-title">Reference Results</h4>
				  </div>
				  <div class="modal-body">
					<div class="row">
					  <div >
						<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">
							<thead>
								<tr align="center">
									<th style="width:50%;text-align: center;">VL Assay</th>
									<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>
									<th style="width:15%;text-align: center;"></th>
								</tr>
							</thead>
							<tbody>
							<?php
								if (in_array($reference['sample_id'], $allVlRefMethods)){
												$k=0;
											foreach($shipmentData['vlReferenceMethods'] as $vlref){
												if($vlref['sample_id']==$reference['sample_id']){
										      ?>
										      <tr>
											      <td><select class="form-control" name="vlRef[<?php echo $vlref['sample_id'];?>][assay][]" ><?php $this->dropdownSelection($this->vlAssay,$vlref['assay'],true); ?></select></td>
											      <td><input type="text" name="vlRef[<?php echo $vlref['sample_id'];?>][value][]" class="form-control" value="<?php echo $vlref['value']; ?>"/></td>
											      <td>
												      <a href="javascript:void(0);" onclick="addNewVlRefRow(this,<?php echo $vlref['sample_id'];?>)" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
												      <?php
												      if($k > 0){
												      ?>
												      <a href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
												      <?php } ?>
											      </td>
										      </tr>
										      <?php
												}
												$k++;
											}
											}else { ?>
												<tr>
													<td><select class="form-control" name="vlRef[<?php echo $reference['sample_id']; ?>][assay][]"><?php echo $vlAssayChoices; ?></select></td>
													<td><input type="text" name="vlRef[<?php echo $reference['sample_id']; ?>][value][]" class="form-control"/></td>
													<td>
														<a href="javascript:void(0);" onclick="addNewVlRefRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>
													</td>
												</tr>
								<?php } ?>
							</tbody>
						</table>
					  </div>
					</div>
				  </div>
				  <div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="closeShipmentModal('<?php echo "sampleReferenceResult".$reference['sample_id']; ?>')">OK</button>
				  </div>
				</div>
					
					
					
					
				</td>
			</tr>
		
		
		<?php
		$counter++;
		}
		
		?>
			
		</tbody>
</table>
<br>

<script type="text/javascript">
	function addVlRow(obj) {
		$(obj.parentNode.parentNode).after('<tr align="center"> \
												<th><input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" title="Please enter the Sample Name"  placeholder="Please enter the Sample Name" /></th> \
												<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
														<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
													</select> \
												</td> \
												<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
														<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
													</select> \
												</td> \
												<td><a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
											</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}
	

function addNewReferenceResultBlock(sampleId) {
		$("#sampleReferenceBlockHolder").after('<div id="sampleReferenceResult'+sampleId+'" class="dialog">\
                                  <span onClick="hidedefModal()" class="closeModal"></span>\
				  <div class="modal-header">\
					<h4 class="modal-title">Reference Results</h4>\
				  </div>\
				  <div class="modal-body">\
					<div class="row">\
					  <div >\
						<table style="width: 70%;margin: 0 auto;" class="table table-bordered table-striped clearfix">\
							<thead>\
								<tr align="center">\
									<th style="width:50%;text-align: center;">VL Assay</th>\
									<th style="width:20%;text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>\
									<th style="width:15%;text-align: center;"></th>\
								</tr>\
							</thead>\
							<tbody>\
								<tr>\
									<td><select class="form-control" name="vlRef['+sampleId+'][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef['+sampleId+'][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
									</td>\
								</tr>\
							</tbody>\
						</table>\
					  </div>\
					</div>\
				  </div>\
				  <div class="modal-footer">\
						<button type="button" class="btn btn-primary" onclick="closeShipmentModal(\'sampleReferenceResult'+sampleId+'\')">OK</button>\
				  </div>\
				</div>');
	}	
	
	function addNewVlRefRow(obj,sampleId) {
		$(obj.parentNode.parentNode).after('<tr>\
									<td><select class="form-control" name="vlRef['+sampleId+'][assay][]"><?php echo $vlAssayChoices; ?></select></td>\
									<td><input type="text" name="vlRef['+sampleId+'][value][]" class="form-control"/></td>\
									<td>\
										<a href="javascript:void(0);" onclick="addNewVlRefRow(this,'+sampleId+')" class="btn btn-primary btn-xs"><i class="icon-plus"></i></a>\
										<a  href="javascript:void(0);" onclick="removeVlRefRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
									</td>\
								</tr>');
		$(".datepicker").datepicker({dateFormat: '<?php echo $dtFormat;?>'});
	}	
	  
	function removeVlRefRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	  
	function closeShipmentModal(divId) {
		document.getElementById(divId).innerHTML=getEl("mbd").innerHTML;
		
		$("#mbd input:text" ).each(function(i, obj) {
		    $("#"+divId+" input:text:eq("+i+")").val($(this).val());
		});
		$("#mbd select" ).each(function(i, obj) {
		    $("#"+divId+" select:eq("+i+")").val($(this).val());
		});
	    
		hidedefModal();
        }	
	
</script>


	<?php
} else if($shipmentData['shipment']['scheme_type'] == 'tb'){
	?>
	
<table style="width: 1050px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:10%;text-align: center;vertical-align:middle;">Control/Sample</th>
			<th style="text-align: center;vertical-align:middle;">MTB Detected<br/>(Level)</th>
			<th style="text-align: center;vertical-align:middle;">Rif Resistance</th>
			<th style="text-align: center;vertical-align:middle;">Probe D</th>
			<th style="text-align: center;vertical-align:middle;">Probe C</th>
			<th style="text-align: center;vertical-align:middle;">Probe E</th>
			<th style="text-align: center;vertical-align:middle;">Probe B</th>			
			<th style="width:7%;text-align: center;vertical-align:middle;">SPC</th>
			<th style="text-align: center;vertical-align:middle;">Probe A</th>
			<th style="text-align: center;vertical-align:middle;">Is it a Control ?</th>
			<th style="text-align: center;vertical-align:middle;">Mandatory ?</th>
			<th style="width:10%;text-align: center;vertical-align:middle;">Score</th>
			<th style="width:5%;text-align: center;vertical-align:middle;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php $counter =1;  
		foreach($shipmentData['reference'] as $reference){ 
		
		?>
		
		
			<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<select name="mtbDetected[]" class="isRequired form-control input-sm"  title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample">
						<option value="">-- Select --</option>
						<option value="high" <?php echo ($reference['mtb_detected'] == 'high' ? "selected='selected'" : ""); ?>>High</option>
						<option value="medium" <?php echo ($reference['mtb_detected'] == 'medium' ? "selected='selected'" : ""); ?>>Medium</option>
						<option value="low" <?php echo ($reference['mtb_detected'] == 'low' ? "selected='selected'" : ""); ?>>Low</option>
						<option value="veryLow" <?php echo ($reference['mtb_detected'] == 'veryLow' ? "selected='selected'" : ""); ?>>veryLow</option>
						<option value="notDetected" <?php echo ($reference['mtb_detected'] == 'notDetected' ? "selected='selected'" : ""); ?>>Not Detected</option>
						<option value="noResult" <?php echo ($reference['mtb_detected'] == 'noResult' ? "selected='selected'" : ""); ?>>No Result</option>
					</select>					
				</td>
				<td>
					<select name="rifResistance[]" class="isRequired form-control input-sm"  title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample">
						<option value="">-- Select --</option>
						<option value="detected" <?php echo ($reference['rif_resistance'] == 'detected' ? "selected='selected'" : ""); ?>>Detected</option>
						<option value="notDetected"  <?php echo ($reference['rif_resistance'] == 'notDetected' ? "selected='selected'" : ""); ?>>Not Detected</option>
						<option value="na"  <?php echo ($reference['rif_resistance'] == 'na' ? "selected='selected'" : ""); ?>>N/A</option>
					</select>					
				</td>
				<td>
					<input type="text" name="probeD[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe D value for this sample" placeholder="Please enter the Probe D value for this sample"   value="<?php echo $reference['probe_d']; ?>" />
				</td>
				<td>
					<input type="text" name="probeC[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe C value for this sample" placeholder="Please enter the Probe C value for this sample" value="<?php echo $reference['probe_c']; ?>" />
				</td>
				<td>
					<input type="text" name="probeE[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe E value for this sample" placeholder="Please enter the Probe E value for this sample" value="<?php echo $reference['probe_e']; ?>" />
				</td>
				<td>
					<input type="text" name="probeB[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe B value for this sample" placeholder="Please enter the Probe B value for this sample" value="<?php echo $reference['probe_b']; ?>" />
				</td>
				<td>
					<input type="text" name="spc[]" class="form-control input-sm oneDecimal"  title="Please enter the SPC value for this sample" placeholder="Please enter the SPC value for this sample"  value="<?php echo $reference['spc']; ?>"/>
				</td>
				<td>
					<input type="text" name="probeA[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe A value for this sample" placeholder="Please enter the Probe A value for this sample"  value="<?php echo $reference['probe_a']; ?>"/>
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
			    <td>
					<a href="javascript:void(0);" onclick="addTbRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		
		
		<?php
		$counter++;
		}
		
		?>
			
		</tbody>
</table>
<br>

<script type="text/javascript">
	function addTbRow(obj) {
		$(obj.parentNode.parentNode).after('<tr align="center"> \
												<th> \
					<input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" placeholder="Please enter the Sample Name" title="Please enter the Sample Name" /> \
				</th> \
					<td> \
					<select name="mtbDetected[]" class="isRequired form-control input-sm"  title="Please enter the MTB Detected for this sample" placeholder="Please enter the MTB Detected for this sample"> \
						<option value="">-- Select --</option> \
						<option value="high">High</option> \
						<option value="medium">Medium</option> \
						<option value="low">Low</option> \
						<option value="veryLow">veryLow</option> \
						<option value="notDetected">Not Detected</option> \
						<option value="noResult">No Result</option> \
					</select> \
				</td> \
				<td> \
					<select name="rifResistance[]" class="isRequired form-control input-sm"  title="Please enter the Rif Resistance for this sample" placeholder="Please enter the Rif Resistance for this sample"> \
						<option value="">-- Select --</option> \
						<option value="detected">Detected</option> \
						<option value="notDetected">Not Detected</option> \
						<option value="na">N/A</option> \
					</select> \
				</td> \
				<td> \
					<input type="text" name="probeD[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe D value for this sample" placeholder="Please enter the Probe D value for this sample" /> \
				</td> \
				<td> \
					<input type="text" name="probeC[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe C value for this sample" placeholder="Please enter the Probe C value for this sample" /> \
				</td> \
				<td> \
					<input type="text" name="probeE[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe E value for this sample" placeholder="Please enter the Probe E value for this sample" /> \
				</td> \
				<td> \
					<input type="text" name="probeB[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe B value for this sample" placeholder="Please enter the Probe B value for this sample" /> \
				</td> \
				<td> \
					<input type="text" name="spc[]" class="form-control input-sm oneDecimal"  title="Please enter the SPC value for this sample" placeholder="Please enter the SPC value for this sample" /> \
				</td> \
				<td> \
					<input type="text" name="probeA[]" class="form-control input-sm oneDecimal"  title="Please enter the Probe A value for this sample" placeholder="Please enter the Probe A value for this sample" /> \
				</td> \
				<td> \
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option> \
						<option value="1">Yes</option> \
						<option value="0">No</option> \
					</select> \
				</td> \
				<td> \
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option> \
						<option value="1">Yes</option> \
						<option value="0">No</option> \
					</select> \
				</td> \
				<td> \
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /> \
				</td>\
												<td><a href="javascript:void(0);" onclick="addTbRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
											</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>


	<?php
}


?>
				
			</div>
			
            <div style="margin: 0px auto 0px auto; text-align: center;" align="center">
                <input name="submitbtn" class="btn btn-primary btn-sm" type="button" onclick="validateNow();return false;"
                       tabindex="7" value="Update Shipment"/>
                <input class="btn btn-danger btn-sm" type="button" onclick="window.history.go(-1);"
                       tabindex="8" value="Cancel"/>
            </div>			
	</form>
</fieldset>
</div>

<script>
    var duplicated = false;
    function checkDuplicate(tableName, fieldName, obj, fnct, msg) {
		if (obj.val() == "" || obj.val() == null) {
			return;
		}
        $.post("<?php echo $this->url(array('module' => 'default', 'controller' => 'common', 'action' => 'check-duplicate')); ?>", { tableName: tableName, fieldName: fieldName, value: obj.val(), fnct: fnct, format: "html" },
            function (data) {
                if (data > 0) {
                    alert(msg, "err");
                    duplicated = true;
                    obj.focus();
                }
                else {
                    duplicated = false;
                }
            });
    }
	

<?php 
$vHelper = $this->getHelper('DateFormat');
$dtFormat=  $vHelper->getDateFormat();
?>	
	$(document).ready(function(){
		$(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
		$("body").on("change",'select.controlOrNot',function(){
			var scoreElem = $(this).parent().parent().find('.score');
			if ($(this).val() == 1) {
				$(scoreElem).val(0); 
				$(scoreElem).attr('readonly','readonly'); 
			}else{
				$(scoreElem).removeAttr('readonly'); 
			}
			
		});
	});
		
    function validateNow() {
		checkDuplicate('shipment', 'shipment_code', $("#shipmentCode"), '<?php echo "shipment_id##" . $shipmentData['shipment']['shipment_id']; ?>', 'This Code already exists for another Shipment. Please try something else.')
        flag = deforayValidator.init({
            formId: 'shipmentForm'
        });
        if (flag && !duplicated) {
            $.blockUI();
            document.getElementById('shipmentForm').submit();
        }
    }
	
</script>
