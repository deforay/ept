<?php
$covid19Config = $this->covid19Config ?? [];
$allowedAlgorithms = $covid19Config['allowedAlgorithms'] ?? [];
if ($allowedAlgorithms !== null && is_array($allowedAlgorithms)) {
    $allowedAlgorithms = explode(',', $allowedAlgorithms);
}
?>
<style>
    /* Main container styling */
    .dts-settings-container {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        padding: 0;
        margin-bottom: 80px;
    }

    /* Legend/Header styling */
    .dts-settings-container legend {
        background: linear-gradient(135deg, #4a6fa5 0%, #3a5a8a 100%);
        color: #fff;
        font-weight: 500;
        font-size: 16px;
        padding: 14px 20px;
        margin: 0;
        border: none;
        border-radius: 8px 8px 0 0;
    }

    .dts-settings-container legend i {
        margin-right: 8px;
    }

    /* Form content area */
    .form-content {
        padding: 25px;
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
        border-top: none;
        border-radius: 0 0 8px 8px;
    }

    /* Section styling */
    .config-section {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .config-section:hover {
        border-color: #4a6fa5;
        box-shadow: 0 2px 8px rgba(74, 111, 165, 0.1);
    }

    .config-section h5 {
        color: #4a6fa5;
        font-weight: 600;
        margin-top: 0;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #4a6fa5;
    }

    .config-section h5 i {
        margin-right: 8px;
    }

    /* Row spacing */
    .config-section .row {
        margin-bottom: 20px;
    }

    .config-section .row:last-child {
        margin-bottom: 0;
    }

    /* Label styling */
    .config-section label,
    .form-content label {
        color: #374151;
        font-weight: 500;
        margin-bottom: 8px;
        display: block;
    }

    /* Form control styling */
    .config-section .form-control:focus {
        border-color: #4a6fa5;
        box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
    }

    /* Radio button styling */
    .radioBtn .notActive {
        color: #4a6fa5;
        background-color: #fff;
        border-color: #4a6fa5;
    }

    .radioBtn .active {
        background-color: #4a6fa5;
        border-color: #3a5a8a;
    }

    /* Floating action buttons */
    .floating-buttons {
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 1000;
        display: flex;
        gap: 10px;
        background: #fff;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        border: 1px solid #e2e8f0;
    }

    .floating-buttons .btn {
        padding: 10px 25px;
        font-size: 14px;
    }

    /* Small/muted text */
    .text-muted {
        color: #6b7280;
        font-size: 12px;
        margin-top: 5px;
    }

    /* Alert/Note styling */
    .alert-note {
        background-color: #fef3c7;
        border: 1px solid #f59e0b;
        border-left: 4px solid #f59e0b;
        color: #92400e;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .alert-note ul {
        margin-bottom: 0;
        padding-left: 20px;
    }

    .alert-note li {
        margin-bottom: 5px;
    }

    .alert-note li:last-child {
        margin-bottom: 0;
    }

    /* Testkit selection section */
    .testkit-section {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 15px;
    }

    .testkit-section h6 {
        color: #374151;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e2e8f0;
    }

    .testkit-row {
        margin-bottom: 15px;
    }

    .testkit-row:last-child {
        margin-bottom: 0;
    }

    /* Input group addon styling */
    .input-group-addon {
        background: linear-gradient(135deg, #4a6fa5 0%, #3a5a8a 100%);
        color: #fff;
        border-color: #3a5a8a;
    }

    /* Horizontal rule */
    hr {
        border: none;
        border-top: 1px solid #e2e8f0;
        margin: 25px 0;
    }

    /* Sub-section titles */
    .subsection-title {
        color: #4a6fa5;
        font-weight: 600;
        font-size: 15px;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #4a6fa5;
    }

    .subsection-title i {
        margin-right: 8px;
    }
</style>
<div class="well">
    <form name="covid19SettingsForm" id="covid19SettingsForm" method="post" action="<?php echo $this->url(array("module" => "admin", "controller" => "covid19-settings", "action" => "index"), 'default', true) ?>" class="form-horizontal" role="form">
        <fieldset>
            <legend style=" margin-bottom: 0px; " class="title"><?= $this->translate->_("SARS-CoV-2 Settings"); ?>
                <!-- <a href="javascript:void(0);" onclick="exportConfig('covid19SettingsForm', 'covid19');" class="btn btn-sm btn-success" style="float:right;margin-right: 10px;"><i class="eyeicon icon-download"></i>&nbsp;&nbsp;<?= $this->translate->_("Export Config"); ?></a> -->
            </legend>
            <div class="alert alert-success" style="display: none;"><?= $this->translate->_("some text"); ?></div>
            <div class="row">
                <div class="col-md-6">
                    <label for="covid19PassPercentage" class="control-label"><?= $this->translate->_("Minimum Passing Percentage"); ?> <span class="mandatory">*</span></label>
                    <div class="input-group">
                        <input type="text" id="covid19PassPercentage" name="covid19[passPercentage]" size="50" maxlength="45" class="isRequired isNumeric form-control" placeholder="Please enter the Pass Percentage" value="<?php echo (isset($covid19Config['passPercentage']) && $covid19Config['passPercentage'] != "") ? $covid19Config['passPercentage'] : 0; ?>" />
                        <span class="input-group-addon">%</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="covid19AllowedAlgorithms" class="control-label">Allowed Algorithms</label>
                    <textarea id="covid19AllowedAlgorithms" name="covid19[allowedAlgorithms]" class="form-control" placeholder="Enter the Documentation Score Percentage" title="Please enter the Documentation Score Percentage"><?php echo $allowedAlgorithms; ?></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="reportVersion" class="control-label"><?= $this->translate->_("Report Version"); ?></label>
                    <input type="text" id="reportVersion" name="covid19[reportVersion]" class="form-control" placeholder="Enter the report version" value="<?php echo $covid19Config['reportVersion'] ?? null; ?>" title="Please enter the report version" />
                </div>
                <div class="col-md-6">
                    <label for="reportEffectiveDate"><?= $this->translate->_("Report Effective Date"); ?></label>
                    <input type="text" id="reportEffectiveDate" name="covid19[reportEffectiveDate]" class="form-control datepicker" placeholder="Select the report effective date" title="<?= $this->translate->_('Please select the report effective date'); ?>" value="<?php echo $covid19Config['reportEffectiveDate'] ?? null; ?>" />
                    <small class="text-muted"><?= $this->translate->_("Please enter the report version that shows in the report PDF footer."); ?></small>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 covid19MaximumTestAllowedDiv">
                    <label for="covid19MaximumTestAllowed" class="control-label"><?= $this->translate->_("Maximum Tests Allowed"); ?> <span class="mandatory">*</span></label>
                    <select class="form-control isRequired" id="covid19MaximumTestAllowed" name="covid19[covid19MaximumTestAllowed]" title="Please select if test 3 is optional">
                        <option value="">-- <?= $this->translate->_("Select"); ?> --</option>
                        <option value="1" <?php echo (isset($covid19Config['covid19MaximumTestAllowed']) && $covid19Config['covid19MaximumTestAllowed'] == "1") ? " selected='selected' " : ""; ?>>1</option>
                        <option value="2" <?php echo (isset($covid19Config['covid19MaximumTestAllowed']) && $covid19Config['covid19MaximumTestAllowed'] == "2") ? " selected='selected' " : ""; ?>>2</option>
                        <option value="3" <?php echo (isset($covid19Config['covid19MaximumTestAllowed']) && $covid19Config['covid19MaximumTestAllowed'] == "3") ? " selected='selected' " : ""; ?>>3</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="sampleRehydrateDays" class="control-label"><?= $this->translate->_("No. of Days for Sample Rehydration"); ?> <span class="mandatory">*</span></label>
                    <select class="form-control isRequired" id="sampleRehydrateDays" name="covid19[sampleRehydrateDays]" title="Please select no. of days for sample rehydration">
                        <option value="">-- <?= $this->translate->_("Select"); ?> --</option>
                        <option value="0" <?php echo (isset($covid19Config['sampleRehydrateDays']) && $covid19Config['sampleRehydrateDays'] == "0") ? " selected='selected' " : ""; ?>>0 - <?= $this->translate->_("Allow Same Day Testing"); ?></option>
                        <option value="1" <?php echo (isset($covid19Config['sampleRehydrateDays']) && $covid19Config['sampleRehydrateDays'] == "1") ? " selected='selected' " : ""; ?>>1 - <?= $this->translate->_("Testing after 1 day only"); ?></option>
                        <option value="2" <?php echo (isset($covid19Config['sampleRehydrateDays']) && $covid19Config['sampleRehydrateDays'] == "2") ? " selected='selected' " : ""; ?>>2 -<?= $this->translate->_("Testing after 2 days only"); ?></option>
                    </select>
                </div>
            </div>
            <!-- <div class="row">
                <div class="col-md-6">
                    <label for="covid19PassPercentage" class="control-label">Covid-19 Documentation Score (Percentage)<span class="mandatory">*</span></label>
                    <input type="text" id="covid19DocumentationScore" name="covid19[documentationScore]" size="50" maxlength="45" class="isRequired isNumeric form-control" placeholder="Please enter the Documentation Score Percentage" value="<?php echo $covid19Config['documentationScore']; ?>" />
                    <span class="input-group-addon">%</span>
                </div>
                <div class="col-md-6">
                    <label for="covid19EnforceAlgorithmCheck" class="control-label">Algorithm required in reporting ?<span class="mandatory">*</span></label>
                    <input type="radio" name="covid19[covid19EnforceAlgorithmCheck]" id="covid19EnforceAlgorithmCheck_yes" class="isRequired" <?php echo (isset($covid19Config['covid19EnforceAlgorithmCheck']) && $covid19Config['covid19EnforceAlgorithmCheck'] == "yes") ? " checked='checked' " : ""; ?> value="yes" title="Is algorithm required in reporting ?" /> Yes
                    <input type="radio" name="covid19EnforceAlgorithmCheck" id="covid19EnforceAlgorithmCheck_no" <?php echo (isset($covid19Config['covid19EnforceAlgorithmCheck']) && $covid19Config['covid19EnforceAlgorithmCheck'] == "no") ? " checked='checked' " : ""; ?> value="no" /> No
                </div>
            </div> -->
            <br>
            <p class="mandatory"><?= $this->translate->_("Note"); ?> : <br />
            <ul>
                <li><?= $this->translate->_("If a response does not contain the following recommended Test Platforms, participants will not pass for the respective samples."); ?></li>
                <li><?= $this->translate->_("If you don't want to enforce the test type check, please leave the following 3 options blank"); ?></li>
                <li><?= $this->translate->_("Please set the"); ?> <a href="/admin/test-platform/standard-type"><?= $this->translate->_("SARS-CoV-2 Standard Test Platforms"); ?></a> <?= $this->translate->_("before you do the below"); ?></li>
            </ul>
            </p>
            <div class="row">

                <div class="col-md-6">
                    <label for="testPlatform1" class="control-label"><?= $this->translate->_("Recommended TestType 1"); ?></label><br>
                    <select name="testPlatform1[]" id="testPlatform1" class="multipleSelect form-control" multiple="multiple" title="Please Choose Test Platform 1">
                        <?php
                        foreach ($this->allTestTypes as $key => $testPlatform) {
                            if ($testPlatform['test_type_1'] == '1') {
                        ?>
                                <option value="<?php echo $testPlatform['test_type_id'] ?>" <?php echo (isset($this->recommendedTesttypes[1]) && in_array($testPlatform['test_type_id'], $this->recommendedTesttypes[1])) ? 'selected' : ''; ?>><?php echo $testPlatform['test_type_name'] ?></option>
                        <?php
                            }
                        }
                        ?>
                    </select>
                </div>

                <div class="col-md-6">
                    <label for="testPlatform2" class="control-label"><?= $this->translate->_("Recommended TestType 2"); ?></label><br>
                    <select name="testPlatform2[]" id="testPlatform2" class="multipleSelect form-control" multiple="multiple" title="Please Choose Test Platform 1">
                        <?php foreach ($this->allTestTypes as $key => $testPlatform) {
                            if ($testPlatform['test_type_2'] == '1') { ?>
                                <option value="<?php echo $testPlatform['test_type_id'] ?>" <?php echo (isset($this->recommendedTesttypes[2]) && in_array($testPlatform['test_type_id'], $this->recommendedTesttypes[2])) ? 'selected' : ''; ?>><?php echo $testPlatform['test_type_name'] ?></option>
                        <?php }
                        } ?>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="testPlatform3" class="control-label"><?= $this->translate->_("Recommended TestType 3"); ?></label><br>
                    <select name="testPlatform3[]" id="testPlatform3" class="multipleSelect form-control" multiple="multiple" title="Please Choose Test Platform 1">
                        <?php foreach ($this->allTestTypes as $key => $testPlatform) {
                            if ($testPlatform['test_type_3'] == '1') { ?>
                                <option value="<?php echo $testPlatform['test_type_id'] ?>" <?php echo (isset($this->recommendedTesttypes[3]) && in_array($testPlatform['test_type_id'], $this->recommendedTesttypes[3])) ? 'selected' : ''; ?>><?php echo $testPlatform['test_type_name'] ?></option>
                        <?php }
                        } ?>
                    </select>
                </div>
            </div>
            <br>
            <div id="respond" style="margin: 0px auto 0px auto; text-align: center;" align="center">
                <input name="submitbtn" class="btn btn-primary" type="button" onclick="validateNow();return false;" tabindex="7" value="<?= $this->translate->_("Update"); ?>" />
                <input class="btn btn-danger" type="button" onclick="window.location.href='/admin/index';" tabindex="8" value="<?= $this->translate->_("Back"); ?>" />
            </div>
        </fieldset>
    </form>
</div>

<script type="text/javascript">
    function validateNow() {

        //checkDuplicate('distributions', 'distribution_code',$("#distributionCode"),null, 'This Code already exists for another PT Survey. Please try something else.')
        flag = deforayValidator.init({
            formId: 'covid19SettingsForm'
        });
        if (flag) {
            $.blockUI();
            document.getElementById('covid19SettingsForm').submit();
        }
    }
    $(document).ready(function() {
        $('.multipleSelect').multiselect({
            includeSelectAllOption: true
        });

        <?php $alertMsg = new Zend_Session_Namespace('alertSpace');
        if (isset($alertMsg->message) && $alertMsg->message != "") { ?>
            $('.alert-success').show(500);
            $('.alert-success').html("<?php echo $alertMsg->message; ?>");
            $(".alert-success").fadeOut(5000, function() {
                $('.title').css('margin-bottom', '21px')
            });
        <?php $alertMsg->message = "";
            unset($alertMsg->message);
        } ?>
    });
</script>