<link rel="stylesheet" href="<?php echo $this->baseUrl('css/daterangepicker.css'); ?>" type="text/css" media="all">
<script type="text/javascript" src="<?php echo $this->baseUrl('js/jquery3.min.js'); ?>"></script>
<script type="text/javascript" src="<?php echo $this->baseUrl('js/moment.min.js'); ?>"></script>
<link rel="stylesheet" type="text/css" href="<?php echo $this->baseUrl('css/bootstrap-select.min.css'); ?>" />
<link rel="stylesheet" type="text/css" href="<?php echo $this->baseUrl('css/multi-select.css'); ?>" />
<link href="<?php echo $this->baseUrl('css/select2.css'); ?>" rel="stylesheet" />
<div class="well">
    <form name="htmlHomePageForm" id="htmlHomePageForm" method="post" action="<?php echo $this->url(array("module" => "admin", "controller" => "html-home-page", "action" => "index"), 'default', true) ?>" class="form-horizontal" role="form">
        <fieldset>
            <legend><?= $this->translate->_("HTML Home Page Content"); ?></legend>
            <div class="row">
                <div class="col-lg-6">
                    <label for="templates" class="control-label"><?= $this->translate->_("Template"); ?></label>
                    <div>
                        <select id="templates" name="templates" class="form-control" title="Please select template to fill the form" onchange="fillTemplate();">
                            <option value="">--<?= $this->translate->_("Select"); ?>--</option>
                            <?php if(isset($this->htmlHomePage) && !empty($this->htmlHomePage)){ ?>
                                <option value="<?php echo $this->htmlHomePage['section'];?>" selected='selected'><?php echo $this->htmlHomePage['section'];?></option>
                            <?php } ?>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <label for="message" class="control-label"><?= $this->translate->_("Page content"); ?></label>
                    <div>
                        <div id="messageEditor" name="messageEditor" class="richtextarea form-control" title="Please enter a Mail Content" placeholder="Enter the Mail Content"></div>
                        <textarea style="display:none;" id="message" name="message"></textarea>
                    </div>
                </div>
            </div>
            <div id="respond" style="margin: 0px auto 0px auto; text-align: center;" align="center">
                <input type="hidden" name="distributionId" id="distributionId" value="<?php echo $this->distributionId; ?>" />
                <input name="submitbtn" class="btn btn-primary" type="button" onclick="validateNow();return false;" tabindex="7" value="Save" />
                <input class="btn btn-danger" type="button" onclick="window.location.href='/admin/index';" tabindex="8" value="Back" />
            </div>
        </fieldset>
    </form>
</div>

<script type="text/javascript" src="<?php echo $this->baseUrl('js/daterangepicker.js'); ?>"></script>
<!-- include summernote css/js -->
<link rel="stylesheet" type="text/css" href="<?php echo $this->baseUrl('css/summernote.min.css'); ?>">
<script type="text/javascript" src="<?php echo $this->baseUrl('js/summernote.min.js'); ?>"></script>
<script type="text/javascript" src="<?php echo $this->baseUrl('js/bootstrap-select.min.js'); ?>"></script>
<script type="text/javascript" src="<?php echo $this->baseUrl('js/select2.min.js'); ?>"></script>
<script type="text/javascript" src="<?php echo $this->baseUrl("js/jquery.multi-select.js"); ?>"></script>
<script type="text/javascript" src="<?php echo $this->baseUrl("js/jquery.quicksearch.js"); ?>"></script>
<script type="text/javascript">
    var startDate = "";
    var endDate = "";

    function validateNow() {
        $("#message").val($("#messageEditor").summernote('code'));
        if ($.trim($('#message').val()) == '') {
            $('#message').val('');
            alert("Please enter the html content");
            return false;
        }
        if ($('#message').val() != '') {
            $.blockUI();
            document.getElementById('htmlHomePageForm').submit();
        }else{
            alert('Please enter the html content');
        }
    }
    $(document).ready(function() {
        $('#shipments, #sendMail').selectpicker();
        $('#messageEditor').summernote({
            oninit: function() {
                $("div.note-editor button[data-event='codeview']").click();
            },
            placeholder: 'Please enter the content here',
            tabsize: 2,
            height: 200
        });
        $("#templates").select2({
            placeholder: "<?= $this->translate->_("Choose or enter section");?>",
            minimumInputLength: 3,
            width: '100%',
            allowClear: true,
            ajax: {
                placeholder: "<?= $this->translate->_("Type subject to search");?>",
                url: "<?php echo $this->url(array('module' => 'admin', 'controller' => 'html-home-page', 'action' => 'get-sections-list')); ?>",
                dataType: 'json',
                delay: 250,
                data: function(params) {
                    return {
                        search: params.term, // search term
                        page: params.page
                    };
                },
                processResults: function(data, params) {
                    params.page = params.page || 1;
                    return {
                        results: data.result,
                        pagination: {
                            more: (params.page * 30) < data.total_count
                        }
                    };
                },
                //cache: true
            },
            escapeMarkup: function(markup) {
                return markup;
            }
        });

        <?php if(isset($this->htmlHomePage) && !empty($this->htmlHomePage)){ ?>
            fillTemplate();
        <?php }?>
    });

    function fillTemplate() {
		// $.blockUI();
		$.post("<?php echo $this->url(array('module' => 'admin', 'controller' => 'html-home-page', 'action' => 'get-html-template-by-section')); ?>", {
                section: $('#templates').val(),
				format: "html"
			},
			function(data) {
				if (data != undefined && data != null && data != "") {
                    let obj = jQuery.parseJSON(data);
                    let html = (obj.content);
                    $("#messageEditor").summernote('pasteHTML', html);
				}

				// $.unblockUI();
			});
	}
</script>
