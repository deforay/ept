<?php if (isset($this->result) && !empty($this->result)): ?>
    <div class="table-container">
        <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover report-table" id="shipmentTable">
            <thead>
                <tr>
                    <th style="text-align: center;" rowspan="2"><?= $this->translate->_("Type of Testing Facility"); ?></th>
                    <th style="text-align: center;" colspan="2"><?= $this->translate->_("Total Registered"); ?></th>
                    <?php foreach ($this->result['shipments'] as $shipment): ?>
                        <th style="text-align: center;" colspan="2"><?= htmlspecialchars($shipment['shipment_code']); ?></th>
                    <?php endforeach; ?>
                </tr>
                <tr>
                    <th class="text-center"><?= $this->translate->_("No."); ?></th>
                    <th class="text-center"><?= $this->translate->_("%"); ?></th>
                    <?php foreach ($this->result['shipments'] as $shipment): ?>
                        <th class="text-center"><?= $this->translate->_("No."); ?></th>
                        <th class="text-center"><?= $this->translate->_("%"); ?></th>
                    <?php endforeach; ?>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($this->result['fundingSources'] as $fundingSource): ?>
                    <?php $fundingSourceName = $fundingSource['funding_source']; ?>
                    <tr>
                        <td class="font-weight-bold"><?= ucfirst(htmlspecialchars($fundingSourceName)); ?></td>
                        <td class="text-center">
                            <?= isset($this->result['overallStats'][$fundingSourceName]['count']) ? $this->result['overallStats'][$fundingSourceName]['count'] : 0; ?>
                        </td>
                        <td class="text-center">
                            <?= isset($this->result['overallStats'][$fundingSourceName]['percentage']) ? $this->result['overallStats'][$fundingSourceName]['percentage'] . '%' : '0%'; ?>
                        </td>
                        <?php foreach ($this->result['shipments'] as $shipment): ?>
                            <td class="text-center">
                                <?= isset($shipment['data'][$fundingSourceName]['count']) ? $shipment['data'][$fundingSourceName]['count'] : 0; ?>
                            </td>
                            <td class="text-center">
                                <?= isset($shipment['data'][$fundingSourceName]['percentage']) ? $shipment['data'][$fundingSourceName]['percentage'] . '%' : '0%'; ?>
                            </td>
                        <?php endforeach; ?>
                    </tr>
                <?php endforeach; ?>

                <!-- Total row -->
                <tr class="font-weight-bold" style="background-color: #f5f5f5;">
                    <td><?= $this->translate->_("Total Participants"); ?></td>
                    <td class="text-center" colspan="2"><?= $this->result['overallStats']['total']; ?></td>
                    <?php foreach ($this->result['shipments'] as $shipment): ?>
                        <?php
                        $shipmentTotal = 0;
                        foreach ($shipment['data'] as $data) {
                            $shipmentTotal += $data['count'];
                        }
                        ?>
                        <td class="text-center" colspan="2"><?= $shipmentTotal; ?></td>
                    <?php endforeach; ?>
                </tr>
            </tbody>
        </table>
    </div>
<?php else: ?>
    <div class="alert alert-warning text-center">
        <?= $this->translate->_("No data available for the selected criteria."); ?>
    </div>
<?php endif; ?>