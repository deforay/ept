<?php
$genderHelper = $this->getHelper('DateFormat');
$dtFormat =  $genderHelper->getDateFormat();
?>
<table class="table table-bordered table-striped" style="width:100%;margin:10px auto;">
    <tr class="dark">
        <td style="width:20%;"> <label class="control-lable" for="cartridge">Truenat prep Auto cartridge Lot Number</label> </td>
        <td style="width:30%;">
            <input type="text" name="cartridge" id="cartridge" title="Truenat prep Auto cartridge Lot Number" placeholder="Truenat prep Auto cartridge Lot Number" class="form-control isRequired" value="<?php echo $this->shipment['attributes']['mtb_rif_kit_lot_no']; ?>" />
        </td>
        <td style="width:20%;"> <label class="control-lable" for="expiration">Expiration:</label></td>
        <td style="width:30%;">
            <input type="text" name="expiration" id="expiration" placeholder="Expiration" class="form-control isRequired datepicker" size="11" maxlength="11" style="width:180px;float:left;" value="<?php echo $this->shipment['attributes']['expiry_date']; ?>" readonly="readonly" />
            <i class="icon-remove-sign" style="cursor:pointer;margin-top:10px;margin-left:10px;float:left;" alt="Clear Date" title="Clear Date" onclick="clearDate('expiryDate')"> Clear</i>
        </td>
    </tr>
    <tr class="light">
        <td style="width:20%;"> <label class="control-lable" for="lotNumber">Truenat MTB chip Lot No</label> </td>
        <td style="width:30%;">
            <input type="text" name="lotNumber" id="lotNumber" title="Truenat MTB chip Lot No" placeholder="Truenat prep Auto cartridge Lot Number" class="form-control isRequired" value="<?php echo $this->shipment['attributes']['mtb_rif_kit_lot_no']; ?>" />
        </td>
        <td style="width:20%;"> <label class="control-lable" for="expiration">Expiration:</label></td>
        <td style="width:30%;">
            <input type="text" name="expiration" id="expiration" placeholder="Expiration" class="form-control isRequired datepicker" size="11" maxlength="11" style="width:180px;float:left;" value="<?php echo $this->shipment['attributes']['expiry_date']; ?>" readonly="readonly" />
            <i class="icon-remove-sign" style="cursor:pointer;margin-top:10px;margin-left:10px;float:left;" alt="Clear Date" title="Clear Date" onclick="clearDate('expiryDate')"> Clear</i>
        </td>
    </tr>

    <?php if ((isset($authNameSpace->enable_adding_test_response_date) && $authNameSpace->enable_adding_test_response_date == 'yes') || (isset($authNameSpace->enable_choosing_mode_of_receipt) && $authNameSpace->enable_choosing_mode_of_receipt == 'yes' && $authNameSpace->enable_adding_test_response_date != '' && $authNameSpace->enable_adding_test_response_date == 'yes')) { ?>
        <tr class="light">
            <td><label> Response Date </label></td>
            <td>
                <input type="text" id="testReceiptDate" name="testReceiptDate" size="11" maxlength="11" style="width:180px;float:left;" value="<?php echo $testReceiptDate; ?>" class="form-control datepicker" readonly="readonly" title="Please enter Shipment Test Response Date " />
                <i class="icon-remove-sign" style="cursor:pointer;margin-top:10px;margin-left:10px;float:left;" alt="Clear Date" title="Clear Date" onclick="clearDate('testReceiptDate')"> Clear</i>
            </td>
        </tr>
    <?php } ?>
</table>
<hr>
<div style="overflow-x:scroll;">
    <table class="table table-bordered table-striped" style="width:100%;margin:10px auto;">
        <thead>
            <tr align="CENTER" class="dark">
                <th style="width:5%;">PT Sample</th>
                <th>DNA Extraction Date</th>
                <th>DNA Extraction Status</th>
                <th>Molbio Truenat TB Test Date</th>
                <th>Tester Name</th>
                <th>Mycobacterium tuberculosis complex (MTBC) Detected</th>
                <th>Control Ct</th>
                <th>MTB Ct</th>
                <th>Quantification</th>
            </tr>
        </thead>

        <?php $count = 0;
        foreach ($this->allSamples as $key => $sample) {
            $count++;
        ?>
            <tr align="CENTER" class="light">
                <th>
                    <?php echo $sample['sample_label']; ?> <?php echo ($sample['mandatory'] == 1) ? " <span class='mandatory'>*</span>" : "&nbsp;&nbsp;"; ?>
                    <input type="hidden" id="sample<?php echo $count; ?>" name="sampleId[]" value="<?php echo $sample['sample_id']; ?>" />
                </th>
                <td>
                    <input type="text" class="form-control datepicker sampleTestDate" placeholder="DNA Extraction Date" readonly="readonly" name="dateTested[]" value="<?php echo $this->dateFormat($sample['date_tested']); ?>" title="Please enter the DNA Extraction Date <?php echo $sample['sample_label']; ?>" />
                </td>
                <td>
                    <select name="dnaStatus[]" class="isRequired form-control input-sm" title="Please enter the DNA extraction status">
                        <option value="">-- Select --</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </td>
                <td>
                    <input type="text" class="form-control" placeholder="Molbio Truenat TB Test Date" name="molbioTruenat[]" value="<?php echo $this->dateFormat($sample['date_tested']); ?>" title="Please enter the Molbio Truenat TB Test Date <?php echo $sample['sample_label']; ?>" />
                </td>
                <td>
                    <input type="text" class="form-control" placeholder="Enter the tester name" id="testerName<?php echo ($key + 1); ?>" name="testerName[]" value="" title="Please enter the tester name for <?php echo $sample['sample_label']; ?>" />
                </td>
                <td>
                    <select name="mtbDetected[]" class="isRequired form-control input-sm" title="Please enter the MTB Detected for this sample">
                        <option value="">-- Select --</option>
                        <option value="high" <?php echo ($sample['mtb_detected'] == 'high' ? "selected='selected'" : ""); ?>>High</option>
                        <option value="medium" <?php echo ($sample['mtb_detected'] == 'medium' ? "selected='selected'" : ""); ?>>Medium</option>
                        <option value="low" <?php echo ($sample['mtb_detected'] == 'low' ? "selected='selected'" : ""); ?>>Low</option>
                        <option value="veryLow" <?php echo ($sample['mtb_detected'] == 'veryLow' ? "selected='selected'" : ""); ?>>veryLow</option>
                        <option value="notDetected" <?php echo ($sample['mtb_detected'] == 'notDetected' ? "selected='selected'" : ""); ?>>Not Detected</option>
                        <option value="noResult" <?php echo ($sample['mtb_detected'] == 'noResult' ? "selected='selected'" : ""); ?>>No Result</option>
                    </select>
                </td>
                <td>
                    <input type="text" name="ctrl[]" placeholder="Control Ct" class="form-control oneDecimal" value="<?php echo $sample['probe_a']; ?>" title="Please enter the Control Ct <?php echo $sample['sample_label']; ?>" />
                </td>
                <td>
                    <input type="text" name="mtbCt[]" placeholder="P2" class="form-control oneDecimal" value="<?php echo $sample['probe_d']; ?>" title="Please enter the MTB Ct value for <?php echo $sample['sample_label']; ?>" />
                </td>
                <td>
                    <select name="quantification[]" class="isRequired form-control input-sm" title="Please enter the Quantification">
                        <option value="">-- Select --</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </td>
            </tr>
        <?php } ?>
    </table>
</div>
<br>
<span style="color: red;">* If DNA extraction status is valid - then only other fileds will be available for data entry</span>
<br>
<span style="color: red;">**If Participant Response is MTB Detected, then the Rif Dx Results Field will be available for data entry (Below)</span>
<hr>
<table class="table table-bordered table-striped" style="width:100%;margin:10px auto;">
    <tr>
        <th style="width:20%;">Supervisor Review</th>
        <td style="width:20%;">
            <select name="supervisorApproval" id="supervisorApproval" class="form-control isRequired">
                <option value="">--Select--</option>
                <option value="yes" <?php if ($this->shipment['supervisor_approval'] == 'yes') echo " selected "; ?>>Yes</option>
                <option value="no" <?php if ($this->shipment['supervisor_approval'] == 'no') echo " selected "; ?>>No</option>
            </select>
        </td>
        <th><label id="labSupervisor" <?php echo (isset($this->shipment['supervisor_approval']) && $this->shipment['supervisor_approval'] == 'yes') ? "" : "style='display:none;'" ?>>Supervisor Name</label></th>
        <td><input name="participantSupervisor" id="participantSupervisor" <?php echo (isset($this->shipment['supervisor_approval']) && $this->shipment['supervisor_approval'] == 'yes') ? "" : "style='display:none;'" ?> type="text" class="form-control" value="<?php echo $this->shipment['participant_supervisor']; ?>" /></td>

    </tr>
    <tr>
        <th>Comments </th>
        <td colspan="3">
            <textarea name="userComments" id="userComments" class="form-control" size="120" maxlength="40"><?php echo $this->shipment['user_comment']; ?></textarea>
        </td>
    </tr>
</table>
<br>
<div style="overflow-x:scroll;">
    <table class="table table-bordered table-striped" style="width:100%;margin:10px auto;">
        <tr class="dark">
            <td style="width:20%;"> <label class="control-lable" for="cartridge">Assay Lot</label> </td>
            <td style="width:30%;">
                <input type="text" name="cartridge" id="cartridge" title="Truenat prep Auto cartridge Lot Number" placeholder="Truenat prep Auto cartridge Lot Number" class="form-control isRequired" value="<?php echo $this->shipment['attributes']['mtb_rif_kit_lot_no']; ?>" />
            </td>
            <td style="width:20%;"> <label class="control-lable" for="assayExpiration">Assay Expiration:</label></td>
            <td style="width:30%;">
                <input type="text" name="assayExpiration" id="assayExpiration" placeholder="Assay Expiration" class="form-control isRequired datepicker" size="11" maxlength="11" style="width:180px;float:left;" value="<?php echo $this->shipment['attributes']['expiry_date']; ?>" readonly="readonly" />
                <i class="icon-remove-sign" style="cursor:pointer;margin-top:10px;margin-left:10px;float:left;" alt="Clear Date" title="Clear Date" onclick="clearDate('assayExpiration')"> Clear</i>
            </td>
        </tr>
    </table>
    <br>
    <table class="table table-bordered table-striped" style="width:100%;margin:10px auto;">
        <thead>
            <tr align="CENTER" class="dark">
                <th>Rif Dx Test Date</th>
                <th>Tester Name</th>
                <th>RIF Resistance</th>
                <th>P2</th>
                <th>P1</th>
                <th>Control Ct</th>
            </tr>
        </thead>

        <?php $count = 0;
        foreach (range(1, 5) as $key => $sample) {
            $count++; ?>
            <tr align="CENTER" class="light">
                <th>
                    <input type="text" class="form-control datepicker sampleTestDate" placeholder="DNA Extraction Date" readonly="readonly" name="dateTested[]" title="Please enter the DNA Extraction Date" />
                </th>
                <td>
                    <input type="text" class="form-control" placeholder="Enter the tester name" id="testerName" name="testerName[]" value="" title="Please enter the tester name for" />
                </td>
                <td>
                    <select name="rifResistance[]" class="isRequired form-control input-sm" title="Please enter the RIF resistance">
                        <option value="">-- Select --</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </td>
                <td>
                    <input type="text" name="p2[]" placeholder="P2" class="form-control oneDecimal" placeholder="Enter P2 number" title="Please enter the P2" />
                </td>
                <td>
                    <input type="text" name="p1[]" placeholder="P1" class="form-control oneDecimal" placeholder="Enter P1 number" title="Please enter the P1" />
                </td>
                <td>
                    <input type="text" name="ctrl[]" placeholder="Control Ct" class="form-control oneDecimal" title="Please enter the Control Ct" />
                </td>
            </tr>
        <?php } ?>
    </table>
</div>
<script type="text/javascript">
    $(function() {
        $(".datepicker").datepicker({
            dateFormat: '<?php echo $dtFormat; ?>',
            maxDate: '0',
            minDate: new Date('<?php echo $this->shipment['shipment_date']; ?>')
        });
        $(".expDatepicker").datepicker({
            dateFormat: '<?php echo $dtFormat; ?>'
        });
    });
</script>