<link href="<?php echo $this->baseUrl('css/select2.css'); ?>" rel="stylesheet" />
<section class="content-header">
    <h1>
        Participant/Laboratory Information
    </h1>
</section>
<section class="content">
<div class="box">
    
<div class="box-body">

<form name="participantEdit" id="participantEdit" method="post"   action="<?php echo $this->url(array("controller" => "participant", "action" => "testeredit"), null, true) ?>">
    <div id="view-content">

        <input type="hidden" id ="PartSysID" name="participantId" value="<?php echo $this->rsParticipant['participant_id']; ?>" />
        <br>
        <table class="table table-striped table-bordered">
            <tr>
                
                <th colspan="4" style="text-align: left;padding:20px;">
                    <input type="checkbox" name="individualParticipant" id="individualParticipant" checked="checked" onclick="checkIndividualParticipant(this)">&nbsp;&nbsp;<span style="">Individual Participant</span>
                </th>
            </tr>
            <tr>
                <th>Lab or Participant ID</th>
                    <td>
                        <?php echo $this->rsParticipant['unique_identifier']; ?>
                        <input type="hidden" id="pid" name="pid" size="25" maxlength="45" class="form-control" value="<?php echo $this->rsParticipant['unique_identifier']; ?>"/>
                    </td>
                <th id="firstNameLable">Participant First Name <span class="mandatory">*</span></th>
                <td><input type="text" id="pfname" name="pfname" size="25" maxlength="45"  class="form-control isRequired"  title="Please enter the Participant's Lab/First Name here" placeholder="Please enter the Participant's Lab/First Name here" value="<?php echo $this->rsParticipant['first_name']; ?>"/></td>

            </tr>
            <tr>

                <th id="lastNameLable">Participant Last Name (optional)</th>
                <td style="width:285px;" id="lastNameLableTd"><input type="text" id="plname" name="plname" size="25" maxlength="45" title="Please enter the Participant's Last Name here" placeholder="Please enter the Participant's Last Name here" class="form-control" value="<?php echo $this->rsParticipant['last_name']; ?>"/></td>
                <th><label>Institute Name <span class="mandatory">*</span></label></th>
                <td><input type="text" id="instituteName" name="instituteName" size="25" maxlength="45"
                           class="form-control isRequired" title="Please enter the Institute Name here"
                           placeholder="Please enter the Institute Name here" value="<?php echo $this->rsParticipant['institute_name']; ?>"/></td>
            </tr>
            <tr>

                <th><label>Department Name <span class="mandatory">*</span></label></th>
                <td colspan=3><input type="text" id="departmentName" name="departmentName" size="25" maxlength="45"
                                     class="form-control isRequired" title="Please enter the Department Name here"
                                     placeholder="Please enter the Department Name here" style="width:285px;" value="<?php echo $this->rsParticipant['department_name']; ?>"/></td>
            </tr>
            <tr>
                <th><label>Physical Address <span class="mandatory">*</span></label></th>
                <td colspan=3><textarea id="address" name="address" size="50" 
                                        class="isRequired form-control" title="Please enter the address here"
                                        placeholder="Please enter the address here"><?php echo $this->rsParticipant['address']; ?></textarea></td>
            </tr>
            <tr>
                <th><label>City <span class="mandatory">*</span></label></th>
                <td><input type="text" id="city" name="city" size="25" maxlength="45"
                           class="form-control isRequired" title="Please enter the city here"
                           placeholder="Please enter the city here"
                           value="<?php echo $this->rsParticipant['city']; ?>"/></td>

                <th><label>State (if applicable)</label></th>

            </td><td><input type="text" id="state" name="state" size="25" maxlength="45"
                            class="form-control" title="Please enter the state here"
                            placeholder="Please enter the state here" value="<?php echo $this->rsParticipant['state']; ?>"/></td>
    </tr>
    <tr> <th>
            <label>Country <span class="mandatory">*</span></label></th>
        <td><select name="country" id="country"  class="isRequired form-control" title="Please choose the country here" style="width:285px;">
                <option value="">--Select Country--</option>
                <?php foreach ($this->countriesList as $cou) {
                    ?>
                    <option value="<?php echo $cou['id']; ?>" <?php echo(($this->rsParticipant["country"] == $cou['id']) ? "selected='selected'" : "") ?>><?php echo $cou['iso_name']; ?></option>
                    <?php
                }
                ?>
            </select></td>

        <th>Region <span class="mandatory">*</span></th>
        <td>
            <input type="text" id="region" size="25" maxlength="45" name="region" class="form-control isRequired" title="Please enter region here" placeholder="Please enter region here" value="<?php echo $this->rsParticipant['region']; ?>"/>
        </td>
        
    </tr>
    <tr> <th>
            <label>Longitude </label></th>

        <td><input type="text" id="long" name="long" size="25" maxlength="45"
                   class="form-control" title="Please enter the longitude here"
                   placeholder="Please enter the longitude here" value="<?php echo $this->rsParticipant['long']; ?>"/></td>
        <th>
            <label>Latitude </label></th>

        <td><input type="text" id="lat" name="lat" size="25" maxlength="45"
                   class="form-control" title="Please enter the latitude here"
                   placeholder="Please enter the latitude here" value="<?php echo $this->rsParticipant['lat']; ?>"/>
        </td>
    </tr>
    <tr>
        <th>
            <label>Funding Source </label></th>

        <td><input type="text" id="fundingSource" name="fundingSource" size="25" maxlength="45" 
                   class="form-control" title="Please enter the funding source here"
                   placeholder="Please enter the funding source here" value="<?php echo $this->rsParticipant['funding_source']; ?>"/></td>
        <th>
            <label>Testing Volume </label></th>

        <td><input type="text" id="testingVolume" name="testingVolume" size="25" maxlength="45" 
                   class="form-control" title="Please enter testing volume here"
                   placeholder="Please enter the testing volume here" value="<?php echo $this->rsParticipant['testing_volume']; ?>"/>
        </td>
    </tr>
    
    <tr>
        <th><label>Enrolled Programs </label></th>
        <td>
            <select name="enrolledProgram[]" id="enrolledProgram" class="" multiple="multiple" style="width:285px;">
                <?php
                $enrolledProg = explode(",", $this->rsParticipant['enrolled_prog']);
                foreach ($this->enrolledPrograms as $enrolledPrograms) {
                    ?>
                    <option value="<?php echo $enrolledPrograms['r_epid']; ?>" <?php echo (in_array($enrolledPrograms['r_epid'], $enrolledProg)) ? "selected='selected'" : "" ?>><?php echo $enrolledPrograms['enrolled_programs']; ?></option>
                    <?php
                }
                ?>
            </select>
        </td>
        <th>
            <label>Site Type </label></th>

        <td>
            <select name="siteType" id="siteType" class="form-control" style="width:285px;">
                <option value="">--Select--</option>
                <?php foreach ($this->siteType as $siteType) {
                    ?>
                    <option value="<?php echo $siteType['r_stid']; ?>" <?php echo(($this->rsParticipant["site_type"] == $siteType['r_stid']) ? "selected='selected'" : "") ?>><?php echo $siteType['site_type']; ?></option>
                    <?php
                }
                ?>
            </select>

        </td>
    </tr>
    
    <tr>
        <th>Shipping Address (include city and country) <span class="mandatory">*</span></th>
        <td><textarea id="shippingAddress" name="shippingAddress" size="50" 
                                class="isRequired form-control" title="Please enter the address here"
                                placeholder="Please enter the Shipping Address here"><?php echo $this->rsParticipant['shipping_address']; ?></textarea></td>
        <th>
            <label>Zip Code (if applicable)</label></th>

        <td><input type="text" id="zip" name="zip" size="25" maxlength="45"
                   class="form-control" title="Please enter the zip here"
                   placeholder="Please enter the zip here" value="<?php echo $this->rsParticipant['zip']; ?>"/></td>        
    </tr>

    <tr>
    
    <th>Participant/Lab Contact Name</th>
        <td><input type="text" id="contactname" name="contactname" size="50" maxlength="255" class="form-control" title="Please enter the contact name here" placeholder="Please enter the contact name here"  value="<?php echo $this->rsParticipant['contact_name']; ?>" /></td>
        <th>Participant e-mail Address <span class="mandatory">*</span></th>
        <td><input type="text" id="pemail" name="pemail" size="25" class="form-control" maxlength="45" value="<?php echo $this->rsParticipant['email']; ?>" title="Please enter the Participant's Email here" placeholder="Please enter the Participant's Email here" class="form-control isRequired isEmail"/></td>
        

    </tr>
    <tr>
        <th>Participant Phone Number</th>
        <td><input type="text" id="pphone1" name="pphone1" size="25" maxlength="45" value="<?php echo $this->rsParticipant['phone']; ?>" title="Please enter the Participant's Phone here" placeholder="Please enter the Participant's Phone here" class=" form-control isNumeric" /></td>
        <th>Participant Cell/Mobile Number <span class="mandatory">*</span></th>
        <td><input type="text" id="pphone2" name="pphone2" size="25" maxlength="45" value="<?php echo $this->rsParticipant['mobile']; ?>" class="form-control isRequired isNumeric" title="Please enter the Participant's Mobile Number here" placeholder="Please enter the Participant's Mobile Number here" class=" form-control isNumeric"/></td>
    </tr>
    <tr>
        <th>Participant Affiliation <span class="mandatory">*</span></th>
        <td>
            <select name="partAff" id="partAff"  class="isRequired form-control" title="Please choose the affiliation here" style="width: 285px">
                <option value="">--Select--</option>
                <?php foreach ($this->affiliates as $aff) {
                    ?>
                    <option value="<?php echo $aff['affiliate']; ?>" <?php echo ($this->rsParticipant['affiliation'] == $aff['affiliate']) ? "selected='selected'" : "" ?>><?php echo $aff['affiliate']; ?></option>
                    <?php }
                ?>
            </select>
        </td>
        <th>Network <span class="mandatory">*</span></th>
        <td>
            <select name="network" id="network"  class="isRequired form-control" title="Please choose the network here">
                <option value="">--Select--</option>
                <?php foreach ($this->networks as $nw) {
                    ?>
                    <option value="<?php echo $nw['network_id']; ?>"  <?php echo ($this->rsParticipant['network_tier'] == $nw['network_id']) ? "selected='selected'" : "" ?>><?php echo $nw['network_name']; ?></option>
                    <?php }
                ?>
            </select>
        </td>
    </tr>

</table>
<br>
<div id="respond" style="margin: 0px auto 0px auto; text-align: center;">
    <p>
        <input name="submitbtn" class="btn btn-primary" type="submit"  onclick="validateNow();
                                                return false;" tabindex="7" value="Submit"  /> 
        &nbsp;&nbsp;&nbsp;
        <input name="reset" class="btn btn-danger" type="button" id="reset" tabindex="8" value="Cancel" onclick="javascript:goto_testers()" /> 

    </p>
</div>	
</div>			
</form>			

</div>
</div>
</section>
<script type="text/javascript" src="<?php echo $this->baseUrl('js/select2.min.js'); ?>"></script>
<script>

    function goto_testers() {
        window.history.back();
    }
    
    $(document).ready(function() {
        
        $("#enrolledProgram").select2({
                    placeholder: "Select one or more Enrolled Programs",
                    allowClear: true
                });
        
        <?php
        if(isset($this->rsParticipant["individual"]) && $this->rsParticipant["individual"]=='no'){
        ?>
            tag = 'Lab Name <span class="mandatory">*</span>';
            $("#lastNameLable").hide();
            $("#lastNameLableTd").hide();
            $("#plname").val('');
            $("#pfname").attr("title","Please enter the Lab Name here");
            $("#pfname").attr("placeholder","Please enter the Lab Name here");
            $('#individualParticipant').prop('checked', false);
        <?php
        }
        ?>
   });

    function validateNow() {
        flag = deforayValidator.init({
            formId: 'participantEdit'
        });
        if (flag) {
            //$.blockUI();
            document.getElementById('participantEdit').submit();
        }
    }
    function checkIndividualParticipant(obj) {
                if (obj.checked) {
                    tag = 'Participant First Name <span class="mandatory">*</span>';
                    $("#lastNameLable").show();
                    $("#lastNameLableTd").show();
                    $("#pfname").attr("title","Please enter the Participant's First Name here");
                    $("#pfname").attr("placeholder","Please enter the Participant's First Name here");
                } else {
                    tag = 'Lab Name <span class="mandatory">*</span>';
                    $("#lastNameLable").hide();
                    $("#lastNameLableTd").hide();
                    $("#plname").val('');
                    $("#pfname").attr("title","Please enter the Lab Name here");
                    $("#pfname").attr("placeholder","Please enter the Lab Name here");
                    
                }
                $("#firstNameLable").html(tag);
            }
</script>